(this["webpackJsonpexcalidraw-claymate"]=this["webpackJsonpexcalidraw-claymate"]||[]).push([[27],{23:function(e){e.exports=JSON.parse('{"labels":{"paste":"Paste","selectAll":"Select all","multiSelect":"Add element to selection","moveCanvas":"Move canvas","copy":"Copy","copyAsPng":"Copy to clipboard as PNG","copyAsSvg":"Copy to clipboard as SVG","bringForward":"Bring forward","sendToBack":"Send to back","bringToFront":"Bring to front","sendBackward":"Send backward","delete":"Delete","copyStyles":"Copy styles","pasteStyles":"Paste styles","stroke":"Stroke","background":"Background","fill":"Fill","strokeWidth":"Stroke width","strokeStyle":"Stroke style","strokeStyle_solid":"Solid","strokeStyle_dashed":"Dashed","strokeStyle_dotted":"Dotted","sloppiness":"Sloppiness","opacity":"Opacity","textAlign":"Text align","fontSize":"Font size","fontFamily":"Font family","onlySelected":"Only selected","withBackground":"With Background","addWatermark":"Add \\"Made with Excalidraw\\"","handDrawn":"Hand-drawn","normal":"Normal","code":"Code","small":"Small","medium":"Medium","large":"Large","veryLarge":"Very large","solid":"Solid","hachure":"Hachure","crossHatch":"Cross-hatch","thin":"Thin","bold":"Bold","left":"Left","center":"Center","right":"Right","extraBold":"Extra bold","architect":"Architect","artist":"Artist","cartoonist":"Cartoonist","fileTitle":"File title","colorPicker":"Color picker","canvasBackground":"Canvas background","drawingCanvas":"Drawing canvas","layers":"Layers","actions":"Actions","language":"Language","createRoom":"Share a live-collaboration session","duplicateSelection":"Duplicate","untitled":"Untitled","name":"Name","yourName":"Your name","madeWithExcalidraw":"Made with Excalidraw","group":"Group selection","ungroup":"Ungroup selection","collaborators":"Collaborators","toggleGridMode":"Toggle grid mode","addToLibrary":"Add to library","removeFromLibrary":"Remove from library","libraryLoadingMessage":"Loading library..."},"buttons":{"clearReset":"Reset the canvas","export":"Export","exportToPng":"Export to PNG","exportToSvg":"Export to SVG","copyToClipboard":"Copy to clipboard","copyPngToClipboard":"Copy PNG to clipboard","save":"Save","saveAs":"Save as","load":"Load","getShareableLink":"Get shareable link","close":"Close","selectLanguage":"Select language","scrollBackToContent":"Scroll back to content","zoomIn":"Zoom in","zoomOut":"Zoom out","resetZoom":"Reset zoom","menu":"Menu","done":"Done","edit":"Edit","undo":"Undo","redo":"Redo","roomDialog":"Start live collaboration","createNewRoom":"Create new room","toggleFullScreen":"Toggle full screen","toggleZenMode":"Toggle zen mode","exitZenMode":"Exit zen mode"},"alerts":{"clearReset":"This will clear the whole canvas. Are you sure?","couldNotCreateShareableLink":"Couldn\'t create shareable link.","couldNotLoadInvalidFile":"Couldn\'t load invalid file","importBackendFailed":"Importing from backend failed.","cannotExportEmptyCanvas":"Cannot export empty canvas.","couldNotCopyToClipboard":"Couldn\'t copy to clipboard. Try using Chrome browser.","decryptFailed":"Couldn\'t decrypt data.","uploadedSecurly":"The upload has been secured with end-to-end encryption, which means that Excalidraw server and third parties can\'t read the content.","loadSceneOverridePrompt":"Loading external drawing will replace your existing content. Do you wish to continue?"},"toolBar":{"selection":"Selection","draw":"Free draw","rectangle":"Rectangle","diamond":"Diamond","ellipse":"Ellipse","arrow":"Arrow","line":"Line","text":"Text","library":"Library","lock":"Keep selected tool active after drawing"},"headings":{"canvasActions":"Canvas actions","selectedShapeActions":"Selected shape actions","shapes":"Shapes"},"hints":{"linearElement":"Click to start multiple points, drag for single line","freeDraw":"Click and drag, release when you\'re finished","linearElementMulti":"Click on last point or press Escape or Enter to finish","resize":"You can constrain proportions by holding SHIFT while resizing,\\nhold ALT to resize from the center","rotate":"You can constrain angles by holding SHIFT while rotating","lineEditor_info":"Double-click or press Enter to edit points","lineEditor_pointSelected":"Press Delete to remove point, CtrlOrCmd+D to duplicate, or drag to move","lineEditor_nothingSelected":"Select a point to move or remove, or hold Alt and click to add new points"},"errorSplash":{"headingMain_pre":"Encountered an error. Try ","headingMain_button":"reloading the page.","clearCanvasMessage":"If reloading doesn\'t work, try ","clearCanvasMessage_button":"clearing the canvas.","clearCanvasCaveat":" This will result in loss of work ","trackedToSentry_pre":"The error with identifier ","trackedToSentry_post":" was tracked on our system.","openIssueMessage_pre":"We were very cautious not to include your scene information on the error. If your scene is not private, please consider following up on our ","openIssueMessage_button":"bug tracker.","openIssueMessage_post":" Please include information below by copying and pasting into the GitHub issue.","sceneContent":"Scene content:"},"roomDialog":{"desc_intro":"You can invite people to your current scene to collaborate with you.","desc_privacy":"Don\'t worry, the session uses end-to-end encryption, so whatever you draw will stay private. Not even our server will be able to see what you come up with.","button_startSession":"Start session","button_stopSession":"Stop session","desc_inProgressIntro":"Live-collaboration session is now in progress.","desc_persistenceWarning":"Note that the scene data is shared across collaborators in a P2P fashion, and not persisted to our server. Thus, if all of you disconnect, you will lose the data unless you export it to a file or a shareable link.","desc_shareLink":"Share this link with anyone you want to collaborate with:","desc_exitSession":"Stopping the session will disconnect you from the room, but you\'ll be able to continue working with the scene, locally. Note that this won\'t affect other people, and they\'ll still be able to collaborate on their version."},"errorDialog":{"title":"Error"},"shortcutsDialog":{"title":"Keyboard shortcuts","shapes":"Shapes","or":"or","click":"click","drag":"drag","curvedArrow":"Curved arrow","curvedLine":"Curved line","editor":"Editor","view":"View","blog":"Read our blog","howto":"Follow our guides","github":"Found an issue? Submit","textNewLine":"Add new line (text)","textFinish":"Finish editing (text)","zoomToFit":"Zoom to fit all elements"},"encrypted":{"tooltip":"Your drawings are end-to-end encrypted so Excalidraw\'s servers will never see them."},"charts":{"noNumericColumn":"You pasted a spreadsheet without a numeric column.","tooManyColumns":"You pasted a spreadsheet with more than two columns."}}')},24:function(e){e.exports=JSON.parse('{"ar-SA":56,"bg-BG":81,"ca-ES":91,"de-DE":98,"el-GR":98,"en":100,"es-ES":96,"fa-IR":98,"fi-FI":100,"fr-FR":98,"he-IL":93,"hi-IN":98,"hu-HU":59,"id-ID":59,"it-IT":96,"ja-JP":76,"ko-KR":71,"nb-NO":98,"nl-NL":84,"nn-NO":98,"pl-PL":98,"pt-PT":100,"ru-RU":83,"sq-AL":42,"tr-TR":97,"uk-UA":99,"zh-CN":98,"zh-TW":100}')},33:function(e,t,n){var r={"./README.md":[98,7,39],"./ar-SA":[40,3,0],"./ar-SA.json":[40,3,0],"./bg-BG":[41,3,1],"./bg-BG.json":[41,3,1],"./ca-ES":[42,3,2],"./ca-ES.json":[42,3,2],"./de-DE":[43,3,3],"./de-DE.json":[43,3,3],"./el-GR":[44,3,4],"./el-GR.json":[44,3,4],"./en":[23,3],"./en.json":[23,3],"./es-ES":[45,3,5],"./es-ES.json":[45,3,5],"./fa-IR":[46,3,6],"./fa-IR.json":[46,3,6],"./fi-FI":[47,3,7],"./fi-FI.json":[47,3,7],"./fr-FR":[48,3,8],"./fr-FR.json":[48,3,8],"./he-IL":[49,3,9],"./he-IL.json":[49,3,9],"./hi-IN":[50,3,10],"./hi-IN.json":[50,3,10],"./hu-HU":[51,3,11],"./hu-HU.json":[51,3,11],"./id-ID":[52,3,12],"./id-ID.json":[52,3,12],"./it-IT":[53,3,13],"./it-IT.json":[53,3,13],"./ja-JP":[54,3,14],"./ja-JP.json":[54,3,14],"./ko-KR":[55,3,15],"./ko-KR.json":[55,3,15],"./nb-NO":[56,3,16],"./nb-NO.json":[56,3,16],"./nl-NL":[57,3,17],"./nl-NL.json":[57,3,17],"./nn-NO":[58,3,18],"./nn-NO.json":[58,3,18],"./percentages":[24,3],"./percentages.json":[24,3],"./pl-PL":[59,3,19],"./pl-PL.json":[59,3,19],"./pt-PT":[60,3,20],"./pt-PT.json":[60,3,20],"./ru-RU":[61,3,21],"./ru-RU.json":[61,3,21],"./sq-AL":[62,3,22],"./sq-AL.json":[62,3,22],"./tr-TR":[63,3,23],"./tr-TR.json":[63,3,23],"./uk-UA":[64,3,24],"./uk-UA.json":[64,3,24],"./zh-CN":[65,3,25],"./zh-CN.json":[65,3,25],"./zh-TW":[66,3,26],"./zh-TW.json":[66,3,26]};function a(e){if(!n.o(r,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],a=t[0];return Promise.all(t.slice(2).map(n.e)).then((function(){return n.t(a,t[1])}))}a.keys=function(){return Object.keys(r)},a.id=33,e.exports=a},34:function(e,t,n){},68:function(e,t,n){e.exports=n(97)},73:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){},76:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){},84:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){},88:function(e,t,n){},89:function(e,t,n){},90:function(e,t,n){},91:function(e,t,n){},92:function(e,t,n){},93:function(e,t,n){},94:function(e,t,n){},95:function(e,t,n){},96:function(e,t,n){},97:function(e,t,n){"use strict";n.r(t);var r,a,o=n(0),i=n.n(o),l=n(13),c=n.n(l),s=(n(73),n(74),n(75),n(76),n(4)),u=n.n(s),d=n(5),m=n(1),p=n(3),h=n(7),f=n(8),g=n(11),v=n(12),b=n(101),y=n(2),E=function(e){return null!=e&&"text"===e.type},w=function(e){return null!=e&&("arrow"===e.type||"line"===e.type||"draw"===e.type)},k=n(9),x=(n(35),Math.PI/12),S="text",C="crosshair",O="grabbing",I="pointer",j=0,T=1,M=-1;!function(e){e.INIT="SCENE_INIT",e.UPDATE="SCENE_UPDATE"}(r||(r={})),function(e){e.COPY="copy",e.PASTE="paste",e.CUT="cut",e.KEYDOWN="keydown",e.KEYUP="keyup",e.MOUSE_MOVE="mousemove",e.RESIZE="resize",e.UNLOAD="unload",e.BLUR="blur",e.DRAG_OVER="dragover",e.DROP="drop",e.GESTURE_END="gestureend",e.BEFORE_UNLOAD="beforeunload",e.GESTURE_START="gesturestart",e.GESTURE_CHANGE="gesturechange",e.POINTER_MOVE="pointermove",e.POINTER_UP="pointerup",e.STATE_CHANGE="statechange",e.WHEEL="wheel",e.TOUCH_START="touchstart",e.TOUCH_END="touchend",e.HASHCHANGE="hashchange"}(a||(a={}));var A="test",L="development",D="server-volatile-broadcast",P="server-broadcast",z="App-menu__left",N={1:"Virgil",2:"Helvetica",3:"Cascadia"},R=["selectAll"],H=function(e,t,n,r,a,o){var i,l,c=a-n,s=o-r,u=c*c+s*s,d=-1;0!==u&&(d=((e-n)*c+(t-r)*s)/u),d<0?(i=n,l=r):d>1?(i=a,l=o):(i=n+d*c,l=r+d*s);var m=e-i,p=t-l;return Math.hypot(m,p)},B=function(e,t,n,r,a){return[(e-n)*Math.cos(a)-(t-r)*Math.sin(a)+n,(e-n)*Math.sin(a)+(t-r)*Math.cos(a)+r]},_=function(e,t,n,r,a,o,i,l){var c=Math.cos(r),s=Math.sin(r);return e.e&&e.w?t+=a+i:e.e?(t+=a*(1+c),n+=a*s,t+=i*(1-c),n+=i*-s):e.w&&(t+=a*(1-c),n+=a*-s,t+=i*(1+c),n+=i*s),e.n&&e.s?n+=o+l:e.n?(t+=o*s,n+=o*(1-c),t+=l*-s,n+=l*(1+c)):e.s&&(t+=o*-s,n+=o*(1+c),t+=l*s,n+=l*(1-c)),[t,n]},F=function(e,t,n,r){var a=n-e,o=r-t;return Math.hypot(a,o)},U=function(e){if(e.length>=3){var t=[e[0],e[e.length-1]],n=t[0],r=t[1];return F(n[0],n[1],r[0],r[1])<=10}return!1},W=function(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])},G=function(e,t,n){var r=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===r?0:r>0?1:2},Y=function(e,t,n,r){var a=G(e,t,n),o=G(e,t,r),i=G(n,r,e),l=G(n,r,t);return a!==o&&i!==l||(!(0!==a||!W(e,n,t))||(!(0!==o||!W(e,r,t))||(!(0!==i||!W(n,e,r))||!(0!==l||!W(n,t,r)))))},X=function(e,t,n){return n?[Math.round(e/n)*n,Math.round(t/n)*n]:[e,t]},V=n(14),K=function(e,t,n){var r=n.map((function(t){return t[e]})),a=Math.max.apply(Math,Object(y.a)(r)),o=Math.min.apply(Math,Object(y.a)(r)),i=a-o,l=0===i?1:t/i,c=1/0,s=n.map((function(t){return t.map((function(t,n){if(n!==e)return t;var r=t*l;return c=Math.min(r,c),r}))}));if(2===s.length)return s;var u=o-c;return s.map((function(t){return t.map((function(t,n){return n===e?t+u:t}))}))},q=function(e){return w(e)?Q(e):[e.x,e.y,e.x+e.width,e.y+e.height]},Z=function(e){var t=Math.floor(e.width/2)+1,n=e.width,r=Math.floor(e.height/2)+1;return[t,0,n,r,t,e.height,0,r]},J=function(e){var t,n=Object(k.a)(e.sets);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("path"===r.type)return r.ops}}catch(a){n.e(a)}finally{n.f()}return e.sets[0].ops},$=function(e,t){var n=[0,0],r=e.reduce((function(e,r){var a=r.op,o=r.data;if("move"===a)n=o;else if("bcurveTo"===a){var i=[o[0],o[1]],l=[o[2],o[3]],c=[o[4],o[5]],s=n;n=c;for(var u=function(e,t){return Math.pow(1-e,3)*c[t]+3*e*Math.pow(1-e,2)*l[t]+3*Math.pow(e,2)*(1-e)*i[t]+s[t]*Math.pow(e,3)},d=0;d<=1;){var p=u(d,0),h=u(d,1);if(t){var f=t(p,h),g=Object(m.a)(f,2);p=g[0],h=g[1]}e.minY=Math.min(e.minY,h),e.minX=Math.min(e.minX,p),e.maxX=Math.max(e.maxX,p),e.maxY=Math.max(e.maxY,h),d+=.1}}return e}),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});return[r.minX,r.minY,r.maxX,r.maxY]},Q=function(e){if(e.points.length<2||!se(e)){var t=e.points.reduce((function(e,t){var n=Object(m.a)(t,2),r=n[0],a=n[1];return e.minY=Math.min(e.minY,a),e.minX=Math.min(e.minX,r),e.maxX=Math.max(e.maxX,r),e.maxY=Math.max(e.maxY,a),e}),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),n=t.minX,r=t.minY,a=t.maxX,o=t.maxY;return[n+e.x,r+e.y,a+e.x,o+e.y]}var i=se(e),l=J(i[0]),c=$(l),s=Object(m.a)(c,4),u=s[0],d=s[1],p=s[2],h=s[3];return[u+e.x,d+e.y,p+e.x,h+e.y]},ee=function(e){var t=q(e),n=Object(m.a)(t,4),r=n[0],a=n[1],o=n[2],i=n[3],l=(r+o)/2,c=(a+i)/2;if(w(e))return function(e,t,n){if(e.points.length<2||!se(e)){var r=e.points.reduce((function(r,a){var o=Object(m.a)(a,2),i=o[0],l=o[1],c=B(e.x+i,e.y+l,t,n,e.angle),s=Object(m.a)(c,2);return i=s[0],l=s[1],r.minY=Math.min(r.minY,l),r.minX=Math.min(r.minX,i),r.maxX=Math.max(r.maxX,i),r.maxY=Math.max(r.maxY,l),r}),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});return[r.minX,r.minY,r.maxX,r.maxY]}var a=se(e),o=J(a[0]);return $(o,(function(r,a){return B(e.x+r,e.y+a,t,n,e.angle)}))}(e,l,c);if("diamond"===e.type){var s=B(l,a,l,c,e.angle),u=Object(m.a)(s,2),d=u[0],p=u[1],h=B(l,i,l,c,e.angle),f=Object(m.a)(h,2),g=f[0],v=f[1],b=B(r,c,l,c,e.angle),y=Object(m.a)(b,2),E=y[0],k=y[1],x=B(o,c,l,c,e.angle),S=Object(m.a)(x,2),C=S[0],O=S[1];return[Math.min(d,g,E,C),Math.min(p,v,k,O),Math.max(d,g,E,C),Math.max(p,v,k,O)]}if("ellipse"===e.type){var I=(o-r)/2,j=(i-a)/2,T=Math.cos(e.angle),M=Math.sin(e.angle),A=Math.hypot(I*T,j*M),L=Math.hypot(j*T,I*M);return[l-A,c-L,l+A,c+L]}var D=B(r,a,l,c,e.angle),P=Object(m.a)(D,2),z=P[0],N=P[1],R=B(r,i,l,c,e.angle),H=Object(m.a)(R,2),_=H[0],F=H[1],U=B(o,i,l,c,e.angle),W=Object(m.a)(U,2),G=W[0],Y=W[1],X=B(o,a,l,c,e.angle),V=Object(m.a)(X,2),K=V[0],Z=V[1];return[Math.min(z,_,G,K),Math.min(N,F,Y,Z),Math.max(z,_,G,K),Math.max(N,F,Y,Z)]},te=function(e){if(!e.length)return[0,0,0,0];var t=1/0,n=-1/0,r=1/0,a=-1/0;return e.forEach((function(e){var o=ee(e),i=Object(m.a)(o,4),l=i[0],c=i[1],s=i[2],u=i[3];t=Math.min(t,l),r=Math.min(r,c),n=Math.max(n,s),a=Math.max(a,u)})),[t,r,n,a]},ne=function(e,t,n){if(!w(e))return[e.x,e.y,e.x+t,e.y+n];var r=K(0,t,K(1,n,e.points)),a=V.a.generator().curve(r,de(e)),o=J(a),i=$(o),l=Object(m.a)(i,4),c=l[0],s=l[1],u=l[2],d=l[3];return[c+e.x,s+e.y,u+e.x,d+e.y]},re=function(e,t){var n=V.a.generator().curve(t,de(e)),r=J(n),a=$(r),o=Object(m.a)(a,4),i=o[0],l=o[1],c=o[2],s=o[3];return[i+e.x,l+e.y,c+e.x,s+e.y]},ae=[12,8],oe=[3,6],ie=function(e,t,n){switch(n.globalAlpha=e.opacity/100,e.type){case"rectangle":case"diamond":case"ellipse":t.draw(se(e));break;case"arrow":case"draw":case"line":se(e).forEach((function(e){t.draw(e)}));break;default:if(!E(e))throw new Error("Unimplemented type ".concat(e.type));var r=Fn(e.text),a=r&&!n.canvas.isConnected;a&&document.body.appendChild(n.canvas),n.canvas.setAttribute("dir",r?"rtl":"ltr");var o=n.font;n.font=In(e);var i=n.fillStyle;n.fillStyle=e.strokeColor;var l=n.textAlign;n.textAlign=e.textAlign;for(var c=e.text.replace(/\r\n?/g,"\n").split("\n"),s=e.height/c.length,u=e.height-e.baseline,d="center"===e.textAlign?e.width/2:"right"===e.textAlign?e.width:0,m=0;m<c.length;m++)n.fillText(c[m],d,(m+1)*s-u);n.fillStyle=i,n.font=o,n.textAlign=l,a&&n.canvas.remove()}n.globalAlpha=1},le=new WeakMap,ce=new WeakMap,se=function(e){return ce.get(e)},ue=function(e){return ce.delete(e)},de=function(e){var t={seed:e.seed,strokeLineDash:"dashed"===e.strokeStyle?ae:"dotted"===e.strokeStyle?oe:void 0,disableMultiStroke:"solid"!==e.strokeStyle,strokeWidth:"solid"!==e.strokeStyle?e.strokeWidth+.5:e.strokeWidth,fillWeight:e.strokeWidth/2,hachureGap:4*e.strokeWidth,roughness:e.roughness,stroke:e.strokeColor};switch(e.type){case"rectangle":case"diamond":case"ellipse":return t.fillStyle=e.fillStyle,t.fill="transparent"===e.backgroundColor?void 0:e.backgroundColor,"ellipse"===e.type&&(t.curveFitting=1),t;case"line":case"draw":return U(e.points)&&(t.fillStyle=e.fillStyle,t.fill="transparent"===e.backgroundColor?void 0:e.backgroundColor),t;case"arrow":return t;default:throw new Error("Unimplemented type ".concat(e.type))}},me=function(e,t){var n=ce.get(e)||null;if(!n){switch(le.delete(e),e.type){case"rectangle":n=t.rectangle(0,0,e.width,e.height,de(e));break;case"diamond":var r=Z(e),a=Object(m.a)(r,8),o=a[0],i=a[1],l=a[2],c=a[3],s=a[4],u=a[5],d=a[6],p=a[7];n=t.polygon([[o,i],[l,c],[s,u],[d,p]],de(e));break;case"ellipse":n=t.ellipse(e.width/2,e.height/2,e.width,e.height,de(e));break;case"line":case"draw":case"arrow":var h=de(e),f=e.points.length?e.points:[[0,0]];if(n=[t.curve(f,h)],"arrow"===e.type){var g,v=function(e,t){var n=J(t[0]),r=n[n.length-1].data,a=[r[4],r[5]],o=[r[2],r[3]],i=[r[0],r[1]],l=n[n.length-2],c=[0,0];"move"===l.op?c=l.data:"bcurveTo"===l.op&&(c=[l.data[4],l.data[5]]);var s=function(e,t){return Math.pow(1-e,3)*a[t]+3*e*Math.pow(1-e,2)*o[t]+3*Math.pow(e,2)*(1-e)*i[t]+c[t]*Math.pow(e,3)},u=a[0],d=a[1],p=[s(.3,0),s(.3,1)],h=p[0],f=p[1],g=Math.hypot(u-h,d-f),v=(u-h)/g,b=(d-f)/g,y=e.points.reduce((function(e,t,n,r){var a=Object(m.a)(t,2),o=a[0],i=a[1],l=n>0?r[n-1]:[0,0],c=Object(m.a)(l,2),s=c[0],u=c[1];return e+Math.hypot(o-s,i-u)}),0),E=Math.min(30,y/2),w=u-v*E,k=d-b*E,x=B(w,k,u,d,-20*Math.PI/180),S=Object(m.a)(x,2),C=S[0],O=S[1],I=B(w,k,u,d,20*Math.PI/180),j=Object(m.a)(I,2);return[u,d,C,O,j[0],j[1]]}(e,n),b=Object(m.a)(v,6),y=b[0],E=b[1],w=b[2],k=b[3],x=b[4],S=b[5];"dotted"===e.strokeStyle?h.strokeLineDash=[3,4]:delete h.strokeLineDash,(g=n).push.apply(g,[t.line(w,k,y,E,h),t.line(x,S,y,E,h)])}break;case"text":n=[]}ce.set(e,n)}},pe=function(e,t){var n=t?t.zoom:1,r=le.get(e),a=r&&r.canvasZoom!==n&&!(null===t||void 0===t?void 0:t.shouldCacheIgnoreZoom);if(!r||a){var o=function(e,t){var n=document.createElement("canvas"),r=n.getContext("2d"),a=0,o=0;if(w(e)){var i=q(e),l=Object(m.a)(i,4),c=l[0],s=l[1],u=l[2],d=l[3];n.width=Ln(c,u)*window.devicePixelRatio*t+40,n.height=Ln(s,d)*window.devicePixelRatio*t+40,a=e.x>c?Math.floor(Ln(e.x,c))*window.devicePixelRatio:0,o=e.y>s?Math.floor(Ln(e.y,s))*window.devicePixelRatio:0,r.translate(a*t,o*t)}else n.width=e.width*window.devicePixelRatio*t+40,n.height=e.height*window.devicePixelRatio*t+40;r.translate(20,20),r.scale(window.devicePixelRatio*t,window.devicePixelRatio*t);var p=V.a.canvas(n);return ie(e,p,r),r.translate(-20,-20),r.scale(1/(window.devicePixelRatio*t),1/(window.devicePixelRatio*t)),{element:e,canvas:n,canvasZoom:t,canvasOffsetX:a,canvasOffsetY:o}}(e,n);return le.set(e,o),o}return r},he=function(e,t,n,r,a){var o=t.generator;switch(e.type){case"selection":n.translate(e.x+a.scrollX,e.y+a.scrollY);var i=n.fillStyle;n.fillStyle="rgba(0, 0, 255, 0.10)",n.fillRect(0,0,e.width,e.height),n.fillStyle=i,n.translate(-e.x-a.scrollX,-e.y-a.scrollY);break;case"rectangle":case"diamond":case"ellipse":case"line":case"draw":case"arrow":case"text":if(me(e,o),r){!function(e,t,n,r){var a=e.element,o=q(a),i=Object(m.a)(o,4),l=i[0],c=i[1],s=i[2],u=i[3],d=((l+s)/2+r.scrollX)*window.devicePixelRatio,p=((c+u)/2+r.scrollY)*window.devicePixelRatio;n.scale(1/window.devicePixelRatio,1/window.devicePixelRatio),n.translate(d,p),n.rotate(a.angle),n.drawImage(e.canvas,-(s-l)/2*window.devicePixelRatio-20/e.canvasZoom,-(u-c)/2*window.devicePixelRatio-20/e.canvasZoom,e.canvas.width/e.canvasZoom,e.canvas.height/e.canvasZoom),n.rotate(-a.angle),n.translate(-d,-p),n.scale(window.devicePixelRatio,window.devicePixelRatio)}(pe(e,a),0,n,a)}else{var l=q(e),c=Object(m.a)(l,4),s=c[0],u=c[1],d=c[2],p=c[3],h=(s+d)/2+a.scrollX,f=(u+p)/2+a.scrollY,g=(d-s)/2-(e.x-s),v=(p-u)/2-(e.y-u);n.translate(h,f),n.rotate(e.angle),n.translate(-g,-v),ie(e,t,n),n.translate(g,v),n.rotate(-e.angle),n.translate(-h,-f)}break;default:throw new Error("Unimplemented type ".concat(e.type))}},fe=function(e,t,n,r,a){var o=q(e),i=Object(m.a)(o,4),l=i[0],c=i[1],s=i[2],u=i[3],d=(s-l)/2-(e.x-l),p=(u-c)/2-(e.y-c),h=180*e.angle/Math.PI,f=t.generator;switch(e.type){case"selection":throw new Error("Selection rendering is not supported for SVG");case"rectangle":case"diamond":case"ellipse":me(e,f);var g=t.draw(se(e)),v=e.opacity/100;1!==v&&(g.setAttribute("stroke-opacity","".concat(v)),g.setAttribute("fill-opacity","".concat(v))),g.setAttribute("transform","translate(".concat(r||0," ").concat(a||0,") rotate(").concat(h," ").concat(d," ").concat(p,")")),n.appendChild(g);break;case"line":case"draw":case"arrow":me(e,f);var b=n.ownerDocument.createElementNS(wn,"g"),y=e.opacity/100;se(e).forEach((function(n){var o=t.draw(n);1!==y&&(o.setAttribute("stroke-opacity","".concat(y)),o.setAttribute("fill-opacity","".concat(y))),o.setAttribute("transform","translate(".concat(r||0," ").concat(a||0,") rotate(").concat(h," ").concat(d," ").concat(p,")")),"line"!==e.type&&"draw"!==e.type||!U(e.points)||"transparent"===e.backgroundColor||o.setAttribute("fill-rule","evenodd"),b.appendChild(o)})),n.appendChild(b);break;default:if(!E(e))throw new Error("Unimplemented type ".concat(e.type));var w=e.opacity/100,k=n.ownerDocument.createElementNS(wn,"g");1!==w&&(k.setAttribute("stroke-opacity","".concat(w)),k.setAttribute("fill-opacity","".concat(w))),k.setAttribute("transform","translate(".concat(r||0," ").concat(a||0,") rotate(").concat(h," ").concat(d," ").concat(p,")"));for(var x=e.text.replace(/\r\n?/g,"\n").split("\n"),S=e.height/x.length,C=e.height-e.baseline,O="center"===e.textAlign?e.width/2:"right"===e.textAlign?e.width:0,I=Fn(e.text)?"rtl":"ltr",j="center"===e.textAlign?"middle":"right"===e.textAlign||"rtl"===I?"end":"start",T=0;T<x.length;T++){var M=n.ownerDocument.createElementNS(wn,"text");M.textContent=x[T],M.setAttribute("x","".concat(O)),M.setAttribute("y","".concat((T+1)*S-C)),M.setAttribute("font-family",On(e)),M.setAttribute("font-size","".concat(e.fontSize,"px")),M.setAttribute("fill",e.strokeColor),M.setAttribute("text-anchor",j),M.setAttribute("style","white-space: pre;"),M.setAttribute("direction",I),k.appendChild(M)}n.appendChild(k)}},ge=n(19),ve=n(29),be=n.n(ve),ye=new ge.a(Date.now()),Ee=function(){return Math.floor(ye.next()*Math.pow(2,31))},we=function(){return be()()},ke=function(e,t){var n=!1,r=t.points;for(var a in"undefined"!==typeof r&&(t=Object(p.a)({},function(e){var t=e.map((function(e){return e[0]})),n=e.map((function(e){return e[1]}));return{width:Math.max.apply(Math,Object(y.a)(t))-Math.min.apply(Math,Object(y.a)(t)),height:Math.max.apply(Math,Object(y.a)(n))-Math.min.apply(Math,Object(y.a)(n))}}(r),{},t)),t){var o=t[a];if("undefined"!==typeof o){if(e[a]===o&&("object"!==typeof o||null===o||"groupIds"===a))continue;if("points"===a){var i=e[a],l=o;if(i.length===l.length){for(var c=!1,s=i.length;--s;){var u=i[s],d=l[s];if(u[0]!==d[0]||u[1]!==d[1]){c=!0;break}}if(!c)continue}}e[a]=o,n=!0}}n&&("undefined"===typeof t.height&&"undefined"===typeof t.width&&"undefined"===typeof r||ue(e),e.version++,e.versionNonce=Ee(),En.informMutation())},xe=function(e,t){return Object(p.a)({},e,{},t,{version:e.version+1,versionNonce:Ee()})},Se=function(e){return w(e)?e.points.length<2:0===e.width&&0===e.height},Ce=function(e,t,n){var r=Math.abs(t),a=Math.abs(n);if("line"===e||"arrow"===e||"draw"===e){var o=Math.round(Math.atan(a/r)/x)*x;0===o?n=0:o===Math.PI/2?t=0:n=Math.round(r*Math.tan(o))*Math.sign(n)||n}else"selection"!==e&&(n=r*Math.sign(n));return{width:t,height:n}},Oe=function(e){var t={width:e.width,height:e.height,x:e.x,y:e.y};if(e.width<0){var n=Math.abs(e.width);t.width=n,t.x=e.x-n}if(e.height<0){var r=Math.abs(e.height);t.height=r,t.y=e.y-r}return t},Ie=n(17),je=n(10);function Te(e,t,n){var r=n.filter((function(t){return t.groupIds.includes(e)}));return r.length<2?t.selectedGroupIds[e]||t.editingGroupId===e?Object(p.a)({},t,{selectedGroupIds:Object(p.a)({},t.selectedGroupIds,Object(je.a)({},e,!1)),editingGroupId:null}):t:Object(p.a)({},t,{selectedGroupIds:Object(p.a)({},t.selectedGroupIds,Object(je.a)({},e,!0)),selectedElementIds:Object(p.a)({},t.selectedElementIds,{},Object.fromEntries(r.map((function(e){return[e.id,!0]}))))})}function Me(e,t){return!!t.groupIds.filter((function(t){return t!==e.editingGroupId})).find((function(t){return e.selectedGroupIds[t]}))}function Ae(e){return Object.entries(e.selectedGroupIds).filter((function(e){var t=Object(m.a)(e,2);t[0];return t[1]})).map((function(e){var t=Object(m.a)(e,2),n=t[0];t[1];return n}))}function Le(e,t){var n,r=Object(p.a)({},e),a=dn(t,e),o=Object(k.a)(a);try{for(o.s();!(n=o.n()).done;){var i=n.value.groupIds;if(e.editingGroupId){var l=i.indexOf(e.editingGroupId);l>-1&&(i=i.slice(0,l))}if(i.length>0)r=Te(i[i.length-1],r,t)}}catch(c){o.e(c)}finally{o.f()}return r}function De(e,t){return e.groupIds.includes(t)}function Pe(e,t){return e.filter((function(e){return De(e,t)}))}function ze(e,t,n){var r=Object(y.a)(e),a=n?r.indexOf(n):-1,o=a>-1?a:r.length;return r.splice(o,0,t),r}var Ne=function(e,t){var n,r,a=t.x,o=t.y,i=t.strokeColor,l=t.backgroundColor,c=t.fillStyle,s=t.strokeWidth,u=t.strokeStyle,d=t.roughness,m=t.opacity,p=t.width,h=void 0===p?0:p,f=t.height,g=void 0===f?0:f,v=t.angle,b=void 0===v?0:v,y=t.groupIds,E=void 0===y?[]:y,w=Object(Ie.a)(t,["x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","strokeStyle","roughness","opacity","width","height","angle","groupIds"]);return{id:w.id||we(),type:e,x:a,y:o,width:h,height:g,angle:b,strokeColor:i,backgroundColor:l,fillStyle:c,strokeWidth:s,strokeStyle:u,roughness:d,opacity:m,groupIds:E,seed:null!==(n=w.seed)&&void 0!==n?n:Ee(),version:w.version||1,versionNonce:null!==(r=w.versionNonce)&&void 0!==r?r:0,isDeleted:!1}},Re=function(e){return Ne(e.type,e)};function He(e,t){return{x:"center"===e.textAlign?t.width/2:"right"===e.textAlign?t.width:0,y:"middle"===e.verticalAlign?t.height/2:0}}var Be=function(e){var t=jn(e.text,In(e)),n=He(e,t);return xe(Object(p.a)({},Ne("text",e),{text:e.text,fontSize:e.fontSize,fontFamily:e.fontFamily,textAlign:e.textAlign,verticalAlign:e.verticalAlign,x:e.x-n.x,y:e.y-n.y,width:t.width,height:t.height,baseline:t.baseline}),{})},_e=function(e,t){var n=t.text,r=t.isDeleted;return xe(e,Object(p.a)({text:n,isDeleted:null!==r&&void 0!==r?r:e.isDeleted},function(e,t){var n,r,a=jn(t,In(e)),o=a.width,i=a.height,l=a.baseline,c=e.textAlign,s=e.verticalAlign;if("center"===c&&"middle"===s){var u=jn(e.text,In(e)),d=He(e,{width:o-u.width,height:i-u.height});n=e.x-d.x,r=e.y-d.y}else{var p=q(e),h=Object(m.a)(p,4),f=h[0],g=h[1],v=h[2],b=h[3],y=ne(e,o,i),E=Object(m.a)(y,4),w=(f-E[0])/2,k=(g-E[1])/2,x=(v-E[2])/2,S=(b-E[3])/2,C=_({s:!0,e:"center"===c||"left"===c,w:"center"===c||"right"===c},e.x,e.y,e.angle,w,k,x,S),O=Object(m.a)(C,2);n=O[0],r=O[1]}return{width:o,height:i,x:Number.isFinite(n)?n:e.x,y:Number.isFinite(r)?r:e.y,baseline:l}}(e,n)))},Fe=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null==t||"object"!==typeof t)return t;if("[object Object]"===Object.prototype.toString.call(t)){var r="function"===typeof t.constructor?Object.create(Object.getPrototypeOf(t)):{};for(var a in t)if(t.hasOwnProperty(a)){if(0===n&&("shape"===a||"canvas"===a))continue;r[a]=e(t[a],n+1)}return r}if(Array.isArray(t)){for(var o=t.length,i=new Array(o);o--;)i[o]=e(t[o],n+1);return i}return t},Ue=function(e,t,n,r){var a=Fe(n);return a.id=we(),a.seed=Ee(),a.groupIds=function(e,t,n){for(var r=Object(y.a)(e),a=t?e.indexOf(t):-1,o=a>-1?a:e.length,i=0;i<o;i++)r[i]=n(r[i]);return r}(a.groupIds,e,(function(e){return t.has(e)||t.set(e,we()),t.get(e)})),r&&(a=Object.assign(a,r)),a},We={mouse:8,pen:16,touch:28},Ge={e:!0,s:!0,n:!0,w:!0,rotation:!0},Ye={e:!0,s:!0,n:!0,w:!0},Xe={e:!0,s:!0,n:!0,w:!0,nw:!0,se:!0,rotation:!0},Ve={e:!0,s:!0,n:!0,w:!0,ne:!0,sw:!0,rotation:!0},Ke=function(e,t,n,r,a,o,i){var l=B(e+n/2,t+r/2,a,o,i),c=Object(m.a)(l,2);return[c[0]-n/2,c[1]-r/2,n,r]},qe=function(e,t,n){var r=Object(m.a)(e,4),a=r[0],o=r[1],i=r[2],l=r[3],c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},u=We[c],d=u/n,p=u/n,h=u/n,f=u/n,g=i-a,v=l-o,b=(a+i)/2,y=(o+l)/2,E=4/n,w=(u-8)/(2*n),k={nw:s.nw?void 0:Ke(a-E-h+w,o-E-f+w,d,p,b,y,t),ne:s.ne?void 0:Ke(i+E-w,o-E-f+w,d,p,b,y,t),sw:s.sw?void 0:Ke(a-E-h+w,l+E-w,d,p,b,y,t),se:s.se?void 0:Ke(i+E-w,l+E-w,d,p,b,y,t),rotation:s.rotation?void 0:Ke(a+g/2-d/2,o-E-f+w-16/n,d,p,b,y,t)},x=5*u/n;return Math.abs(g)>x&&(s.n||(k.n=Ke(a+g/2-d/2,o-E-f+w,d,p,b,y,t)),s.s||(k.s=Ke(a+g/2-d/2,l+E-w,d,p,b,y,t))),Math.abs(v)>x&&(s.w||(k.w=Ke(a-E-h+w,o+v/2-p/2,d,p,b,y,t)),s.e||(k.e=Ke(i+E-w,o+v/2-p/2,d,p,b,y,t))),k},Ze=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse",r={};if("arrow"===e.type||"line"===e.type||"draw"===e.type){if(2===e.points.length){var a=Object(m.a)(e.points,2),o=a[1];0===o[0]||0===o[1]?r=Ve:o[0]>0&&o[1]<0?r=Xe:o[0]>0&&o[1]>0?r=Ve:o[0]<0&&o[1]>0?r=Xe:o[0]<0&&o[1]<0&&(r=Ve)}}else"text"===e.type&&(r=Ye);return qe(q(e),e.angle,t,n,r)},Je=n(15),$e=function(e,t){if("arrow"===e.type)return!1;var n="transparent"!==e.backgroundColor||t.selectedElementIds[e.id];return"line"===e.type||"draw"===e.type?n&&U(e.points):n},Qe=function(e,t,n,r,a){var o=10/a,i=q(e),l=Object(m.a)(i,4),c=l[0],s=l[1],u=l[2],d=l[3],p=B(n,r,(c+u)/2,(s+d)/2,-e.angle),h=Object(m.a)(p,2);if(n=h[0],r=h[1],"ellipse"===e.type){var f=Math.abs(n-e.x-e.width/2),g=Math.abs(r-e.y-e.height/2),v=.707,b=.707,y=Math.abs(e.width)/2,E=Math.abs(e.height)/2;return[0,1,2,3].forEach((function(e){var t=y*v,n=E*b,r=(y*y-E*E)*Math.pow(v,3)/y,a=(E*E-y*y)*Math.pow(b,3)/E,o=t-r,i=n-a,l=f-r,c=g-a,s=Math.hypot(i,o),u=Math.hypot(c,l);v=Math.min(1,Math.max(0,(l*s/u+r)/y)),b=Math.min(1,Math.max(0,(c*s/u+a)/E));var d=Math.hypot(b,v);v/=d,b/=d})),$e(e,t)?y*v-(f-o)>=0&&E*b-(g-o)>=0:Math.hypot(y*v-f,E*b-g)<o}if("rectangle"===e.type)return $e(e,t)?n>c-o&&n<u+o&&r>s-o&&r<d+o:H(n,r,c,s,u,s)<o||H(n,r,u,s,u,d)<o||H(n,r,u,d,c,d)<o||H(n,r,c,d,c,s)<o;if("diamond"===e.type){n-=e.x,r-=e.y;var k=Z(e),x=Object(m.a)(k,8),S=x[0],C=x[1],O=x[2],I=x[3],j=x[4],T=x[5],M=x[6],A=x[7];if($e(e,t)){if(C>T){var L=[C,T];T=L[0],C=L[1]}if(O<M){var D=[O,M];M=D[0],O=D[1]}return T+=o,O+=o,((M-=o)-S)*(r-A)-(M-n)*((C-=o)-A)<=0&&(S-O)*(r-I)-(n-O)*(C-I)<=0&&(O-j)*(r-T)-(n-j)*(I-T)<=0&&(j-M)*(r-A)-(n-M)*(T-A)<=0}return H(n,r,S,C,O,I)<o||H(n,r,O,I,j,T)<o||H(n,r,j,T,M,A)<o||H(n,r,M,A,S,C)<o}if(w(e)){if(!se(e))return!1;var P=se(e);if(n<c-o||r<s-o||n>u+o||r>d+o)return!1;var z=n-e.x,N=r-e.y;if($e(e,t))if(P.some((function(e){return et(e,z,N,o)})))return!0;return P.some((function(e){return tt(e,z,N,o)}))}if("text"===e.type)return n>=c&&n<=u&&r>=s&&r<=d;if("selection"===e.type)return console.warn("This should not happen, we need to investigate why it does."),!1;throw new Error("Unimplemented type ".concat(e.type))},et=function(e,t,n,r){var a,o=J(e),i=[],l=Object(k.a)(o);try{for(l.s();!(a=l.n()).done;){var c=a.value;if("move"===c.op){if(i.length)break;i.push([c.data[0],c.data[1]])}else"bcurveTo"===c.op&&(i.push([c.data[0],c.data[1]]),i.push([c.data[2],c.data[3]]),i.push([c.data[4],c.data[5]]))}}catch(s){l.e(s)}finally{l.f()}return i.length>=4&&function(e,t,n){var r=e.length;if(r<3)return!1;for(var a=[Number.MAX_SAFE_INTEGER,n],o=[t,n],i=0,l=0;l<r;l++){var c=e[l],s=e[(l+1)%r];if(Y(c,s,o,a)){if(0===G(c,o,s))return W(c,o,s);i++}}return i%2===1}(Object(Je.a)(i,10,5),t,n)},tt=function(e,t,n,r){var a=J(e),o=[0,0];return a.some((function(e,a){var i=e.op,l=e.data;if("move"===i)o=l;else if("bcurveTo"===i){var c=[l[0],l[1]],s=[l[2],l[3]],u=[l[4],l[5]],d=o;return o=u,function(e,t,n,r,a,o){for(var i=Object(m.a)(a,2),l=i[0],c=i[1],s=function(a,o){return Math.pow(1-a,3)*r[o]+3*a*Math.pow(1-a,2)*n[o]+3*Math.pow(a,2)*(1-a)*t[o]+e[o]*Math.pow(a,3)},u=0;u<=1;){var d=s(u,0),p=s(u,1);if(Math.sqrt(Math.pow(d-l,2)+Math.pow(p-c,2))<o)return!0;u+=.01}return!1}(d,c,s,u,[t,n],r)}return!1}))},nt=function(e,t,n){return t>=e[0]&&t<=e[0]+e[2]&&n>=e[1]&&n<=e[1]+e[3]},rt=function(e,t,n,r,a,o){return e.reduce((function(e,i){if(e)return e;var l=function(e,t,n,r,a,o){if(!t.selectedElementIds[e.id])return!1;var i=Ze(e,a,o),l=i.rotation,c=Object(Ie.a)(i,["rotation"]);if(l&&nt(l,n,r))return"rotation";var s=Object.keys(c).filter((function(e){var t=c[e];return!!t&&nt(t,n,r)}));return s.length>0&&s[0]}(i,t,n,r,a,o);return l?{element:i,resizeHandle:l}:null}),null)},at=function(e,t,n,r,a){var o=Object(m.a)(e,4),i=o[0],l=o[1],c=o[2],s=o[3],u=qe([i,l,c,s],0,r,a,Ge);return Object.keys(u).find((function(e){var r=u[e];return r&&nt(r,t,n)}))||!1},ot=["ns","nesw","ew","nwse"],it=function(e){var t=e.element,n=e.resizeHandle,r=t&&Math.sign(t.height)*Math.sign(t.width)===-1,a=null;switch(n){case"n":case"s":a="ns";break;case"w":case"e":a="ew";break;case"nw":case"se":a=r?"nesw":"nwse";break;case"ne":case"sw":a=r?"nwse":"nesw";break;case"rotation":return"grab"}return a&&t&&(a=function(e,t){var n=ot.indexOf(e);if(n>=0){var r=Math.round(t/(Math.PI/4));e=ot[(n+r)%ot.length]}return e}(a,t.angle)),a?"".concat(a,"-resize"):""},lt=function(e,t,n,r){var a=q(e),o=Object(m.a)(a,4),i=o[0],l=o[1],c=(i+o[2])/2,s=(l+o[3])/2,u=5*Math.PI/2+Math.atan2(n-s,t-c);r&&(u+=x/2,u-=u%x),u>=2*Math.PI&&(u-=2*Math.PI),ke(e,{angle:u})},ct=function(e,t,n,r,a){var o=e.points[0],i=e.points[1];if("end"===t)if(n){var l=Ce(e.type,r-e.x,a-e.y),c=l.width,s=l.height;ke(e,{points:[o,[c,s]]})}else ke(e,{points:[o,[r-o[0]-e.x,a-o[1]-e.y]]});else if(n){var u=Ce(e.type,e.x+i[0]-o[0]-r,e.y+i[1]-o[1]-a),d=u.width,m=u.height;ke(e,{x:e.x+i[0]-o[0]-d,y:e.y+i[1]-o[1]-m,points:[o,[d,m]]})}else ke(e,{x:r,y:a,points:[o,[i[0]-(r-o[0]-e.x),i[1]-(a-o[1]-e.y)]]})},st=function(e,t,n){return w(e)?{points:K(0,t,K(1,n,e.points))}:{}},ut=function(e,t,n){var r=e.fontSize*(t/e.width);if(r<1)return null;var a=jn(e.text,In({fontSize:r,fontFamily:e.fontFamily}));return{size:r,baseline:a.baseline+(n-a.height)}},dt=function(e,t){return{n:/^(n|ne|nw)$/.test(e)||t&&/^(s|se|sw)$/.test(e),s:/^(s|se|sw)$/.test(e)||t&&/^(n|ne|nw)$/.test(e),w:/^(w|nw|sw)$/.test(e)||t&&/^(e|ne|se)$/.test(e),e:/^(e|ne|se)$/.test(e)||t&&/^(w|nw|sw)$/.test(e)}},mt=function(e,t,n,r,a){var o,i=q(e),l=Object(m.a)(i,4),c=l[0],s=l[1],u=l[2],d=l[3],p=B(r,a,(c+u)/2,(s+d)/2,-e.angle),h=Object(m.a)(p,2),f=h[0],g=h[1];switch(t){case"se":o=Math.max((f-c)/(u-c),(g-s)/(d-s));break;case"nw":o=Math.max((u-f)/(u-c),(d-g)/(d-s));break;case"ne":o=Math.max((f-c)/(u-c),(d-g)/(d-s));break;case"sw":o=Math.max((u-f)/(u-c),(g-s)/(d-s))}if(o>0){var v=e.width*o,b=e.height*o,y=ut(e,v,b);if(null===y)return;var E=ne(e,v,b),w=Object(m.a)(E,4),k=(c-w[0])/2,x=(s-w[1])/2,S=(u-w[2])/2,C=(d-w[3])/2,O=_(dt(t,n),e.x,e.y,e.angle,k,x,S,C),I=Object(m.a)(O,2),j=I[0],T=I[1];ke(e,{fontSize:y.size,width:v,height:b,baseline:y.baseline,x:j,y:T})}},pt=function(e,t,n,r,a,o){var i=q(e),l=Object(m.a)(i,4),c=l[0],s=l[1],u=l[2],d=l[3],h=B(a,o,(c+u)/2,(s+d)/2,-e.angle),f=Object(m.a)(h,2),g=f[0],v=f[1],b=1,y=1;"e"!==t&&"ne"!==t&&"se"!==t||(b=(g-c)/(u-c)),"s"!==t&&"sw"!==t&&"se"!==t||(y=(v-s)/(d-s)),"w"!==t&&"nw"!==t&&"sw"!==t||(b=(u-g)/(u-c)),"n"!==t&&"nw"!==t&&"ne"!==t||(y=(d-v)/(d-s));var E=e.width*b,k=e.height*y;n&&(E=k=Math.max(E,k));var x=ne(e,E,k),S=Object(m.a)(x,4),C=S[0],O=S[1],I=S[2],j=S[3],T=(c-C)/2,M=(s-O)/2,A=(u-I)/2,L=(d-j)/2,D=st(e,E,k),P=ne(Object(p.a)({},e,{},D),Math.abs(E),Math.abs(k)),z=Object(m.a)(P,4),N=function(e,t,n,r,a,o,i,l,c,s,u,d,m){var p=Math.cos(m),h=Math.sin(m),f=0,g=0;return t<0&&("e"!==e&&"ne"!==e&&"se"!==e||(d?(f+=(s-r)*p,g+=(s-r)*h):f+=s-r),"w"!==e&&"nw"!==e&&"sw"!==e||(d?(f+=(l-o)*p,g+=(l-o)*h):f+=l-o)),n<0&&("s"!==e&&"se"!==e&&"sw"!==e||(d?(g+=(u-a)*p,f+=(u-a)*-h):g+=u-a),"n"!==e&&"ne"!==e&&"nw"!==e||(d?(g+=(c-i)*p,f+=(c-i)*-h):g+=c-i)),[f,g]}(t,E,k,C,O,I,j,z[0],z[1],z[2],z[3],w(e),e.angle),R=Object(m.a)(N,2),H=R[0],F=R[1],U=_(dt(t,r),e.x-H,e.y-F,e.angle,T,M,A,L),W=Object(m.a)(U,2),G=W[0],Y=W[1];0!==E&&0!==k&&Number.isFinite(G)&&Number.isFinite(Y)&&ke(e,Object(p.a)({width:E,height:k,x:G,y:Y},D))},ht=function(e,t,n,r){var a,o,i=te(e),l=Object(m.a)(i,4),c=l[0],s=l[1],u=l[2],d=l[3];switch(t){case"se":a=Math.max((n-c)/(u-c),(r-s)/(d-s)),o=function(e,t,n){var r=Object(m.a)(t,2),o=r[0],i=r[1],l=Object(m.a)(n,2),u=l[0],d=l[1];return{x:e.x+(o-c)*(a-1)+o-u,y:e.y+(i-s)*(a-1)+i-d}};break;case"nw":a=Math.max((u-n)/(u-c),(d-r)/(d-s)),o=function(e,t,n){var r=Object(m.a)(t,4),o=r[2],i=r[3],l=Object(m.a)(n,4),c=l[2],s=l[3];return{x:e.x-(u-o)*(a-1)+o-c,y:e.y-(d-i)*(a-1)+i-s}};break;case"ne":a=Math.max((n-c)/(u-c),(d-r)/(d-s)),o=function(e,t,n){var r=Object(m.a)(t,4),o=r[0],i=r[3],l=Object(m.a)(n,4),s=l[0],u=l[3];return{x:e.x+(o-c)*(a-1)+o-s,y:e.y-(d-i)*(a-1)+i-u}};break;case"sw":a=Math.max((u-n)/(u-c),(r-s)/(d-s)),o=function(e,t,n){var r=Object(m.a)(t,3),o=r[1],i=r[2],l=Object(m.a)(n,3),c=l[1],d=l[2];return{x:e.x-(u-i)*(a-1)+i-d,y:e.y+(o-s)*(a-1)+o-c}}}if(a>0){var h=e.reduce((function(e,t){if(!e)return e;var n=t.width*a,r=t.height*a,i={};if("text"===t.type){var l=ut(t,n,r);if(null===l)return null;i={fontSize:l.size,baseline:l.baseline}}var c=q(t),s=st(t,n,r),u=ne(Object(p.a)({},t,{},s),n,r),d=o(t,c,u),m=d.x,h=d.y;return[].concat(Object(y.a)(e),[Object(p.a)({width:n,height:r,x:m,y:h},s,{},i)])}),[]);h&&e.forEach((function(e,t){ke(e,h[t])}))}},ft=function(e,t,n,r,a,o,i,l,c,s){if(c){var u=Ce(t,i,o<r?-l:l);i=u.width,(l=u.height)<0&&(l=-l)}var d=a<n?n-i:n,m=o<r?r-l:r;s&&(d=n-(i+=i)/2,m=r-(l+=l)/2),0!==i&&0!==l&&ke(e,{x:d,y:m,width:i,height:l})},gt=/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),vt="ArrowLeft",bt="ArrowRight",yt="ArrowDown",Et="ArrowUp",wt="Enter",kt="Escape",xt="Delete",St="Backspace",Ct=gt?"metaKey":"ctrlKey",Ot="Tab",It=" ",jt="?",Tt=70,Mt=18,At=90,Lt=222,Dt=71,Pt=67,zt=86,Nt=function(e){return e===vt||e===bt||e===yt||e===Et},Rt=function(e){return e.altKey||e.which===Mt},Ht=function(e){return e.shiftKey},Bt=function(e){return e.shiftKey},_t=function(e){return e.replace(/\t/g,"        ").replace(/\r?\n|\r/g,"\n")},Ft=function(e,t,n,r){var a=180*n/Math.PI;return"translate(".concat(e*(r-1)/2,"px, ").concat(t*(r-1)/2,"px) scale(").concat(r,") rotate(").concat(a,"deg)")},Ut=function(e){var t=jn(e.text,In(e));ke(e,{width:t.width,height:t.height,baseline:t.baseline})},Wt=function(e,t){return Boolean(e.editingElement||dn(t,e).length||"selection"!==e.elementType)},Gt=function(e){return e.reduce((function(e,t){return e[t.id]=t,e}),{})},Yt=function(e){return e.reduce((function(e,t){return e+t.version}),0)},Xt=function(e){return e.filter((function(e){return!e.isDeleted}))},Vt=function(e){return!e.isDeleted},Kt=n(38),qt=n(23),Zt=n(24),Jt=[{lng:"en",label:"English",data:"en.json"}].concat([{lng:"bg-BG",label:"\u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438",data:"bg-BG.json"},{lng:"de-DE",label:"Deutsch",data:"de-DE.json"},{lng:"es-ES",label:"Espa\xf1ol",data:"es-ES.json"},{lng:"ca-ES",label:"Catalan",data:"ca-ES.json"},{lng:"el-GR",label:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",data:"el-GR.json"},{lng:"fr-FR",label:"Fran\xe7ais",data:"fr-FR.json"},{lng:"id-ID",label:"Bahasa Indonesia",data:"id-ID.json"},{lng:"it-IT",label:"Italiano",data:"it-IT.json"},{lng:"hu-HU",label:"Magyar",data:"hu-HU.json"},{lng:"nl-NL",label:"Nederlands",data:"nl-NL.json"},{lng:"nb-NO",label:"Norsk bokm\xe5l",data:"nb-NO.json"},{lng:"nn-NO",label:"Norsk nynorsk",data:"nn-NO.json"},{lng:"pl-PL",label:"Polski",data:"pl-PL.json"},{lng:"pt-PT",label:"Portugu\xeas",data:"pt-PT.json"},{lng:"ru-RU",label:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",data:"ru-RU.json"},{lng:"uk-UA",label:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430",data:"uk-UA.json"},{lng:"fi-FI",label:"Suomi",data:"fi-FI.json"},{lng:"tr-TR",label:"T\xfcrk\xe7e",data:"tr-TR.json"},{lng:"ja-JP",label:"\u65e5\u672c\u8a9e",data:"ja-JP.json"},{lng:"ko-KR",label:"\ud55c\uad6d\uc5b4",data:"ko-KR.json"},{lng:"zh-TW",label:"\u7e41\u9ad4\u4e2d\u6587",data:"zh-TW.json"},{lng:"zh-CN",label:"\u7b80\u4f53\u4e2d\u6587",data:"zh-CN.json"},{lng:"ar-SA",label:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",data:"ar-SA.json",rtl:!0},{lng:"he-IL",label:"\u05e2\u05d1\u05e8\u05d9\u05ea",data:"he-IL.json",rtl:!0},{lng:"hi-IN",label:"\u0939\u093f\u0928\u094d\u0926\u0940",data:"hi-IN.json"}].sort((function(e,t){return e.label>t.label?1:-1}))).filter((function(e){return Zt[e.lng]>85})),$t=Jt[0],Qt={},en=Jt[0],tn=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $t=Jt.find((function(e){return e.lng===t}))||en,document.documentElement.dir=$t.rtl?"rtl":"ltr",e.next=4,n(33)("./".concat($t.data));case 4:Qt=e.sent,ln.cacheUserLanguage($t.lng);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),nn=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=ln.detect(),$t=Jt.find((function(e){return e.lng===t}))||en,document.documentElement.dir=$t.rtl?"rtl":"ltr",e.next=5,n(33)("./".concat($t.data));case 5:Qt=e.sent,ln.cacheUserLanguage($t.lng);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),rn=function(){return $t},an=function(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(void 0===e[r])return;e=e[r]}if("string"===typeof e)return e},on=function(e,t){var n=e.split("."),r=an(Qt,n)||an(qt,n);if(void 0===r)throw new Error("Can't find translation for ".concat(e));if(t)for(var a in t)r=r.replace("{{".concat(a,"}}"),t[a]);return r},ln=new Kt.a;ln.init({languageUtils:{formatLanguageCode:function(e){return e},isWhitelisted:function(){return!0}},checkWhitelist:!1});var cn=function(e,t,n,r){var a=r.scrollX,o=r.scrollY,i=r.zoom,l=te(e),c=Object(m.a)(l,4),s=c[0],u=c[1],d=c[2],p=c[3],h=t/i,f=n/i,g=t-h,v=n-f,b={top:parseInt(Bn("sat")),bottom:parseInt(Bn("sab")),left:parseInt(Bn("sal")),right:parseInt(Bn("sar"))},y=rn().rtl,E=g/2-a+b.left,w=v/2-o+b.top,k=E+h-b.right,x=w+f-b.bottom,S=Math.min(s,E),C=Math.min(u,w),O=Math.max(d,k),I=Math.max(p,x);return{horizontal:E===S&&k===O?null:{x:Math.max(b.left,4)+(E-S)/(O-S)*t,y:n-6-Math.max(4,b.bottom),width:(k-E)/(O-S)*t-Math.max(8,b.left+b.right),height:6},vertical:w===C&&x===I?null:{x:y?Math.max(b.left,4):t-6-Math.max(b.right,4),y:(w-C)/(I-C)*n+Math.max(b.top,4),width:6,height:(x-w)/(I-C)*n-Math.max(8,b.top+b.bottom)}}},sn=function(e,t,n){var r=[e.horizontal,e.vertical].map((function(e){return null!=e&&e.x<=t&&t<=e.x+e.width&&e.y<=n&&n<=e.y+e.height})),a=Object(m.a)(r,2),o=a[0],i=a[1];return{isOverEither:o||i,isOverHorizontal:o,isOverVertical:i}},un=function(e,t){return e.some((function(e){return t.selectedElementIds[e.id]}))},dn=function(e,t){return e.filter((function(e){return t.selectedElementIds[e.id]}))},mn=function(e){return Math.floor(e)};var pn=function(e,t,n){if(!e.length)return{scrollX:mn(0),scrollY:mn(0)};var r=window.devicePixelRatio,a=te(e),o=Object(m.a)(a,4),i=o[0],l=o[1],c=o[2],s=o[3];if(function(e,t,n){var r=Object(m.a)(n,4),a=r[0],o=r[1],i=r[2],l=r[3],c=Hn({sceneX:a,sceneY:o},e,t,window.devicePixelRatio),s=c.x,u=c.y,d=Hn({sceneX:i,sceneY:l},e,t,window.devicePixelRatio),p=d.x,h=d.y;return p-s>e.width||h-u>e.height}(t,n,[i,l,c,s])){var u=function(e,t){if(!e.length)return[0,0,0,0];var n=1/0,r=e[0];return e.forEach((function(e){var a=ee(e),o=Object(m.a)(a,4),i=o[0],l=o[1],c=o[2],s=o[3],u=F((i+c)/2,(l+s)/2,t.x,t.y);u<n&&(n=u,r=e)})),ee(r)}(e,Rn({clientX:t.scrollX,clientY:t.scrollY},t,n,r)),d=Object(m.a)(u,4);i=d[0],l=d[1],c=d[2],s=d[3]}var p=(i+c)/2,h=(l+s)/2;return{scrollX:mn(t.width/2-p),scrollY:mn(t.height/2-h)}},hn=function(e){return"rectangle"===e||"ellipse"===e||"diamond"===e||"draw"===e||"line"===e},fn=function(e){return"rectangle"===e||"ellipse"===e||"diamond"===e||"arrow"===e||"draw"===e||"line"===e},gn=function(e){return"text"===e},vn=function(e,t,n,r,a){for(var o=null,i=e.length-1;i>=0;--i)if(!e[i].isDeleted&&Qe(e[i],t,n,r,a)){o=e[i];break}return o},bn=function(e,t){return null===e||null===e.getContext("2d")?{x:0,y:0}:{x:e.width/t/2,y:e.height/t/2}},yn=function(e){var t=parseFloat(e.toFixed(2));return Math.max(.1,Math.min(t,2))},En=new(function(){function e(){Object(h.a)(this,e),this.callbacks=new Set,this.nonDeletedElements=[],this.elements=[],this.elementsMap={}}return Object(f.a)(e,[{key:"getElementsIncludingDeleted",value:function(){return this.elements}},{key:"getElements",value:function(){return this.nonDeletedElements}},{key:"getElement",value:function(e){return this.elementsMap[e]||null}},{key:"getNonDeletedElement",value:function(e){var t=this.getElement(e);return t&&Vt(t)?t:null}},{key:"replaceAllElements",value:function(e){this.elements=e,this.elementsMap=Gt(e),this.nonDeletedElements=Xt(this.elements),this.informMutation()}},{key:"informMutation",value:function(){for(var e=0,t=Array.from(this.callbacks);e<t.length;e++){(0,t[e])()}}},{key:"addCallback",value:function(e){var t=this;if(this.callbacks.has(e))throw new Error;return this.callbacks.add(e),function(){if(!t.callbacks.has(e))throw new Error;t.callbacks.delete(e)}}}]),e}()),wn="http://www.w3.org/2000/svg",kn=null,xn=function(){if(kn)return kn;var e=new Date,t=e.getFullYear(),n="".concat(e.getMonth()+1).padStart(2,"0"),r="".concat(e.getDate()).padStart(2,"0"),a="".concat(e.getHours()).padStart(2,"0"),o="".concat(e.getMinutes()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(r,"-").concat(a).concat(o)},Sn=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},Cn=function(e){return e instanceof HTMLElement&&"wysiwyg"===e.dataset.type||e instanceof HTMLBRElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&("text"===e.type||"number"===e.type)},On=function(e){var t=e.fontFamily;return N[t]},In=function(e){var t=e.fontSize,n=e.fontFamily;return"".concat(t,"px ").concat(On({fontFamily:n}))},jn=function(e,t){var n=document.createElement("div"),r=document.body;n.style.position="absolute",n.style.whiteSpace="pre",n.style.font=t,r.appendChild(n),n.innerText=e.split("\n").map((function(e){return e||" "})).join("\n");var a=n.offsetWidth,o=n.offsetHeight,i=document.createElement("span");i.style.display="inline-block",i.style.overflow="hidden",i.style.width="1px",i.style.height="1px",n.appendChild(i);var l=i.offsetTop+i.offsetHeight;return document.body.removeChild(n),{width:a,height:o,baseline:l}},Tn=function(e,t){var n,r=0,a=function(){for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];n=o,clearTimeout(r),r=window.setTimeout((function(){return e.apply(void 0,o)}),t)};return a.flush=function(){clearTimeout(r),e.apply(void 0,Object(y.a)(n))},a},Mn=function(e){var t=window.getSelection();if(t){var n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}},An=function(){var e=window.getSelection();e&&e.removeAllRanges()},Ln=function(e,t){return Math.abs(e-t)},Dn=function(){document.documentElement.style.cursor=""},Pn=function(e){"selection"===e?Dn():document.documentElement.style.cursor=C},zn=function(){var e;return"HTML"===(null===(e=document.fullscreenElement)||void 0===e?void 0:e.nodeName)},Nn=function(e){var t=/Mac|iPod|iPhone|iPad/.test(window.navigator.platform);return"".concat(t?e.replace(/\bCtrlOrCmd\b/i,"Cmd").replace(/\bAlt\b/i,"Option").replace(/\bDel\b/i,"Delete").replace(/\b(Enter|Return)\b/i,"Enter"):e.replace(/\bCtrlOrCmd\b/i,"Ctrl"))},Rn=function(e,t,n,r){var a=e.clientX,o=e.clientY,i=t.scrollX,l=t.scrollY,c=t.zoom,s=bn(n,r);return{x:s.x+(a-s.x)/c-i,y:s.y+(o-s.y)/c-l}},Hn=function(e,t,n,r){var a=e.sceneX,o=e.sceneY,i=t.scrollX,l=t.scrollY,c=t.zoom,s=bn(n,r);return{x:s.x-(s.x-a-i)*c,y:s.y-(s.y-o-l)*c}},Bn=function(e){return getComputedStyle(document.documentElement).getPropertyValue("--".concat(e))},_n=new RegExp("^[^".concat("A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff","]*[").concat("\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc","]")),Fn=function(e){return _n.test(e)};function Un(e){var t=Object(m.a)(e,2);return{x:t[0],y:t[1]}}var Wn=function(e){Object(v.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(h.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={hasError:!1,sentryEventId:"",localStorage:""},e}return Object(f.a)(r,[{key:"render",value:function(){return this.state.hasError?this.errorSplash():this.props.children}},{key:"componentDidCatch",value:function(e,t){var n=this;Dn();for(var r={},a=0,o=Object.entries(Object(p.a)({},localStorage));a<o.length;a++){var i=Object(m.a)(o[a],2),l=i[0],c=i[1];try{r[l]=JSON.parse(c)}catch(e){r[l]=c}}b.b((function(a){a.setExtras(t);var o=b.a(e);n.setState((function(e){return{hasError:!0,sentryEventId:o,localStorage:JSON.stringify(r)}}))}))}},{key:"selectTextArea",value:function(e){e.target!==document.activeElement&&(e.preventDefault(),e.target.select())}},{key:"createGithubIssue",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="",e.prev=1,e.next=4,n.e(32).then(n.bind(null,160));case 4:r=e.sent.default,t=encodeURIComponent(r(this.state.sentryEventId)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:window.open("https://github.com/excalidraw/excalidraw/issues/new?body=".concat(t));case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"errorSplash",value:function(){var e=this;return i.a.createElement("div",{className:"ErrorSplash"},i.a.createElement("div",{className:"ErrorSplash-messageContainer"},i.a.createElement("div",{className:"ErrorSplash-paragraph bigger align-center"},on("errorSplash.headingMain_pre"),i.a.createElement("button",{onClick:function(){return window.location.reload()}},on("errorSplash.headingMain_button"))),i.a.createElement("div",{className:"ErrorSplash-paragraph align-center"},on("errorSplash.clearCanvasMessage"),i.a.createElement("button",{onClick:function(){try{localStorage.clear(),window.location.reload()}catch(e){console.error(e)}}},on("errorSplash.clearCanvasMessage_button")),i.a.createElement("br",null),i.a.createElement("div",{className:"smaller"},i.a.createElement("span",{role:"img","aria-label":"warning"},"\u26a0\ufe0f"),on("errorSplash.clearCanvasCaveat"),i.a.createElement("span",{role:"img","aria-hidden":"true"},"\u26a0\ufe0f"))),i.a.createElement("div",null,i.a.createElement("div",{className:"ErrorSplash-paragraph"},on("errorSplash.trackedToSentry_pre"),this.state.sentryEventId,on("errorSplash.trackedToSentry_post")),i.a.createElement("div",{className:"ErrorSplash-paragraph"},on("errorSplash.openIssueMessage_pre"),i.a.createElement("button",{onClick:function(){return e.createGithubIssue()}},on("errorSplash.openIssueMessage_button")),on("errorSplash.openIssueMessage_post")),i.a.createElement("div",{className:"ErrorSplash-paragraph"},i.a.createElement("div",{className:"ErrorSplash-details"},i.a.createElement("label",null,on("errorSplash.sceneContent")),i.a.createElement("textarea",{rows:5,onPointerDown:this.selectTextArea,readOnly:!0,value:this.state.localStorage}))))))}}]),r}(i.a.Component),Gn=function(){return i.a.createElement("div",{className:"LoadingMessage"},i.a.createElement("span",null,"Loading scene..."))},Yn=function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={isLoading:!0},e}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nn();case 2:this.setState({isLoading:!1});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.isLoading?i.a.createElement(Gn,null):this.props.children}}]),n}(i.a.Component),Xn=i.a.createContext(!1),Vn=function(e){var t=e.children,n=Object(o.useRef)();n.current||(n.current=window.matchMedia?window.matchMedia("(max-width: 640px), (max-height: 500px) and (max-width: 1000px)"):{matches:!1,addListener:function(){},removeListener:function(){}});var r=Object(o.useState)(n.current.matches),a=Object(m.a)(r,2),l=a[0],c=a[1];return Object(o.useEffect)((function(){var e=function(){return c(n.current.matches)};return n.current.addListener(e),function(){return n.current.removeListener(e)}}),[]),i.a.createElement(Xn.Provider,{value:l},t)};function Kn(){return Object(o.useContext)(Xn)}var qn=n(27),Zn=n(6),Jn=function(){return{isLoading:!1,errorMessage:null,draggingElement:null,resizingElement:null,multiElement:null,editingElement:null,editingLinearElement:null,elementType:"selection",elementLocked:!1,exportBackground:!0,shouldAddWatermark:!1,currentItemStrokeColor:Zn.black,currentItemBackgroundColor:"transparent",currentItemFillStyle:"hachure",currentItemStrokeWidth:1,currentItemStrokeStyle:"solid",currentItemRoughness:1,currentItemOpacity:100,currentItemFontSize:20,currentItemFontFamily:1,currentItemTextAlign:"left",viewBackgroundColor:Zn.white,scrollX:0,scrollY:0,cursorX:0,cursorY:0,cursorButton:"up",scrolledOutside:!1,name:"".concat(on("labels.untitled"),"-").concat(xn()),username:"",isCollaborating:!1,isResizing:!1,isRotating:!1,selectionElement:null,zoom:1,openMenu:null,lastPointerDownWith:"mouse",selectedElementIds:{},previousSelectedElementIds:{},collaborators:new Map,shouldCacheIgnoreZoom:!1,showShortcutsDialog:!1,zenModeEnabled:!1,gridSize:null,editingGroupId:null,selectedGroupIds:{},width:window.innerWidth,height:window.innerHeight,isLibraryOpen:!1}},$n={collaborators:{browser:!1,export:!1},currentItemBackgroundColor:{browser:!0,export:!1},currentItemFillStyle:{browser:!0,export:!1},currentItemFontFamily:{browser:!0,export:!1},currentItemFontSize:{browser:!0,export:!1},currentItemOpacity:{browser:!0,export:!1},currentItemRoughness:{browser:!0,export:!1},currentItemStrokeColor:{browser:!0,export:!1},currentItemStrokeStyle:{browser:!0,export:!1},currentItemStrokeWidth:{browser:!0,export:!1},currentItemTextAlign:{browser:!0,export:!1},cursorButton:{browser:!0,export:!1},cursorX:{browser:!0,export:!1},cursorY:{browser:!0,export:!1},draggingElement:{browser:!1,export:!1},editingElement:{browser:!1,export:!1},editingGroupId:{browser:!0,export:!1},editingLinearElement:{browser:!1,export:!1},elementLocked:{browser:!0,export:!1},elementType:{browser:!0,export:!1},errorMessage:{browser:!1,export:!1},exportBackground:{browser:!0,export:!1},gridSize:{browser:!0,export:!0},height:{browser:!1,export:!1},isCollaborating:{browser:!1,export:!1},isLibraryOpen:{browser:!1,export:!1},isLoading:{browser:!1,export:!1},isResizing:{browser:!1,export:!1},isRotating:{browser:!1,export:!1},lastPointerDownWith:{browser:!0,export:!1},multiElement:{browser:!1,export:!1},name:{browser:!0,export:!1},openMenu:{browser:!0,export:!1},previousSelectedElementIds:{browser:!0,export:!1},resizingElement:{browser:!1,export:!1},scrolledOutside:{browser:!0,export:!1},scrollX:{browser:!0,export:!1},scrollY:{browser:!0,export:!1},selectedElementIds:{browser:!0,export:!1},selectedGroupIds:{browser:!0,export:!1},selectionElement:{browser:!1,export:!1},shouldAddWatermark:{browser:!0,export:!1},shouldCacheIgnoreZoom:{browser:!0,export:!1},showShortcutsDialog:{browser:!1,export:!1},username:{browser:!0,export:!1},viewBackgroundColor:{browser:!0,export:!0},width:{browser:!1,export:!1},zenModeEnabled:{browser:!0,export:!1},zoom:{browser:!0,export:!1}},Qn=function(e,t){var n,r={},a=Object(k.a)(Object.keys(e));try{for(a.s();!(n=a.n()).done;){var o=n.value;$n[o][t]&&(r[o]=e[o])}}catch(i){a.e(i)}finally{a.f()}return r},er=function(e){return Qn(e,"browser")},tr=function(e){return Qn(e,"export")},nr=function(e,t,n,r,a,o){e.beginPath(),e.moveTo(t+o,n),e.lineTo(t+r-o,n),e.quadraticCurveTo(t+r,n,t+r,n+o),e.lineTo(t+r,n+a-o),e.quadraticCurveTo(t+r,n+a,t+r-o,n+a),e.lineTo(t+o,n+a),e.quadraticCurveTo(t,n+a,t,n+a-o),e.lineTo(t,n+o),e.quadraticCurveTo(t,n,t+o,n),e.closePath(),e.fill(),e.stroke()},rr=function(e){return[Zn.red[e],Zn.pink[e],Zn.grape[e],Zn.violet[e],Zn.indigo[e],Zn.blue[e],Zn.cyan[e],Zn.teal[e],Zn.green[e],Zn.lime[e],Zn.yellow[e],Zn.orange[e]]},ar={canvasBackground:[Zn.white,Zn.gray[0],Zn.gray[1]].concat(Object(y.a)(rr(0))),elementBackground:["transparent",Zn.gray[4],Zn.gray[6]].concat(Object(y.a)(rr(6))),elementStroke:[Zn.black,Zn.gray[8],Zn.gray[7]].concat(Object(y.a)(rr(9)))},or=function(e){var t=e.split("").reduce((function(e,t){return e+t.charCodeAt(0)}),0),n=ar.elementBackground.slice(1),r=ar.elementStroke.slice(1);return{background:n[t%n.length],stroke:r[t%r.length]}},ir=function(){function e(t){Object(h.a)(this,e),this.elementId=void 0,this.activePointIndex=void 0,this.draggingElementPointIndex=void 0,this.lastUncommittedPoint=void 0,e.normalizePoints(t),this.elementId=t.id,this.activePointIndex=null,this.lastUncommittedPoint=null,this.draggingElementPointIndex=null}return Object(f.a)(e,null,[{key:"getElement",value:function(e){var t=En.getNonDeletedElement(e);return t||null}},{key:"handlePointDragging",value:function(t,n,r,a,o,i){var l,c;if(!t.editingLinearElement)return!1;var s=t.editingLinearElement,u=s.draggingElementPointIndex,d=s.elementId,h=e.getElement(d);if(!h)return!1;var f=null!==(l=u)&&void 0!==l?l:e.getPointIndexUnderCursor(h,t.zoom,r,a);if((u=null!==(c=u)&&void 0!==c?c:f)>-1){s.draggingElementPointIndex===u&&s.activePointIndex===f||n({editingLinearElement:Object(p.a)({},s,{draggingElementPointIndex:u,activePointIndex:f})});var g=B(r-o,a-i,0,0,-h.angle),v=Object(m.a)(g,2),b=v[0],y=v[1],E=h.points[f];return e.movePoint(h,f,[E[0]+b,E[1]+y]),!0}return!1}},{key:"handlePointerUp",value:function(t){var n=t.elementId,r=t.draggingElementPointIndex,a=e.getElement(n);return a?(null===r||0!==r&&r!==a.points.length-1||!U(a.points)||e.movePoint(a,r,0===r?a.points[a.points.length-1]:a.points[0]),null!==r?Object(p.a)({},t,{draggingElementPointIndex:null}):t):t}},{key:"handlePointerDown",value:function(t,n,r,a,o,i){var l={didAddPoint:!1,hitElement:null};if(!n.editingLinearElement)return l;var c=n.editingLinearElement.elementId,s=e.getElement(c);if(!s)return l;if(t.altKey)return n.editingLinearElement.lastUncommittedPoint||ke(s,{points:[].concat(Object(y.a)(s.points),[e.createPointAt(s,o,i)])}),a.resumeRecording(),r({editingLinearElement:Object(p.a)({},n.editingLinearElement,{activePointIndex:s.points.length-1,lastUncommittedPoint:null})}),l.didAddPoint=!0,l;var u=e.getPointIndexUnderCursor(s,n.zoom,o,i);return u>-1&&(l.hitElement=s),r({editingLinearElement:Object(p.a)({},n.editingLinearElement,{activePointIndex:u>-1?u:null})}),l}},{key:"handlePointerMove",value:function(t,n,r,a){var o=a.elementId,i=a.lastUncommittedPoint,l=e.getElement(o);if(!l)return a;var c=l.points,s=c[c.length-1];if(!t.altKey)return s===i&&e.movePoint(l,c.length-1,"delete"),a;var u=e.createPointAt(l,n,r);return s===i?e.movePoint(l,l.points.length-1,u):e.movePoint(l,"new",u),Object(p.a)({},a,{lastUncommittedPoint:l.points[l.points.length-1]})}},{key:"getPointsGlobalCoordinates",value:function(e){var t=q(e),n=Object(m.a)(t,4),r=n[0],a=n[1],o=n[2],i=n[3],l=(r+o)/2,c=(a+i)/2;return e.points.map((function(t){var n=e.x,r=e.y,a=B(n+t[0],r+t[1],l,c,e.angle),o=Object(m.a)(a,2);return[n=o[0],r=o[1]]}))}},{key:"getPointIndexUnderCursor",value:function(e,t,n,r){for(var a=this.getPointsGlobalCoordinates(e),o=a.length;--o>-1;){var i=a[o];if(F(n,r,i[0],i[1])*t<this.POINT_HANDLE_SIZE/2+1)return o}return-1}},{key:"createPointAt",value:function(e,t,n){var r=q(e),a=Object(m.a)(r,4),o=a[0],i=a[1],l=a[2],c=a[3],s=B(t,n,(o+l)/2,(i+c)/2,-e.angle),u=Object(m.a)(s,2),d=u[0],p=u[1];return[d-e.x,p-e.y]}},{key:"normalizePoints",value:function(e){var t=e.points,n=t[0][0],r=t[0][1];ke(e,{points:t.map((function(e,t){return[e[0]-n,e[1]-r]})),x:e.x+n,y:e.y+r})}},{key:"movePoint",value:function(e,t,n){var r,a=e.points,o=0,i=0;if("delete"===n){if("new"===t)throw new Error("invalid args in movePoint");(r=a.slice()).splice(t,1),0===t&&(o=r[0][0],i=r[0][1],r=r.map((function(e,t){return 0===t?[0,0]:[e[0]-o,e[1]-i]})))}else if("new"===t)r=[].concat(Object(y.a)(a),[n]);else{var l=n[0]-a[t][0],c=n[1]-a[t][1];r=a.map((function(e,n){return n===t?0===n?(o=l,i=c,e):(o=0,i=0,[e[0]+l,e[1]+c]):o||i?[e[0]-o,e[1]-i]:e}))}var s=re(e,r),u=re(e,a),d=(s[0]+s[2])/2,m=(s[1]+s[3])/2,p=(u[0]+u[2])/2,h=(u[1]+u[3])/2,f=B(o,i,p-d,h-m,e.angle);ke(e,{points:r,x:e.x+f[0],y:e.y+f[1]})}}]),e}();ir.POINT_HANDLE_SIZE=20;var lr=function(e,t,n,r,a,o,i,l,c){e.translate(o,i),e.rotate(l),c&&e.fillRect(t-o,n-i,r,a),e.strokeRect(t-o,n-i,r,a),e.rotate(-l),e.translate(-o,-i)},cr=function(e,t,n,r,a){e.beginPath(),e.arc(t+r/2,n+a/2,r/2,0,2*Math.PI),e.fill(),e.stroke()},sr=function(e,t,n,r,a,o){var i=e.strokeStyle;e.strokeStyle="rgba(0,0,0,0.1)",e.beginPath();for(var l=n;l<n+a+2*t;l+=t)e.moveTo(l,r-t),e.lineTo(l,r+o+2*t);for(var c=r;c<r+o+2*t;c+=t)e.moveTo(n-t,c),e.lineTo(n+a+2*t,c);e.stroke(),e.strokeStyle=i},ur=function(e,t,n,r){e.translate(n.scrollX,n.scrollY);var a=e.strokeStyle,o=e.lineWidth;e.lineWidth=1/n.zoom,ir.getPointsGlobalCoordinates(r).forEach((function(r,a){var o;e.strokeStyle="red",e.setLineDash([]),e.fillStyle=(null===(o=t.editingLinearElement)||void 0===o?void 0:o.activePointIndex)===a?"rgba(255, 127, 127, 0.9)":"rgba(255, 255, 255, 0.9)";var i=ir.POINT_HANDLE_SIZE;cr(e,r[0]-i/2/n.zoom,r[1]-i/2/n.zoom,i/n.zoom,i/n.zoom)})),e.setLineDash([]),e.lineWidth=o,e.translate(-n.scrollX,-n.scrollY),e.strokeStyle=a},dr=function(e,t,n,r,a,o,i){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},c=l.renderScrollbars,s=void 0===c||c,u=l.renderSelection,d=void 0===u||u,p=l.renderOptimizations,h=void 0!==p&&p,f=l.renderGrid,g=void 0===f||f;if(!o)return{atLeastOneVisibleElement:!1};var v=o.getContext("2d");v.scale(r,r);var b=o.width/r,E=o.height/r;if("string"===typeof i.viewBackgroundColor){var x="transparent"===i.viewBackgroundColor||5===i.viewBackgroundColor.length||9===i.viewBackgroundColor.length||/(hsla|rgba)\(/.test(i.viewBackgroundColor);x&&v.clearRect(0,0,b,E);var S=v.fillStyle;v.fillStyle=i.viewBackgroundColor,v.fillRect(0,0,b,E),v.fillStyle=S}else v.clearRect(0,0,b,E);var C=-b*(i.zoom-1)/2,O=-E*(i.zoom-1)/2;v.translate(C,O),v.scale(i.zoom,i.zoom),g&&t.gridSize&&sr(v,t.gridSize,-Math.ceil(C/i.zoom/t.gridSize)*t.gridSize+i.scrollX%t.gridSize,-Math.ceil(O/i.zoom/t.gridSize)*t.gridSize+i.scrollY%t.gridSize,b/i.zoom,E/i.zoom);var I,j=e.filter((function(e){return mr(e,b,E,i)}));if(j.forEach((function(e){he(e,a,v,h,i),w(e)&&t.editingLinearElement&&t.editingLinearElement.elementId===e.id&&ur(v,t,i,e)})),n&&he(n,a,v,h,i),d&&!t.multiElement&&!t.editingLinearElement){v.translate(i.scrollX,i.scrollY);var T=e.reduce((function(e,n){var r=[];if(t.selectedElementIds[n.id]&&!Me(t,n)&&r.push(Zn.black),i.remoteSelectedElementIds[n.id]&&r.push.apply(r,Object(y.a)(i.remoteSelectedElementIds[n.id].map((function(e){return or(e).background})))),r.length){var a=q(n),o=Object(m.a)(a,4),l=o[0],c=o[1],s=o[2],u=o[3];e.push({angle:n.angle,elementX1:l,elementY1:c,elementX2:s,elementY2:u,selectionColors:r})}return e}),[]);function M(t){var n=Pe(e,t),r=te(n),a=Object(m.a)(r,4),o=a[0],i=a[1],l=a[2],c=a[3];T.push({angle:0,elementX1:o,elementX2:l,elementY1:i,elementY2:c,selectionColors:[Zn.black]})}var A,L=Object(k.a)(Ae(t));try{for(L.s();!(A=L.n()).done;){var D=A.value;M(D)}}catch(ve){L.e(ve)}finally{L.f()}t.editingGroupId&&M(t.editingGroupId),T.forEach((function(e){var t=e.angle,n=e.elementX1,r=e.elementY1,a=e.elementX2,o=e.elementY2,l=e.selectionColors,c=a-n,s=o-r,u=v.getLineDash(),d=v.lineWidth,m=v.lineDashOffset,p=v.strokeStyle,h=4/i.zoom,f=8/i.zoom,g=4/i.zoom;v.lineWidth=1/i.zoom;for(var b=l.length,y=0;y<b;++y)v.strokeStyle=l[y],v.setLineDash([f,g+(f+g)*(b-1)]),v.lineDashOffset=(f+g)*y,lr(v,n-h,r-h,c+2*h,s+2*h,n+c/2,r+s/2,t);v.lineDashOffset=m,v.strokeStyle=p,v.lineWidth=d,v.setLineDash(u)})),v.translate(-i.scrollX,-i.scrollY);var P=dn(e,t);if(1===P.length){v.translate(i.scrollX,i.scrollY),v.fillStyle=Zn.white;var z=Ze(P[0],i.zoom);Object.keys(z).forEach((function(e){var t=z[e];if(void 0!==t){var n=v.lineWidth;v.lineWidth=1/i.zoom,"rotation"===e?cr(v,t[0],t[1],t[2],t[3]):lr(v,t[0],t[1],t[2],t[3],t[0]+t[2]/2,t[1]+t[3]/2,P[0].angle,!0),v.lineWidth=n}})),v.translate(-i.scrollX,-i.scrollY)}else if(P.length>1){var N=4/i.zoom;v.translate(i.scrollX,i.scrollY),v.fillStyle=Zn.white;var R=te(P),H=Object(m.a)(R,4),B=H[0],_=H[1],F=H[2],U=H[3],W=v.getLineDash();v.setLineDash([2/i.zoom]);var G=v.lineWidth;v.lineWidth=1/i.zoom,lr(v,B-N,_-N,F-B+2*N,U-_+2*N,(B+F)/2,(_+U)/2,0),v.lineWidth=G,v.setLineDash(W);var Y=qe([B,_,F,U],0,i.zoom,void 0,Ge);Object.keys(Y).forEach((function(e){var t=Y[e];if(void 0!==t){var n=v.lineWidth;v.lineWidth=1/i.zoom,lr(v,t[0],t[1],t[2],t[3],t[0]+t[2]/2,t[1]+t[3]/2,0,!0),v.lineWidth=n}})),v.translate(-i.scrollX,-i.scrollY)}}for(var X in v.scale(1/i.zoom,1/i.zoom),v.translate(-C,-O),i.remotePointerViewportCoords){var V=i.remotePointerViewportCoords[X],K=V.x,Z=V.y,J=i.remotePointerUsernames[X],$=9,Q=14,ee=K<0||K>b-$||Z<0||Z>E-Q;K=Math.max(K,0),K=Math.min(K,b-$),Z=Math.max(Z,0),Z=Math.min(Z,E-Q);var ne=or(X),re=ne.background,ae=ne.stroke,oe=v.strokeStyle,ie=v.fillStyle,le=v.globalAlpha;if(v.strokeStyle=ae,v.fillStyle=re,ee&&(v.globalAlpha=.2),i.remotePointerButton&&"down"===i.remotePointerButton[X]&&(v.beginPath(),v.arc(K,Z,15,0,2*Math.PI,!1),v.lineWidth=3,v.strokeStyle="#ffffff88",v.stroke(),v.closePath(),v.beginPath(),v.arc(K,Z,15,0,2*Math.PI,!1),v.lineWidth=1,v.strokeStyle=ae,v.stroke(),v.closePath()),v.beginPath(),v.moveTo(K,Z),v.lineTo(K+1,Z+14),v.lineTo(K+4,Z+9),v.lineTo(K+9,Z+10),v.lineTo(K,Z),v.fill(),v.stroke(),!ee&&J){var ce=K+$,se=Z+Q,ue=4,de=4,me=v.measureText(J),pe=me.actualBoundingBoxDescent+me.actualBoundingBoxAscent;v.fillStyle=ae,v.globalAlpha=le,v.fillRect(ce-1,se-1,me.width+2*ue+2,pe+2*de+2),v.fillStyle=re,v.fillRect(ce,se,me.width+2*ue,pe+2*de),v.fillStyle=Zn.white,v.fillText(J,ce+ue,se+de+me.actualBoundingBoxAscent)}v.strokeStyle=oe,v.fillStyle=ie,v.globalAlpha=le,v.closePath()}if(s){I=cn(e,b,E,i);var fe=v.fillStyle,ge=v.strokeStyle;v.fillStyle="rgba(0,0,0,0.3)",v.strokeStyle="rgba(255,255,255,0.8)",[I.horizontal,I.vertical].forEach((function(e){e&&nr(v,e.x,e.y,e.width,e.height,3)})),v.fillStyle=fe,v.strokeStyle=ge}return v.scale(1/r,1/r),{atLeastOneVisibleElement:j.length>0,scrollBars:I}},mr=function(e,t,n,r){var a=r.scrollX,o=r.scrollY,i=r.zoom,l=ee(e),c=Object(m.a)(l,4),s=c[0],u=c[1],d=c[2],p=c[3],h=t/i,f=n/i,g=t-h,v=n-f;return d+a-g/2>=0&&s+a-g/2<=h&&p+o-v/2>=0&&u+o-v/2<=f},pr=function(e,t,n){var r=n.exportBackground,a=n.exportPadding,o=void 0===a?10:a,i=n.viewBackgroundColor,l=n.scale,c=void 0===l?1:l,s=n.shouldAddWatermark,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e,t){var n=document.createElement("canvas");return n.width=e*c,n.height=t*c,n};return function(){var n=e;if(s){var a=te(e),l=Object(m.a)(a,4),d=l[2],p=l[3];n=[].concat(Object(y.a)(n),[fr(d,p)])}var h=te(n),f=Object(m.a)(h,4),g=f[0],v=f[1],b=f[2],E=f[3],w=Ln(g,b)+2*o,k=Ln(v,E)+o+(s?0:o),x=u(w,k);return dr(n,t,null,c,V.a.canvas(x),x,{viewBackgroundColor:r?i:null,scrollX:mn(-g+o),scrollY:mn(-v+o),zoom:1,remotePointerViewportCoords:{},remoteSelectedElementIds:{},shouldCacheIgnoreZoom:!1,remotePointerUsernames:{}},{renderScrollbars:!1,renderSelection:!1,renderOptimizations:!1,renderGrid:!1}),x}()},hr=function(e,t){var n=t.exportBackground,r=t.exportPadding,a=void 0===r?10:r,o=t.viewBackgroundColor,i=t.shouldAddWatermark,l=e;if(i){var c=te(e),s=Object(m.a)(c,4),u=s[2],d=s[3];l=[].concat(Object(y.a)(l),[fr(u,d)])}var p=te(l),h=Object(m.a)(p,4),f=h[0],g=h[1],v=h[2],b=h[3],E=Ln(f,v)+2*a,w=Ln(g,b)+a+(i?0:a),k=document.createElementNS(wn,"svg");if(k.setAttribute("version","1.1"),k.setAttribute("xmlns",wn),k.setAttribute("viewBox","0 0 ".concat(E," ").concat(w)),k.innerHTML="\n  ".concat("\x3c!-- svg-source:excalidraw --\x3e",'\n  <defs>\n    <style>\n      @font-face {\n        font-family: "Virgil";\n        src: url("https://excalidraw.com/FG_Virgil.woff2");\n      }\n      @font-face {\n        font-family: "Cascadia";\n        src: url("https://excalidraw.com/Cascadia.woff2");\n      }\n    </style>\n  </defs>\n  '),n&&o){var x=k.ownerDocument.createElementNS(wn,"rect");x.setAttribute("x","0"),x.setAttribute("y","0"),x.setAttribute("width","".concat(E)),x.setAttribute("height","".concat(w)),x.setAttribute("fill",o),k.appendChild(x)}return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=r.offsetX,o=void 0===a?0:a,i=r.offsetY,l=void 0===i?0:i;n&&e.forEach((function(e){e.isDeleted||fe(e,t,n,e.x+o,e.y+l)}))}(l,V.a.svg(k),k,{offsetX:-f+a,offsetY:-g+a}),k},fr=function(e,t){return Be({text:on("labels.madeWithExcalidraw"),fontSize:16,fontFamily:1,textAlign:"right",verticalAlign:"top",x:e,y:t+16,strokeColor:Zn.gray[5],backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",roughness:1,opacity:100})},gr=n(18);function vr(e){var t=/^[$\u20ac\xa3\xa5\u20a9]?([0-9]+(\.[0-9]+)?)$/.exec(e);return t?parseFloat(t[1]):null}function br(e,t){return e.slice(1).every((function(e){return null!==vr(e[t])}))}function yr(e){var t=e[0].length;if(t>2)return{type:"malformed spreadsheet",error:on("charts.tooManyColumns")};if(1===t){if(!br(e,0))return{type:"not a spreadsheet"};var n=null===vr(e[0][0]),r=(n?e.slice(1):e).map((function(e){return vr(e[0])}));return r.length<2?{type:"not a spreadsheet"}:{type:"spreadsheet",spreadsheet:{yAxisLabel:n?e[0][0]:null,labels:null,values:r}}}var a=br(e,0)?0:1;if(!br(e,a))return{type:"malformed spreadsheet",error:on("charts.noNumericColumn")};var o=(a+1)%2,i=null===vr(e[0][a]),l=i?e.slice(1):e;return l.length<2?{type:"not a spreadsheet"}:{type:"spreadsheet",spreadsheet:{yAxisLabel:i?e[0][a]:null,labels:l.map((function(e){return e[o]})),values:l.map((function(e){return vr(e[a])}))}}}function Er(e){var t=e.trim().split("\n").map((function(e){return e.trim().split("\t")}));if(0===t.length)return{type:"not a spreadsheet"};var n=t[0].length;if(!t.every((function(e){return e.length===n})))return{type:"not a spreadsheet"};var r=yr(t);if("spreadsheet"!==r.type){var a=yr(function(e){for(var t=[],n=0;n<e[0].length;n++){for(var r=[],a=0;a<e.length;a++)r.push(e[a][n]);t.push(r)}return t}(t));if("spreadsheet"===a.type)return a}return r}function wr(e,t,n,r){var a,o=Math.max.apply(Math,Object(y.a)(t.values)),i=Math.min.apply(Math,[0].concat(Object(y.a)(t.values))),l=o-i,c=Be({x:n,y:r+192,strokeColor:e.currentItemStrokeColor,backgroundColor:e.currentItemBackgroundColor,fillStyle:e.currentItemFillStyle,strokeWidth:e.currentItemStrokeWidth,strokeStyle:e.currentItemStrokeStyle,roughness:e.currentItemRoughness,opacity:e.currentItemOpacity,text:i.toLocaleString(),fontSize:16,fontFamily:e.currentItemFontFamily,textAlign:e.currentItemTextAlign,verticalAlign:"top"}),s=Be({x:n,y:r,strokeColor:e.currentItemStrokeColor,backgroundColor:e.currentItemBackgroundColor,fillStyle:e.currentItemFillStyle,strokeWidth:e.currentItemStrokeWidth,strokeStyle:e.currentItemStrokeStyle,roughness:e.currentItemRoughness,opacity:e.currentItemOpacity,text:o.toLocaleString(),fontSize:16,fontFamily:e.currentItemFontFamily,textAlign:e.currentItemTextAlign,verticalAlign:"top"}),u=t.values.map((function(t,a){var o=192*((t-i)/l);return Re({type:"rectangle",x:44*a+36+n,y:192-o+r,width:32,height:o,strokeColor:e.currentItemStrokeColor,backgroundColor:e.currentItemBackgroundColor,fillStyle:e.currentItemFillStyle,strokeWidth:e.currentItemStrokeWidth,strokeStyle:e.currentItemStrokeStyle,roughness:e.currentItemRoughness,opacity:e.currentItemOpacity})})),d=(null===(a=t.labels)||void 0===a?void 0:a.map((function(t,a){var o=44*a+36+12;return Be({text:t.length>8?"".concat(t.slice(0,5),"..."):t,x:n+o,y:r+204,strokeColor:e.currentItemStrokeColor,backgroundColor:e.currentItemBackgroundColor,fillStyle:e.currentItemFillStyle,strokeWidth:e.currentItemStrokeWidth,strokeStyle:e.currentItemStrokeStyle,roughness:e.currentItemRoughness,opacity:e.currentItemOpacity,fontSize:16,fontFamily:e.currentItemFontFamily,textAlign:"center",verticalAlign:"top",width:32,angle:5.87})})))||[],m=t.yAxisLabel?Be({text:t.yAxisLabel,x:n-36,y:r+96-10,strokeColor:e.currentItemStrokeColor,backgroundColor:e.currentItemBackgroundColor,fillStyle:e.currentItemFillStyle,strokeWidth:e.currentItemStrokeWidth,strokeStyle:e.currentItemStrokeStyle,roughness:e.currentItemRoughness,opacity:e.currentItemOpacity,fontSize:20,fontFamily:e.currentItemFontFamily,textAlign:"center",verticalAlign:"top",width:32,angle:5.87}):null;return[].concat(Object(y.a)(u),[m,c,s],Object(y.a)(d)).filter((function(e){return null!==e}))}var kr="",xr=!1,Sr="clipboard"in navigator&&"readText"in navigator.clipboard,Cr="clipboard"in navigator&&"writeText"in navigator.clipboard,Or="clipboard"in navigator&&"write"in navigator.clipboard&&"ClipboardItem"in window&&"toBlob"in HTMLCanvasElement.prototype,Ir=function(){var e=Object(d.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return kr=JSON.stringify(dn(t,n)),e.prev=1,e.next=4,Lr(null);case 4:xr=!1,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),xr=!0;case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}(),jr=function(){if(!kr)return{};try{var e=JSON.parse(kr);if(Array.isArray(e)&&e.length>0&&e[0].type)return{elements:e}}catch(t){console.error(t)}return{}},Tr=function(){var e=Object(d.a)(u.a.mark((function e(t,n,r,a){var o,i,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!a){e.next=5;break}e.t0=null===(o=a.clipboardData)||void 0===o?void 0:o.getData("text/plain").trim(),e.next=11;break;case 5:if(e.t1=Sr,!e.t1){e.next=10;break}return e.next=9,navigator.clipboard.readText();case 9:e.t1=e.sent;case 10:e.t0=e.t1;case 11:if(!(i=e.t0)||xr||i.includes("\x3c!-- svg-source:excalidraw --\x3e")){e.next=21;break}if("spreadsheet"!==(l=Er(i)).type){e.next=18;break}return e.abrupt("return",{elements:wr(t,l.spreadsheet,n,r)});case 18:if("malformed spreadsheet"!==l.type){e.next=20;break}return e.abrupt("return",{error:l.error});case 20:return e.abrupt("return",{text:i});case 21:e.next=26;break;case 23:e.prev=23,e.t2=e.catch(0),console.error(e.t2);case 26:return e.abrupt("return",jr());case 27:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Mr=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){try{t.toBlob(function(){var t=Object(d.a)(u.a.mark((function t(r){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.clipboard.write([new window.ClipboardItem({"image/png":r})]);case 3:e(),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),n(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}())}catch(r){n(r)}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ar=function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(t.outerHTML);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),Lr=function(){var e=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!1,!Cr){e.next=11;break}return e.prev=2,e.next=5,navigator.clipboard.writeText(t||"");case 5:n=!0,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0);case 11:if(n||Dr(t||" ")){e.next=13;break}throw new Error("couldn't copy");case 13:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),Dr=function(e){var t="rtl"===document.documentElement.getAttribute("dir"),n=document.createElement("textarea");n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style[t?"right":"left"]="-9999px";var r=window.pageYOffset||document.documentElement.scrollTop;n.style.top="".concat(r,"px"),n.style.fontSize="12pt",n.setAttribute("readonly",""),n.value=e,document.body.appendChild(n);var a=!1;try{n.select(),n.setSelectionRange(0,n.value.length),a=document.execCommand("copy")}catch(o){console.error(o)}return n.remove(),a};function Pr(e,t){var n,r,a,o,i={type:e.type,version:e.version||1,versionNonce:null!==(n=e.versionNonce)&&void 0!==n?n:0,isDeleted:!1,id:e.id||we(),fillStyle:e.fillStyle||"hachure",strokeWidth:e.strokeWidth||1,strokeStyle:null!==(r=e.strokeStyle)&&void 0!==r?r:"solid",roughness:null!==(a=e.roughness)&&void 0!==a?a:1,opacity:null==e.opacity?100:e.opacity,angle:e.angle||0,x:e.x||0,y:e.y||0,strokeColor:e.strokeColor,backgroundColor:e.backgroundColor,width:e.width||0,height:e.height||0,seed:null!==(o=e.seed)&&void 0!==o?o:1,groupIds:e.groupIds||[]};return Object(p.a)({},i,{},Oe(i),{},t)}var zr=function(e){var t;switch(e.type){case"text":var n=e.fontSize,r=e.fontFamily;if("font"in e){var a=e.font.split(" "),o=Object(m.a)(a,2),i=o[0],l=o[1];n=parseInt(i,10),r=function(e){for(var t=0,n=Object.entries(N);t<n.length;t++){var r=Object(m.a)(n[t],2),a=r[0];if(r[1].includes(e))return parseInt(a)}return 1}(l)}return Pr(e,{fontSize:n,fontFamily:r,text:null!==(t=e.text)&&void 0!==t?t:"",baseline:e.baseline,textAlign:e.textAlign||"left",verticalAlign:e.verticalAlign||"top"});case"draw":case"line":case"arrow":return Pr(e,{points:!Array.isArray(e.points)||e.points.length<2?[[0,0],[e.width,e.height]]:e.points});case"ellipse":case"rectangle":case"diamond":return Pr(e,{})}},Nr=function(e,t,n){var r=e.reduce((function(e,t){if("selection"!==t.type&&!Se(t)){var n=zr(t);n&&e.push(n)}return e}),[]);return(null===n||void 0===n?void 0:n.scrollToContent)&&t&&(t=Object(p.a)({},t,{},pn(r,t,null))),{elements:r,appState:t}},Rr=function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r,a,o,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e){var t=Jn(),n=[],r=t;try{var a=JSON.parse(e);if("excalidraw"!==a.type)throw new Error(on("alerts.couldNotLoadInvalidFile"));n=a.elements||[],r=Object(p.a)({},t,{},tr(a.appState))}catch(o){throw new Error(on("alerts.couldNotLoadInvalidFile"))}return{elements:n,appState:r}},t.handle&&(window.handle=t.handle),!("text"in Blob)){e.next=8;break}return e.next=5,t.text();case 5:r=e.sent,e.next=11;break;case 8:return e.next=10,new Promise((function(e){var n=new FileReader;n.readAsText(t,"utf8"),n.onloadend=function(){n.readyState===FileReader.DONE&&e(n.result)}}));case 10:r=e.sent;case 11:return a=n(r),o=a.elements,i=a.appState,e.abrupt("return",Nr(o,i,{scrollToContent:!0}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Hr=function(e,t){return JSON.stringify({type:"excalidraw",version:2,source:window.location.origin,elements:e.filter((function(e){return!e.isDeleted})),appState:tr(t)},null,2)},Br=function(){var e=Object(d.a)(u.a.mark((function e(t,n,r){var a,o,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Hr(t,n),o=new Blob([a],{type:"application/json"}),i="".concat(n.name,".excalidraw"),e.next=5,Object(gr.b)(o,{fileName:i,description:"Excalidraw file",extensions:["excalidraw"]},r||null);case 5:window.handle=e.sent;case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),_r=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(gr.a)({description:"Excalidraw files",extensions:["json","excalidraw"],mimeTypes:["application/json"]});case 2:return t=e.sent,e.abrupt("return",Rr(t));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Fr=null,Ur=function(){return new Promise(function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Fr){e.next=2;break}return e.abrupt("return",t(JSON.parse(JSON.stringify(Fr))));case 2:if(e.prev=2,n=localStorage.getItem("excalidraw-library")){e.next=6;break}return e.abrupt("return",t([]));case 6:r=JSON.parse(n).map((function(e){return Nr(e,null).elements})),Fr=JSON.parse(JSON.stringify(r)),t(r),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),console.error(e.t0),t([]);case 15:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}())},Wr=function(e){var t=Fr;try{var n=JSON.stringify(e);Fr=JSON.parse(n),localStorage.setItem("excalidraw-library",n)}catch(r){Fr=t,console.error(r)}},Gr=function(){var e=null,t=null;try{e=localStorage.getItem("excalidraw"),t=localStorage.getItem("excalidraw-state")}catch(a){console.error(a)}var n=[];if(e)try{n=JSON.parse(e)}catch(a){console.error(a)}var r=null;if(t)try{r=Object(p.a)({},Jn(),{},er(JSON.parse(t)))}catch(a){console.error(a)}return Nr(n,r)};window.handle=null;var Yr,Xr=function(e){return"0".concat(e.toString(16)).slice(-2)},Vr=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Uint8Array(10),window.crypto.getRandomValues(t),e.abrupt("return",Array.from(t,Xr).join(""));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Kr=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"AES-GCM",length:128},!0,["encrypt","decrypt"]);case 2:return t=e.sent,e.next=5,window.crypto.subtle.exportKey("jwk",t);case 5:return e.abrupt("return",e.sent.k);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qr=function(){var e=new Uint8Array(12);return window.crypto.getRandomValues(e)},Zr=function(e){if(0!==e.length)return new URL(e).hash.match(/^#room=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/)},Jr=function(){var e=Object(d.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Vr();case 2:return t=e.sent,e.next=5,Kr();case 5:return n=e.sent,e.abrupt("return","".concat(window.location.origin).concat(window.location.pathname,"#room=").concat(t,",").concat(n));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$r=function(e,t){return window.crypto.subtle.importKey("jwk",{alg:"A128GCM",ext:!0,k:e,key_ops:["encrypt","decrypt"],kty:"oct"},{name:"AES-GCM",length:128},!1,[t])},Qr=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$r(n,"encrypt");case 2:return r=e.sent,a=qr(),e.next=6,window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},r,t);case 6:return e.t0=e.sent,e.t1=a,e.abrupt("return",{data:e.t0,iv:e.t1});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ea=function(){var e=Object(d.a)(u.a.mark((function e(t,n,r){var a,o,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$r(n,"decrypt");case 3:return a=e.sent,e.next=6,window.crypto.subtle.decrypt({name:"AES-GCM",iv:r},a,t);case 6:return o=e.sent,i=new TextDecoder("utf-8").decode(new Uint8Array(o)),e.abrupt("return",JSON.parse(i));case 11:e.prev=11,e.t0=e.catch(0),window.alert(on("alerts.decryptFailed")),console.error(e.t0);case 15:return e.abrupt("return",{type:"INVALID_RESPONSE"});case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n,r){return e.apply(this,arguments)}}(),ta=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var r,a,o,i,l,c,s,d,m,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Hr(t,n),a=(new TextEncoder).encode(r),e.next=4,window.crypto.subtle.generateKey({name:"AES-GCM",length:128},!0,["encrypt","decrypt"]);case 4:return o=e.sent,i=new Uint8Array(12),e.next=8,window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,a);case 8:return l=e.sent,e.next=11,window.crypto.subtle.exportKey("jwk",o);case 11:return c=e.sent,e.prev=12,e.next=15,fetch("https://json.excalidraw.com/api/v2/post/",{method:"POST",body:l});case 15:return s=e.sent,e.next=18,s.json();case 18:(d=e.sent).id?((m=new URL(window.location.href)).hash="json=".concat(d.id,",").concat(c.k),p=m.toString(),window.prompt("\ud83d\udd12".concat(on("alerts.uploadedSecurly")),p)):window.alert(on("alerts.couldNotCreateShareableLink")),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(12),console.error(e.t0),window.alert(on("alerts.couldNotCreateShareableLink"));case 26:case"end":return e.stop()}}),e,null,[[12,22]])})));return function(t,n){return e.apply(this,arguments)}}(),na=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var r,a,o,i,l,c,s,d,m;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],a=Jn(),e.prev=2,e.next=5,fetch(n?"".concat("https://json.excalidraw.com/api/v2/").concat(t):"".concat("https://json.excalidraw.com/api/v1/").concat(t,".json"));case 5:if((o=e.sent).ok){e.next=9;break}return window.alert(on("alerts.importBackendFailed")),e.abrupt("return",Nr(r,a,{scrollToContent:!0}));case 9:if(!n){e.next=24;break}return e.next=12,o.arrayBuffer();case 12:return l=e.sent,e.next=15,$r(n,"decrypt");case 15:return c=e.sent,s=new Uint8Array(12),e.next=19,window.crypto.subtle.decrypt({name:"AES-GCM",iv:s},c,l);case 19:d=e.sent,m=new window.TextDecoder("utf-8").decode(new Uint8Array(d)),i=JSON.parse(m),e.next=27;break;case 24:return e.next=26,o.json();case 26:i=e.sent;case 27:r=i.elements||r,a=Object(p.a)({},a,{},i.appState),e.next=35;break;case 31:e.prev=31,e.t0=e.catch(2),window.alert(on("alerts.importBackendFailed")),console.error(e.t0);case 35:return e.prev=35,e.abrupt("return",Nr(r,a,{scrollToContent:!0}));case 38:case"end":return e.stop()}}),e,null,[[2,31,35,38]])})));return function(t,n){return e.apply(this,arguments)}}(),ra=function(){var e=Object(d.a)(u.a.mark((function e(t,n,r,a,o){var i,l,c,s,m,h,f,g,v,b,y;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.exportBackground,l=o.exportPadding,c=void 0===l?10:l,s=o.viewBackgroundColor,m=o.name,h=o.scale,f=void 0===h?1:h,g=o.shouldAddWatermark,0!==n.length){e.next=3;break}return e.abrupt("return",window.alert(on("alerts.cannotExportEmptyCanvas")));case 3:if("svg"!==t&&"clipboard-svg"!==t){e.next=14;break}if(v=hr(n,{exportBackground:i,viewBackgroundColor:s,exportPadding:c,shouldAddWatermark:g}),"svg"!==t){e.next=11;break}return e.next=8,Object(gr.b)(new Blob([v.outerHTML],{type:"image/svg+xml"}),{fileName:"".concat(m,".svg")});case 8:return e.abrupt("return");case 11:if("clipboard-svg"!==t){e.next=14;break}return Ar(v),e.abrupt("return");case 14:if((b=pr(n,r,{exportBackground:i,viewBackgroundColor:s,exportPadding:c,scale:f,shouldAddWatermark:g})).style.display="none",document.body.appendChild(b),"png"===t)y="".concat(m,".png"),b.toBlob(function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,Object(gr.b)(t,{fileName:y});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());else if("clipboard"===t)try{Mr(b)}catch(E){window.alert(on("alerts.couldNotCopyToClipboard"))}else"backend"===t&&ta(n,Object(p.a)({},r,{viewBackgroundColor:i?r.viewBackgroundColor:Jn().viewBackgroundColor}));b!==a&&b.remove();case 19:case"end":return e.stop()}}),e)})));return function(t,n,r,a,o){return e.apply(this,arguments)}}(),aa=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t){e.next=6;break}return e.next=3,na(t,n);case 3:r=e.sent,e.next=7;break;case 6:r=Gr();case 7:return e.abrupt("return",{elements:r.elements,appState:r.appState,commitToHistory:!1});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),oa=function(){function e(t){Object(h.a)(this,e),this.app=void 0,this.socket=null,this.socketInitialized=!1,this.roomID=null,this.roomKey=null,this.app=t}return Object(f.a)(e,[{key:"open",value:function(e,t,n){var a=this;this.socket=e,this.roomID=t,this.roomKey=n,this.socket.on("init-room",(function(){a.socket&&(a.socket.emit("join-room",a.roomID),a.app.restoreUserName())})),this.socket.on("new-user",function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.app.broadcastScene(r.INIT,!0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.socket.on("room-user-change",(function(e){a.app.setCollaborators(e)}))}},{key:"close",value:function(){this.socket&&(this.socket.close(),this.socket=null,this.roomID=null,this.roomKey=null)}},{key:"isOpen",value:function(){return!!(this.socketInitialized&&this.socket&&this.roomID&&this.roomKey)}},{key:"_broadcastSocketData",value:function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r,a,o,i=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],!this.isOpen()){e.next=8;break}return r=JSON.stringify(t),a=(new TextEncoder).encode(r),e.next=6,Qr(a,this.roomKey);case 6:o=e.sent,this.socket.emit(n?D:P,this.roomID,o.data,o.iv);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ia=[{icon:i.a.createElement("svg",{viewBox:"0 0 320 512",className:""},i.a.createElement("path",{d:"M302.189 329.126H196.105l55.831 135.993c3.889 9.428-.555 19.999-9.444 23.999l-49.165 21.427c-9.165 4-19.443-.571-23.332-9.714l-53.053-129.136-86.664 89.138C18.729 472.71 0 463.554 0 447.977V18.299C0 1.899 19.921-6.096 30.277 5.443l284.412 292.542c11.472 11.179 3.007 31.141-12.5 31.141z"})),value:"selection",key:"s"},{icon:i.a.createElement("svg",{viewBox:"0 0 448 512"},i.a.createElement("path",{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"})),value:"rectangle",key:"r"},{icon:i.a.createElement("svg",{viewBox:"0 0 223.646 223.646"},i.a.createElement("path",{d:"M111.823 0L16.622 111.823 111.823 223.646 207.025 111.823z"})),value:"diamond",key:"d"},{icon:i.a.createElement("svg",{viewBox:"0 0 512 512"},i.a.createElement("path",{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"})),value:"ellipse",key:"e"},{icon:i.a.createElement("svg",{viewBox:"0 0 448 512",className:"rtl-mirror"},i.a.createElement("path",{d:"M313.941 216H12c-6.627 0-12 5.373-12 12v56c0 6.627 5.373 12 12 12h301.941v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.569 0-33.941l-86.059-86.059c-15.119-15.119-40.971-4.411-40.971 16.971V216z"})),value:"arrow",key:"a"},{icon:i.a.createElement("svg",{viewBox:"0 0 6 6"},i.a.createElement("line",{x1:"0",y1:"3",x2:"6",y2:"3",stroke:Zn.black,strokeLinecap:"round"})),value:"line",key:"l"},{icon:i.a.createElement("svg",{viewBox:"0 0 512 512"},i.a.createElement("path",{fill:"currentColor",d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"})),value:"draw",key:"x"},{icon:i.a.createElement("svg",{viewBox:"0 0 448 512"},i.a.createElement("path",{d:"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z"})),value:"text",key:"t"}],la=ia.map((function(e,t){return[e.key,(t+1).toString()]})).flat(1),ca=function(e){return{selectedElementIds:e.selectedElementIds,viewBackgroundColor:e.viewBackgroundColor,editingLinearElement:e.editingLinearElement,editingGroupId:e.editingGroupId,name:e.name}},sa=function(){function e(){var t=this;Object(h.a)(this,e),this.elementCache=new Map,this.recording=!0,this.stateHistory=[],this.redoStack=[],this.lastEntry=null,this.generateEntry=function(e,n){return t.dehydrateHistoryEntry({appState:ca(e),elements:n.reduce((function(t,n){if(w(n)&&e.multiElement&&e.multiElement.id===n.id){if(e.multiElement&&e.multiElement.id===n.id&&n.points.length<2)return t;t.push(Object(p.a)({},n,{points:n.lastCommittedPoint!==n.points[n.points.length-1]?n.points.slice(0,-1):n.points}))}else t.push(n);return t}),[])})}}return Object(f.a)(e,[{key:"hydrateHistoryEntry",value:function(e){var t=this,n=e.appState,r=e.elements;return{appState:JSON.parse(n),elements:r.map((function(e){var n,r=null===(n=t.elementCache.get(e.id))||void 0===n?void 0:n.get(e.versionNonce);if(!r)throw new Error("Element not found: ".concat(e.id,":").concat(e.versionNonce));return r}))}}},{key:"dehydrateHistoryEntry",value:function(e){var t=this,n=e.appState,r=e.elements;return{appState:JSON.stringify(n),elements:r.map((function(e){t.elementCache.has(e.id)||t.elementCache.set(e.id,new Map);var n=t.elementCache.get(e.id);return n.has(e.versionNonce)||n.set(e.versionNonce,Fe(e)),{id:e.id,versionNonce:e.versionNonce}}))}}},{key:"getSnapshotForTest",value:function(){var e=this;return{recording:this.recording,stateHistory:this.stateHistory.map((function(t){return e.hydrateHistoryEntry(t)})),redoStack:this.redoStack.map((function(t){return e.hydrateHistoryEntry(t)}))}}},{key:"clear",value:function(){this.stateHistory.length=0,this.redoStack.length=0,this.lastEntry=null,this.elementCache.clear()}},{key:"shouldCreateEntry",value:function(e){var t,n=this.lastEntry;if(!n)return!0;if(e.elements.length!==n.elements.length)return!0;for(var r=e.elements.length-1;r>-1;r--){var a=e.elements[r],o=n.elements[r];if(!a||!o||a.id!==o.id||a.versionNonce!==o.versionNonce)return!0}for(t in e.appState){var i,l;if("editingLinearElement"===t)if((null===(i=e.appState[t])||void 0===i?void 0:i.elementId)===(null===(l=n.appState[t])||void 0===l?void 0:l.elementId))continue;if("selectedElementIds"!==t&&e.appState[t]!==n.appState[t])return!0}return!1}},{key:"pushEntry",value:function(e,t){var n=this.generateEntry(e,t),r=this.hydrateHistoryEntry(n);if(r){if(!this.shouldCreateEntry(r))return;this.stateHistory.push(n),this.lastEntry=r,this.clearRedoStack()}}},{key:"clearRedoStack",value:function(){this.redoStack.splice(0,this.redoStack.length)}},{key:"redoOnce",value:function(){if(0===this.redoStack.length)return null;var e=this.redoStack.pop();return void 0!==e?(this.stateHistory.push(e),this.hydrateHistoryEntry(e)):null}},{key:"undoOnce",value:function(){if(1===this.stateHistory.length)return null;var e=this.stateHistory.pop(),t=this.stateHistory[this.stateHistory.length-1];return void 0!==e?(this.redoStack.push(e),this.hydrateHistoryEntry(t)):null}},{key:"setCurrentState",value:function(e,t){this.lastEntry=this.hydrateHistoryEntry(this.generateEntry(e,t))}},{key:"resumeRecording",value:function(){this.recording=!0}},{key:"record",value:function(e,t){this.recording&&(this.pushEntry(e,t),this.recording=!1)}}]),e}(),ua=(n(79),function(e){var t=e.children,n=e.left,r=e.top,a=e.onCloseRequest,c=e.fitInViewport,s=void 0!==c&&c,u=Object(o.useRef)(null);return Object(o.useLayoutEffect)((function(){if(s&&u.current){var e=u.current,t=e.getBoundingClientRect(),n=t.x,r=t.y,a=t.width,o=t.height,i=window.innerWidth;n+a>i&&(e.style.left="".concat(i-a,"px"));var l=window.innerHeight;r+o>l&&(e.style.top="".concat(l-o,"px"))}}),[s]),Object(o.useEffect)((function(){if(a){var e=function(e){var t;(null===(t=u.current)||void 0===t?void 0:t.contains(e.target))||Object(l.unstable_batchedUpdates)((function(){return a(e)}))};return document.addEventListener("pointerdown",e,!1),function(){return document.removeEventListener("pointerdown",e,!1)}}}),[a]),i.a.createElement("div",{className:"popover",style:{top:r,left:n},ref:u},t)}),da=(n(80),function(e){var t=e.options,n=e.onCloseRequest,r=e.top,a=e.left;return i.a.createElement(ua,{onCloseRequest:n,top:r,left:a,fitInViewport:!0},i.a.createElement("ul",{className:"context-menu",onContextMenu:function(e){return e.preventDefault()}},t.map((function(e,t){return i.a.createElement("li",{key:t,onClick:n},i.a.createElement(ma,e))}))))}),ma=function(e){var t=e.label,n=e.action;return i.a.createElement("button",{className:"context-menu-option",onClick:n},t)},pa=function(){if(Yr)return Yr;var e=document.createElement("div");return document.body.appendChild(e),Yr=e},ha=function(){Object(l.unmountComponentAtNode)(pa())},fa=function(e){var t=Array.of();e.options.forEach((function(e){e&&t.push(e)})),t.length&&Object(l.render)(i.a.createElement(da,{top:e.top,left:e.left,options:t,onCloseRequest:ha}),pa())},ga=function(){function e(t,n,r){var a=this;Object(h.a)(this,e),this.actions={},this.updater=void 0,this.getAppState=void 0,this.getElementsIncludingDeleted=void 0,this.renderAction=function(e,t){if(a.actions[e]&&"PanelComponent"in a.actions[e]){var n=a.actions[e],r=n.PanelComponent;return i.a.createElement(r,{elements:a.getElementsIncludingDeleted(),appState:a.getAppState(),updateData:function(e){a.updater(n.perform(a.getElementsIncludingDeleted(),a.getAppState(),e))},id:t})}return null},this.updater=t,this.getAppState=n,this.getElementsIncludingDeleted=r}return Object(f.a)(e,[{key:"registerAction",value:function(e){this.actions[e.name]=e}},{key:"registerAll",value:function(e){var t=this;e.forEach((function(e){return t.registerAction(e)}))}},{key:"handleKeyDown",value:function(e){var t=this,n=Object.values(this.actions).sort((function(e,t){return(t.keyPriority||0)-(e.keyPriority||0)})).filter((function(n){return n.keyTest&&n.keyTest(e,t.getAppState(),t.getElementsIncludingDeleted())}));return 0!==n.length&&(e.preventDefault(),this.updater(n[0].perform(this.getElementsIncludingDeleted(),this.getAppState(),null)),!0)}},{key:"executeAction",value:function(e){this.updater(e.perform(this.getElementsIncludingDeleted(),this.getAppState(),null))}},{key:"getContextMenuItems",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return Object.values(this.actions).filter(t).filter((function(e){return"contextItemLabel"in e})).filter((function(t){return!t.contextItemPredicate||t.contextItemPredicate(e.getElementsIncludingDeleted(),e.getAppState())})).sort((function(e,t){return(void 0!==e.contextMenuOrder?e.contextMenuOrder:999)-(void 0!==t.contextMenuOrder?t.contextMenuOrder:999)})).map((function(t){return{label:t.contextItemLabel?on(t.contextItemLabel):"",action:function(){e.updater(t.perform(e.getElementsIncludingDeleted(),e.getAppState(),null))}}}))}}]),e}(),va=(n(34),i.a.forwardRef((function(e,t){var n=i.a.useRef(null);i.a.useImperativeHandle(t,(function(){return n.current}));var r="ToolIcon_size_".concat(e.size||"m");return"button"===e.type?i.a.createElement("button",{className:"ToolIcon_type_button ".concat(e.hidden?"":"ToolIcon"," ").concat(r).concat(e.selected?" ToolIcon--selected":""," ").concat(e.className," ").concat(e.visible&&!e.hidden?"ToolIcon_type_button--show":"ToolIcon_type_button--hide"),hidden:e.hidden,title:e.title,"aria-label":e["aria-label"],type:"button",onClick:e.onClick,ref:n},i.a.createElement("div",{className:"ToolIcon__icon","aria-hidden":"true"},e.icon||e.label,e.keyBindingLabel&&i.a.createElement("span",{className:"ToolIcon__keybinding"},e.keyBindingLabel)),e.showAriaLabel&&i.a.createElement("div",{className:"ToolIcon__label"},e["aria-label"]),e.children):i.a.createElement("label",{className:"ToolIcon",title:e.title},i.a.createElement("input",{className:"ToolIcon_type_radio ".concat(r),type:"radio",name:e.name,"aria-label":e["aria-label"],"aria-keyshortcuts":e["aria-keyshortcuts"],"data-testid":e["data-testid"],id:e.id,onChange:e.onChange,checked:e.checked,ref:n}),i.a.createElement("div",{className:"ToolIcon__icon"},e.icon,e.keyBindingLabel&&i.a.createElement("span",{className:"ToolIcon__keybinding"},e.keyBindingLabel)))})));va.defaultProps={visible:!0,className:""};var ba=Zn.orange[4],ya=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,n="number"===typeof t?{width:t}:t,r=n.width,a=void 0===r?512:r,o=n.height,l=void 0===o?a:o,c=n.mirror,s=n.style;return i.a.createElement("svg",{"aria-hidden":"true",focusable:"false",role:"img",viewBox:"0 0 ".concat(a," ").concat(l),className:c&&"rtl-mirror",style:s},"string"===typeof e?i.a.createElement("path",{fill:"currentColor",d:e}):e)},Ea=ya("M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z",{mirror:!0}),wa=ya("M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z",{width:448,height:512}),ka=ya("M252 54L203 8a28 27 0 00-20-8H28C12 0 0 12 0 27v195c0 15 12 26 28 26h204c15 0 28-11 28-26V73a28 27 0 00-8-19zM130 213c-21 0-37-16-37-36 0-19 16-35 37-35 20 0 37 16 37 35 0 20-17 36-37 36zm56-169v56c0 4-4 6-7 6H44c-4 0-7-2-7-6V42c0-4 3-7 7-7h133l4 2 3 2a7 7 0 012 5z M296 201l87 95-188 205-78 9c-10 1-19-8-18-20l9-84zm141-14l-41-44a31 31 0 00-46 0l-38 41 87 95 38-42c13-14 13-36 0-50z",{width:448,height:512}),xa=ya("M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z",{width:576,height:512,mirror:!0}),Sa=ya("M384 112v352c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h80c0-35.29 28.71-64 64-64s64 28.71 64 64h80c26.51 0 48 21.49 48 48zM192 40c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24m96 114v-20a6 6 0 0 0-6-6H102a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h180a6 6 0 0 0 6-6z",{width:384,height:512}),Ca=ya("M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z",{width:448,height:512}),Oa=ya("M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"),Ia=ya("M384 121.9c0-6.3-2.5-12.4-7-16.9L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128zM571 308l-95.7-96.4c-10.1-10.1-27.4-3-27.4 11.3V288h-64v64h64v65.2c0 14.3 17.3 21.4 27.4 11.3L571 332c6.6-6.6 6.6-17.4 0-24zm-379 28v-32c0-8.8 7.2-16 16-16h176V160H248c-13.2 0-24-10.8-24-24V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V352H208c-8.8 0-16-7.2-16-16z",{width:576,height:512,mirror:!0}),ja=ya("M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z",{width:448,height:512}),Ta=ya("M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z",{width:448,height:512}),Ma=ya("M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z",{mirror:!0}),Aa=ya("M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"),La=ya("M255.545 8c-66.269.119-126.438 26.233-170.86 68.685L48.971 40.971C33.851 25.851 8 36.559 8 57.941V192c0 13.255 10.745 24 24 24h134.059c21.382 0 32.09-25.851 16.971-40.971l-41.75-41.75c30.864-28.899 70.801-44.907 113.23-45.273 92.398-.798 170.283 73.977 169.484 169.442C423.236 348.009 349.816 424 256 424c-41.127 0-79.997-14.678-110.63-41.556-4.743-4.161-11.906-3.908-16.368.553L89.34 422.659c-4.872 4.872-4.631 12.815.482 17.433C133.798 479.813 192.074 504 256 504c136.966 0 247.999-111.033 248-247.998C504.001 119.193 392.354 7.755 255.545 8z",{mirror:!0}),Da=ya("M256.455 8c66.269.119 126.437 26.233 170.859 68.685l35.715-35.715C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.75c-30.864-28.899-70.801-44.907-113.23-45.273-92.398-.798-170.283 73.977-169.484 169.442C88.764 348.009 162.184 424 256 424c41.127 0 79.997-14.678 110.629-41.556 4.743-4.161 11.906-3.908 16.368.553l39.662 39.662c4.872 4.872 4.631 12.815-.482 17.433C378.202 479.813 319.926 504 256 504 119.034 504 8.001 392.967 8 256.002 7.999 119.193 119.646 7.755 256.455 8z",{mirror:!0}),Pa=ya(i.a.createElement("path",{stroke:"currentColor",strokeWidth:"40",fill:"currentColor",d:"M148 560a318 318 0 0 0 522 110 316 316 0 0 0 0-450 316 316 0 0 0-450 0c-11 11-21 22-30 34v4h47c25 0 46 21 46 46s-21 45-46 45H90c-13 0-25-6-33-14-9-9-14-20-14-33V156c0-25 20-45 45-45s45 20 45 45v32l1 1a401 401 0 0 1 623 509l212 212a42 42 0 0 1-59 59L698 757A401 401 0 0 1 65 570a42 42 0 0 1 83-10z"}),{width:1024}),za=ya(i.a.createElement(i.a.Fragment,null,i.a.createElement("path",{d:"M22 9.556C22 8.696 21.303 8 20.444 8H16v8H8v4.444C8 21.304 8.697 22 9.556 22h10.888c.86 0 1.556-.697 1.556-1.556V9.556z",stroke:Zn.black,strokeWidth:"2"}),i.a.createElement("path",{d:"M16 3.556C16 2.696 15.303 2 14.444 2H3.556C2.696 2 2 2.697 2 3.556v10.888C2 15.304 2.697 16 3.556 16h10.888c.86 0 1.556-.697 1.556-1.556V3.556z",fill:ba,stroke:ba,strokeWidth:"2"})),{width:24}),Na=ya(i.a.createElement(i.a.Fragment,null,i.a.createElement("path",{d:"M16 3.556C16 2.696 15.303 2 14.444 2H3.556C2.696 2 2 2.697 2 3.556v10.888C2 15.304 2.697 16 3.556 16h10.888c.86 0 1.556-.697 1.556-1.556V3.556z",fill:ba,stroke:ba,strokeWidth:"2"}),i.a.createElement("path",{d:"M22 9.556C22 8.696 21.303 8 20.444 8H9.556C8.696 8 8 8.697 8 9.556v10.888C8 21.304 8.697 22 9.556 22h10.888c.86 0 1.556-.697 1.556-1.556V9.556z",stroke:Zn.black,strokeWidth:"2"})),{width:24}),Ra=ya(i.a.createElement(i.a.Fragment,null,i.a.createElement("path",{d:"M13 21a1 1 0 001 1h7a1 1 0 001-1v-7a1 1 0 00-1-1h-3v5h-5v3zM11 3a1 1 0 00-1-1H3a1 1 0 00-1 1v7a1 1 0 001 1h3V6h5V3z",stroke:Zn.black,strokeWidth:"2"}),i.a.createElement("path",{d:"M18 7.333C18 6.597 17.403 6 16.667 6H7.333C6.597 6 6 6.597 6 7.333v9.334C6 17.403 6.597 18 7.333 18h9.334c.736 0 1.333-.597 1.333-1.333V7.333z",fill:ba,stroke:ba,strokeWidth:"2"})),{width:24}),Ha=ya(i.a.createElement(i.a.Fragment,null,i.a.createElement("path",{d:"M18 7.333C18 6.597 17.403 6 16.667 6H7.333C6.597 6 6 6.597 6 7.333v9.334C6 17.403 6.597 18 7.333 18h9.334c.736 0 1.333-.597 1.333-1.333V7.333z",fill:ba,stroke:ba,strokeLinejoin:"round",strokeWidth:"2"}),i.a.createElement("path",{d:"M11 3a1 1 0 00-1-1H3a1 1 0 00-1 1v7a1 1 0 001 1h8V3zM22 14a1 1 0 00-1-1h-7a1 1 0 00-1 1v7a1 1 0 001 1h8v-8z",stroke:Zn.black,strokeLinejoin:"round",strokeWidth:"2"})),{width:24}),Ba=ya("M192 256c61.9 0 112-50.1 112-112S253.9 32 192 32 80 82.1 80 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C51.6 288 0 339.6 0 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zM480 256c53 0 96-43 96-96s-43-96-96-96-96 43-96 96 43 96 96 96zm48 32h-3.8c-13.9 4.8-28.6 8-44.2 8s-30.3-3.2-44.2-8H432c-20.4 0-39.2 5.9-55.7 15.4 24.4 26.3 39.7 61.2 39.7 99.8v38.4c0 2.2-.5 4.3-.6 6.4H592c26.5 0 48-21.5 48-48 0-61.9-50.1-112-112-112z",{width:640,height:512,mirror:!0}),_a=ya("M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"),Fa=ya("M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm96 328c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V176c0-8.8 7.2-16 16-16h160c8.8 0 16 7.2 16 16v160z"),Ua=ya("M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z",{width:352,height:512}),Wa=ya("M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z",{width:320,height:512,style:{marginLeft:"-0.2rem"},mirror:!0}),Ga=ya("M464 0c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48H176c-26.51 0-48-21.49-48-48V48c0-26.51 21.49-48 48-48h288M176 416c-44.112 0-80-35.888-80-80V128H48c-26.51 0-48 21.49-48 48v288c0 26.51 21.49 48 48 48h288c26.51 0 48-21.49 48-48v-48H176z",{mirror:!0}),Ya=ya("M11.553 22.894a.998.998 0 00.894 0s3.037-1.516 5.465-4.097C19.616 16.987 21 14.663 21 12V5a1 1 0 00-.649-.936l-8-3a.998.998 0 00-.702 0l-8 3A1 1 0 003 5v7c0 2.663 1.384 4.987 3.088 6.797 2.428 2.581 5.465 4.097 5.465 4.097zm-1.303-8.481l6.644-6.644a.856.856 0 111.212 1.212l-7.25 7.25a.856.856 0 01-1.212 0l-3.75-3.75a.856.856 0 111.212-1.212l3.144 3.144z",{width:24}),Xa=[],Va=function(e){return Xa=Xa.concat(e),e};function Ka(e,t){if(e.editingGroupId){var n=Pe(Xt(t),e.editingGroupId);if(n.length)return Object(p.a)({},e,{selectedElementIds:Object(je.a)({},n[0].id,!0)})}return e}var qa=Va({name:"deleteSelectedElements",perform:function(e,t){if(t.editingLinearElement){var n=t.editingLinearElement,r=n.elementId,a=n.activePointIndex,o=ir.getElement(r);if(!o)return!1;if(null==a||-1===a||o.points.length<2){var i=e.filter((function(e){return e.id!==o.id})),l=Ka(t,i);return{elements:i,appState:Object(p.a)({},l,{editingLinearElement:null}),commitToHistory:!1}}return ir.movePoint(o,a,"delete"),{elements:e,appState:Object(p.a)({},t,{editingLinearElement:Object(p.a)({},t.editingLinearElement,{activePointIndex:a>0?a-1:0})}),commitToHistory:!0}}var c=function(e,t){return{elements:e.map((function(e){return t.selectedElementIds[e.id]?xe(e,{isDeleted:!0}):e})),appState:Object(p.a)({},t,{selectedElementIds:{}})}}(e,t),s=c.elements,u=c.appState;return u=Ka(u,s),{elements:s,appState:Object(p.a)({},u,{elementType:"selection",multiElement:null}),commitToHistory:un(Xt(e),t)}},contextItemLabel:"labels.delete",contextMenuOrder:3,keyTest:function(e){return e.key===St||e.key===xt},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement(va,{type:"button",icon:Ca,title:on("labels.delete"),"aria-label":on("labels.delete"),onClick:function(){return r(null)},visible:un(Xt(t),n)})}}),Za=function(e,t,n){var r=e[t];e[t]=e[n],e[n]=r},Ja=function(e,t){t.sort((function(e,t){return e-t}));var n=!0;return t.forEach((function(t,r){(n=n&&t===r)||Za(e,t-1,t)})),e},$a=function(e,t){var n=t.sort((function(e,t){return t-e})),r=!0;return n.forEach((function(t,n){(r=r&&t===e.length-n-1)||Za(e,t+1,t)})),e},Qa=function(e,t){t.sort((function(e,t){return e-t}));var n=t.map((function(t){return e[t]})),r=t.reverse().concat([0]);return r.forEach((function(t,n){if(0!==n)for(var a=r[n-1]-1;a>=t;--a)e[a+n]=e[a]})),n.forEach((function(t,n){e[n]=t})),e},eo=function(e,t){var n=t.sort((function(e,t){return t-e})),r=n.map((function(t){return e[t]}));return(t=n.reverse().concat([e.length])).forEach((function(n,r){if(0!==r)for(var a=t[r-1]+1;a<n;++a)e[a-r]=e[a]})),r.forEach((function(t,n){e[e.length-n-1]=t})),e},to=function(e,t,n){var r=t.slice();return e(r,function(e,t,n){var r=[],a=[],o=function(e,t){e.isDeleted?a.push(t):(n.selectedElementIds[e.id]&&r.push.apply(r,Object(y.a)(a).concat([t])),a=[])};if("left"===e)for(var i=-1,l=t.length;++i<l;)o(t[i],i);else for(var c=t.length;--c>-1;)o(t[c],c);return r.sort()}(e===Ja||e===Qa?"left":"right",r,n))},no=(Va({name:"sendBackward",perform:function(e,t){return{elements:to(Ja,e,t),appState:t,commitToHistory:!0}},contextItemLabel:"labels.sendBackward",keyPriority:40,keyTest:function(e){return e[Ct]&&!e.shiftKey&&"BracketLeft"===e.code},PanelComponent:function(e){var t=e.updateData;return i.a.createElement("button",{type:"button",className:"zIndexButton",onClick:function(){return t(null)},title:"".concat(on("labels.sendBackward")," \u2014 ").concat(Nn("CtrlOrCmd+["))},Na)}}),Va({name:"bringForward",perform:function(e,t){return{elements:to($a,e,t),appState:t,commitToHistory:!0}},contextItemLabel:"labels.bringForward",keyPriority:40,keyTest:function(e){return e[Ct]&&!e.shiftKey&&"BracketRight"===e.code},PanelComponent:function(e){var t=e.updateData;return i.a.createElement("button",{type:"button",className:"zIndexButton",onClick:function(){return t(null)},title:"".concat(on("labels.bringForward")," \u2014 ").concat(Nn("CtrlOrCmd+]"))},za)}}),Va({name:"sendToBack",perform:function(e,t){return{elements:to(Qa,e,t),appState:t,commitToHistory:!0}},contextItemLabel:"labels.sendToBack",keyTest:function(e){return gt?e[Ct]&&e.altKey&&"BracketLeft"===e.code:e[Ct]&&e.shiftKey&&"BracketLeft"===e.code},PanelComponent:function(e){var t=e.updateData;return i.a.createElement("button",{type:"button",className:"zIndexButton",onClick:function(){return t(null)},title:"".concat(on("labels.sendToBack")," \u2014 ").concat(Nn(gt?"CtrlOrCmd+Alt+[":"CtrlOrCmd+Shift+["))},Ha)}}),Va({name:"bringToFront",perform:function(e,t){return{elements:to(eo,e,t),appState:t,commitToHistory:!0}},contextItemLabel:"labels.bringToFront",keyTest:function(e){return gt?e[Ct]&&e.altKey&&"BracketRight"===e.code:e[Ct]&&e.shiftKey&&"BracketRight"===e.code},PanelComponent:function(e){var t=e.updateData;return i.a.createElement("button",{type:"button",className:"zIndexButton",onClick:function(e){return t(null)},title:"".concat(on("labels.bringToFront")," \u2014 ").concat(Nn(gt?"CtrlOrCmd+Alt+]":"CtrlOrCmd+Shift+]"))},Ra)}}),Va({name:"selectAll",perform:function(e,t){return!t.editingLinearElement&&{appState:Le(Object(p.a)({},t,{editingGroupId:null,selectedElementIds:e.reduce((function(e,t){return t.isDeleted||(e[t.id]=!0),e}),{})}),Xt(e)),commitToHistory:!0}},contextItemLabel:"labels.selectAll",keyTest:function(e){return e[Ct]&&"a"===e.key}}),Va({name:"duplicateSelection",perform:function(e,t){if(t.editingLinearElement){var n=t.editingLinearElement,r=n.activePointIndex,a=n.elementId,o=ir.getElement(a);if(!o||null===r)return!1;var i=o.points,l=i[r],c=i[r+1];return ke(o,{points:[].concat(Object(y.a)(i.slice(0,r+1)),[c?[(l[0]+c[0])/2,(l[1]+c[1])/2]:[l[0]+30,l[1]+30]],Object(y.a)(i.slice(r+1)))}),{appState:Object(p.a)({},t,{editingLinearElement:Object(p.a)({},t.editingLinearElement,{activePointIndex:r+1})}),elements:e,commitToHistory:!0}}var s=new Map;return{appState:t,elements:e.reduce((function(e,n){if(t.selectedElementIds[n.id]){var r=Ue(t.editingGroupId,s,n,{x:n.x+10,y:n.y+10});return t.selectedElementIds[r.id]=!0,delete t.selectedElementIds[n.id],e.concat([n,r])}return e.concat(n)}),[]),commitToHistory:!0}},contextItemLabel:"labels.duplicateSelection",keyTest:function(e){return e[Ct]&&"d"===e.key},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement(va,{type:"button",icon:Ga,title:"".concat(on("labels.duplicateSelection")," \u2014 ").concat(Nn("CtrlOrCmd+D")),"aria-label":on("labels.duplicateSelection"),onClick:function(){return r(null)},visible:un(Xt(t),n)})}}),function(e){var t=e.options,n=e.value,r=e.onChange,a=e.group;return i.a.createElement("div",{className:"buttonList"},t.map((function(e){return i.a.createElement("label",{key:e.text,className:n===e.value?"active":""},i.a.createElement("input",{type:"radio",name:a,onChange:function(){return r(e.value)},checked:n===e.value}),e.text)})))}),ro=(n(81),function(e){var t=(new Option).style;return t.color=e,!!t.color}),ao=[["1","2","3","4","5"],["q","w","e","r","t"],["a","s","d","f","g"]].flat(),oo=function(e){var t=e.colors,n=e.color,r=e.onChange,a=e.onClose,o=e.label,l=e.showInput,c=void 0===l||l,s=i.a.useRef(),u=i.a.useRef(),d=i.a.useRef(),m=i.a.useRef();i.a.useEffect((function(){u.current?u.current.focus():m.current&&m.current.focus()}),[]);return i.a.createElement("div",{className:"color-picker",role:"dialog","aria-modal":"true","aria-label":on("labels.colorPicker"),onKeyDown:function(e){if(e.key===Ot){var t,n,r=document.activeElement;if(e.shiftKey){if(r===s.current)null===(t=m.current)||void 0===t||t.focus(),e.preventDefault()}else if(r===m.current)null===(n=s.current)||void 0===n||n.focus(),e.preventDefault()}else if(e.key===bt||e.key===vt||e.key===Et||e.key===yt){var o=document.activeElement,i=rn().rtl,l=Array.prototype.indexOf.call(d.current.children,o);if(-1!==l){var u=d.current.children.length-(c?1:0),p=e.key===(i?vt:bt)?(l+1)%u:e.key===(i?bt:vt)?(u+l-1)%u:e.key===yt?(l+5)%u:e.key===Et?(u+l-5)%u:l;d.current.children[p].focus()}e.preventDefault()}else if(ao.includes(e.key.toLowerCase())&&!Cn(e.target)){var h=ao.indexOf(e.key.toLowerCase());d.current.children[h].focus(),e.preventDefault()}else e.key!==kt&&e.key!==wt||(e.preventDefault(),a());e.nativeEvent.stopImmediatePropagation()}},i.a.createElement("div",{className:"color-picker-triangle color-picker-triangle-shadow"}),i.a.createElement("div",{className:"color-picker-triangle"}),i.a.createElement("div",{className:"color-picker-content",ref:function(e){e&&(d.current=e)}},t.map((function(e,t){return i.a.createElement("button",{className:"color-picker-swatch",onClick:function(t){t.currentTarget.focus(),r(e)},title:"".concat(e," \u2014 ").concat(ao[t].toUpperCase()),"aria-label":e,"aria-keyshortcuts":ao[t],style:{color:e},key:e,ref:function(r){r&&0===t&&(s.current=r),r&&e===n&&(u.current=r)},onFocus:function(){r(e)}},"transparent"===e?i.a.createElement("div",{className:"color-picker-transparent"}):void 0,i.a.createElement("span",{className:"color-picker-keybinding"},ao[t]))})),c&&i.a.createElement(io,{color:n,label:o,onChange:function(e){r(e)},ref:m})))},io=i.a.forwardRef((function(e,t){var n=e.color,r=e.onChange,a=e.label,o=i.a.useState(n),l=Object(m.a)(o,2),c=l[0],s=l[1],u=i.a.useRef(null);i.a.useEffect((function(){s(n)}),[n]),i.a.useImperativeHandle(t,(function(){return u.current}));var d=i.a.useCallback((function(e){var t=e.toLowerCase(),n=function(e){return"transparent"===e||ro(e)?e:ro("#".concat(e))?"#".concat(e):null}(t);n&&r(n),s(t)}),[r]);return i.a.createElement("label",{className:"color-input-container"},i.a.createElement("div",{className:"color-picker-hash"},"#"),i.a.createElement("input",{spellCheck:!1,className:"color-picker-input","aria-label":a,onChange:function(e){return d(e.target.value)},value:(c||"").replace(/^#/,""),onBlur:function(){return s(n)},ref:u}))})),lo=function(e){var t=e.type,n=e.color,r=e.onChange,a=e.label,o=i.a.useState(!1),l=Object(m.a)(o,2),c=l[0],s=l[1],u=i.a.useRef(null);return i.a.createElement("div",null,i.a.createElement("div",{className:"color-picker-control-container"},i.a.createElement("button",{className:"color-picker-label-swatch","aria-label":a,style:n?{"--swatch-color":n}:void 0,onClick:function(){return s(!c)},ref:u}),i.a.createElement(io,{color:n,label:a,onChange:function(e){r(e)}})),i.a.createElement(i.a.Suspense,{fallback:""},c?i.a.createElement(ua,{onCloseRequest:function(e){return e.target!==u.current&&s(!1)}},i.a.createElement(oo,{colors:ar[t],color:n||null,onChange:function(e){r(e)},onClose:function(){var e;s(!1),null===(e=u.current)||void 0===e||e.focus()},label:a,showInput:!1})):null))},co=function(e,t,n){return e.map((function(e){var r;return t.selectedElementIds[e.id]||e.id===(null===(r=t.editingElement)||void 0===r?void 0:r.id)?n(e):e}))},so=function(e,t,n,r){var a,o,i=t.editingElement,l=Xt(e);return null!==(a=null!==(o=i&&n(i))&&void 0!==o?o:un(l,t)?function(e,t,n){var r=Array.from(new Set(dn(e,t).map((function(e){return n(e)}))));return 1===r.length?r[0]:null}(l,t,n):r)&&void 0!==a?a:null},uo=(Va({name:"changeStrokeColor",perform:function(e,t,n){return{elements:co(e,t,(function(e){return xe(e,{strokeColor:n})})),appState:Object(p.a)({},t,{currentItemStrokeColor:n}),commitToHistory:!0}},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement(i.a.Fragment,null,i.a.createElement("h3",{"aria-hidden":"true"},on("labels.stroke")),i.a.createElement(lo,{type:"elementStroke",label:on("labels.stroke"),color:so(t,n,(function(e){return e.strokeColor}),n.currentItemStrokeColor),onChange:r}))}}),Va({name:"changeBackgroundColor",perform:function(e,t,n){return{elements:co(e,t,(function(e){return xe(e,{backgroundColor:n})})),appState:Object(p.a)({},t,{currentItemBackgroundColor:n}),commitToHistory:!0}},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement(i.a.Fragment,null,i.a.createElement("h3",{"aria-hidden":"true"},on("labels.background")),i.a.createElement(lo,{type:"elementBackground",label:on("labels.background"),color:so(t,n,(function(e){return e.backgroundColor}),n.currentItemBackgroundColor),onChange:r}))}}),Va({name:"changeFillStyle",perform:function(e,t,n){return{elements:co(e,t,(function(e){return xe(e,{fillStyle:n})})),appState:Object(p.a)({},t,{currentItemFillStyle:n}),commitToHistory:!0}},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.fill")),i.a.createElement(no,{options:[{value:"hachure",text:on("labels.hachure")},{value:"cross-hatch",text:on("labels.crossHatch")},{value:"solid",text:on("labels.solid")}],group:"fill",value:so(t,n,(function(e){return e.fillStyle}),n.currentItemFillStyle),onChange:function(e){r(e)}}))}}),Va({name:"changeStrokeWidth",perform:function(e,t,n){return{elements:co(e,t,(function(e){return xe(e,{strokeWidth:n})})),appState:Object(p.a)({},t,{currentItemStrokeWidth:n}),commitToHistory:!0}},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.strokeWidth")),i.a.createElement(no,{group:"stroke-width",options:[{value:1,text:on("labels.thin")},{value:2,text:on("labels.bold")},{value:4,text:on("labels.extraBold")}],value:so(t,n,(function(e){return e.strokeWidth}),n.currentItemStrokeWidth),onChange:function(e){return r(e)}}))}}),Va({name:"changeSloppiness",perform:function(e,t,n){return{elements:co(e,t,(function(e){return xe(e,{roughness:n})})),appState:Object(p.a)({},t,{currentItemRoughness:n}),commitToHistory:!0}},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.sloppiness")),i.a.createElement(no,{group:"sloppiness",options:[{value:0,text:on("labels.architect")},{value:1,text:on("labels.artist")},{value:2,text:on("labels.cartoonist")}],value:so(t,n,(function(e){return e.roughness}),n.currentItemRoughness),onChange:function(e){return r(e)}}))}}),Va({name:"changeStrokeStyle",perform:function(e,t,n){return{elements:co(e,t,(function(e){return xe(e,{strokeStyle:n})})),appState:Object(p.a)({},t,{currentItemStrokeStyle:n}),commitToHistory:!0}},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.strokeStyle")),i.a.createElement(no,{group:"strokeStyle",options:[{value:"solid",text:on("labels.strokeStyle_solid")},{value:"dashed",text:on("labels.strokeStyle_dashed")},{value:"dotted",text:on("labels.strokeStyle_dotted")}],value:so(t,n,(function(e){return e.strokeStyle}),n.currentItemStrokeStyle),onChange:function(e){return r(e)}}))}}),Va({name:"changeOpacity",perform:function(e,t,n){return{elements:co(e,t,(function(e){return xe(e,{opacity:n})})),appState:Object(p.a)({},t,{currentItemOpacity:n}),commitToHistory:!0}},PanelComponent:function(e){var t,n=e.elements,r=e.appState,a=e.updateData;return i.a.createElement("label",{className:"control-label"},on("labels.opacity"),i.a.createElement("input",{type:"range",min:"0",max:"100",step:"10",onChange:function(e){return a(+e.target.value)},onWheel:function(e){e.stopPropagation();var t=+e.target.value;e.deltaY<0&&t<100?a(t+10):e.deltaY>0&&t>0&&a(t-10)},value:null!==(t=so(n,r,(function(e){return e.opacity}),r.currentItemOpacity))&&void 0!==t?t:void 0}))}}),Va({name:"changeFontSize",perform:function(e,t,n){return{elements:co(e,t,(function(e){if(E(e)){var t=xe(e,{fontSize:n});return Ut(t),t}return e})),appState:Object(p.a)({},t,{currentItemFontSize:n}),commitToHistory:!0}},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.fontSize")),i.a.createElement(no,{group:"font-size",options:[{value:16,text:on("labels.small")},{value:20,text:on("labels.medium")},{value:28,text:on("labels.large")},{value:36,text:on("labels.veryLarge")}],value:so(t,n,(function(e){return E(e)&&e.fontSize}),n.currentItemFontSize||20),onChange:function(e){return r(e)}}))}}),Va({name:"changeFontFamily",perform:function(e,t,n){return{elements:co(e,t,(function(e){if(E(e)){var t=xe(e,{fontFamily:n});return Ut(t),t}return e})),appState:Object(p.a)({},t,{currentItemFontFamily:n}),commitToHistory:!0}},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData,a=[{value:1,text:on("labels.handDrawn")},{value:2,text:on("labels.normal")},{value:3,text:on("labels.code")}];return i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.fontFamily")),i.a.createElement(no,{group:"font-family",options:a,value:so(t,n,(function(e){return E(e)&&e.fontFamily}),n.currentItemFontFamily||1),onChange:function(e){return r(e)}}))}}),Va({name:"changeTextAlign",perform:function(e,t,n){return{elements:co(e,t,(function(e){if(E(e)){var t=xe(e,{textAlign:n});return Ut(t),t}return e})),appState:Object(p.a)({},t,{currentItemTextAlign:n}),commitToHistory:!0}},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.textAlign")),i.a.createElement(no,{group:"text-align",options:[{value:"left",text:on("labels.left")},{value:"center",text:on("labels.center")},{value:"right",text:on("labels.right")}],value:so(t,n,(function(e){return E(e)&&e.textAlign}),n.currentItemTextAlign),onChange:function(e){return r(e)}}))}}),Va({name:"changeViewBackgroundColor",perform:function(e,t,n){return{appState:Object(p.a)({},t,{viewBackgroundColor:n}),commitToHistory:!0}},PanelComponent:function(e){var t=e.appState,n=e.updateData;return i.a.createElement("div",{style:{position:"relative"}},i.a.createElement(lo,{label:on("labels.canvasBackground"),type:"canvasBackground",color:t.viewBackgroundColor,onChange:function(e){return n(e)}}))}}),Va({name:"clearCanvas",perform:function(e,t){return{elements:e.map((function(e){return xe(e,{isDeleted:!0})})),appState:Object(p.a)({},Jn(),{username:t.username}),commitToHistory:!0}},PanelComponent:function(e){var t=e.updateData;return i.a.createElement(va,{type:"button",icon:Ca,title:on("buttons.clearReset"),"aria-label":on("buttons.clearReset"),showAriaLabel:Kn(),onClick:function(){window.confirm(on("alerts.clearReset"))&&(window.handle=null,t(null))}})}}),"Minus"),mo="Equal",po="Digit1",ho="Digit0",fo="NumpadSubtract",go="NumpadAdd",vo="Numpad0",bo=(Va({name:"zoomIn",perform:function(e,t){return{appState:Object(p.a)({},t,{zoom:yn(t.zoom+.1)}),commitToHistory:!1}},PanelComponent:function(e){var t=e.updateData;return i.a.createElement(va,{type:"button",icon:ja,title:"".concat(on("buttons.zoomIn")," \u2014 ").concat(Nn("CtrlOrCmd++")),"aria-label":on("buttons.zoomIn"),onClick:function(){t(null)}})},keyTest:function(e){return(e.code===mo||e.code===go)&&(e[Ct]||e.shiftKey)}}),Va({name:"zoomOut",perform:function(e,t){return{appState:Object(p.a)({},t,{zoom:yn(t.zoom-.1)}),commitToHistory:!1}},PanelComponent:function(e){var t=e.updateData;return i.a.createElement(va,{type:"button",icon:Ta,title:"".concat(on("buttons.zoomOut")," \u2014 ").concat(Nn("CtrlOrCmd+-")),"aria-label":on("buttons.zoomOut"),onClick:function(){t(null)}})},keyTest:function(e){return(e.code===uo||e.code===fo)&&(e[Ct]||e.shiftKey)}}),Va({name:"resetZoom",perform:function(e,t){return{appState:Object(p.a)({},t,{zoom:1}),commitToHistory:!1}},PanelComponent:function(e){var t=e.updateData;return i.a.createElement(va,{type:"button",icon:Pa,title:on("buttons.resetZoom"),"aria-label":on("buttons.resetZoom"),onClick:function(){t(null)}})},keyTest:function(e){return(e.code===ho||e.code===vo)&&(e[Ct]||e.shiftKey)}}),Va({name:"zoomToFit",perform:function(e,t){var n=e.filter((function(e){return!e.isDeleted})),r=te(n),a=Object(m.a)(r,4),o=a[0],i=a[1],l=(o+a[2])/2,c=(i+a[3])/2,s=mn(t.width/2-l),u=mn(t.height/2-c),d=function(e,t,n){var r,a=n.scrollX,o=n.scrollY,i=window,l=i.innerWidth,c=i.innerHeight,s=Object(m.a)(e,2),u=-l/(2*a+2*s[0]-l),d=-c/(2*o+2*s[1]-c);return(r=u<d?u-.01:d<=u?d-.01:t)<=.1?.1:r>=1?1:r}(r,t.zoom,{scrollX:s,scrollY:u});return{appState:Object(p.a)({},t,{scrollX:s,scrollY:u,zoom:d}),commitToHistory:!1}},keyTest:function(e){return e.code===po&&e.shiftKey&&!e.altKey&&!e[Ct]}}),Va({name:"finalize",perform:function(e,t){var n;if(t.editingLinearElement){var r=t.editingLinearElement.elementId,a=ir.getElement(r);if(a)return{elements:a.points.length<2||Se(a)?e.filter((function(e){return e.id!==a.id})):void 0,appState:Object(p.a)({},t,{editingLinearElement:null}),commitToHistory:!0}}var o=e;window.document.activeElement instanceof HTMLElement&&window.document.activeElement.blur();var i=t.multiElement?t.multiElement:"draw"===(null===(n=t.editingElement)||void 0===n?void 0:n.type)?t.editingElement:null;if(i){if("draw"!==i.type&&"touch"!==t.lastPointerDownWith){var l=i.points,c=i.lastCommittedPoint;c&&l[l.length-1]===c||ke(i,{points:i.points.slice(0,-1)})}if(Se(i)&&(o=o.slice(0,-1)),("line"===i.type||"draw"===i.type)&&U(i.points)){var s=i.points,u=s[0];ke(i,{points:s.map((function(e,t){return t===s.length-1?[u[0],u[1]]:e}))})}t.elementLocked||(t.selectedElementIds[i.id]=!0)}return t.elementLocked&&i||Dn(),{elements:o,appState:Object(p.a)({},t,{elementType:t.elementLocked&&i?t.elementType:"selection",draggingElement:null,multiElement:null,editingElement:null,selectedElementIds:i&&!t.elementLocked?Object(p.a)({},t.selectedElementIds,Object(je.a)({},i.id,!0)):t.selectedElementIds}),commitToHistory:"draw"===t.elementType}},keyTest:function(e,t){return e.key===kt&&(null!==t.editingLinearElement||!t.draggingElement&&null===t.multiElement)||(e.key===kt||e.key===wt)&&null!==t.multiElement},PanelComponent:function(e){var t=e.appState,n=e.updateData;return i.a.createElement(va,{type:"button",icon:Ma,title:on("buttons.done"),"aria-label":on("buttons.done"),onClick:n,visible:null!=t.multiElement})}})),yo=(n(82),function(e){Object(v.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).handleFocus=function(e){Mn(e.currentTarget)},e.handleBlur=function(t){var n=t.currentTarget.innerText.trim();n!==e.props.value&&e.props.onChange(n),An()},e.handleKeyDown=function(e){if("Enter"===e.key){if(e.preventDefault(),e.nativeEvent.isComposing||229===e.keyCode)return;e.currentTarget.blur()}},e.makeEditable=function(e){if(e)try{e.contentEditable="plaintext-only"}catch(t){e.contentEditable="true"}},e}return Object(f.a)(n,[{key:"render",value:function(){return i.a.createElement("span",{suppressContentEditableWarning:!0,ref:this.makeEditable,"data-type":"wysiwyg",className:"TextInput",role:"textbox","aria-label":this.props.label,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus},this.props.value)}}]),n}(o.Component)),Eo=(Va({name:"changeProjectName",perform:function(e,t,n){return{appState:Object(p.a)({},t,{name:n}),commitToHistory:!1}},PanelComponent:function(e){var t=e.appState,n=e.updateData;return i.a.createElement(yo,{label:on("labels.fileTitle"),value:t.name||"Unnamed",onChange:function(e){return n(e)}})}}),Va({name:"changeExportBackground",perform:function(e,t,n){return{appState:Object(p.a)({},t,{exportBackground:n}),commitToHistory:!1}},PanelComponent:function(e){var t=e.appState,n=e.updateData;return i.a.createElement("label",null,i.a.createElement("input",{type:"checkbox",checked:t.exportBackground,onChange:function(e){return n(e.target.checked)}})," ",on("labels.withBackground"))}}),Va({name:"changeShouldAddWatermark",perform:function(e,t,n){return{appState:Object(p.a)({},t,{shouldAddWatermark:n}),commitToHistory:!1}},PanelComponent:function(e){var t=e.appState,n=e.updateData;return i.a.createElement("label",null,i.a.createElement("input",{type:"checkbox",checked:t.shouldAddWatermark,onChange:function(e){return n(e.target.checked)}})," ",on("labels.addWatermark"))}}),Va({name:"saveScene",perform:function(e,t,n){return Br(e,t,window.handle).catch((function(e){return console.error(e)})),{commitToHistory:!1}},keyTest:function(e){return"s"===e.key&&e[Ct]&&!e.shiftKey},PanelComponent:function(e){var t=e.updateData;return i.a.createElement(va,{type:"button",icon:wa,title:on("buttons.save"),"aria-label":on("buttons.save"),showAriaLabel:Kn(),onClick:function(){return t(null)}})}}),Va({name:"saveAsScene",perform:function(e,t,n){return Br(e,t,null).catch((function(e){return console.error(e)})),{commitToHistory:!1}},keyTest:function(e){return"s"===e.key&&e.shiftKey&&e[Ct]},PanelComponent:function(e){var t=e.updateData;return i.a.createElement(va,{type:"button",icon:ka,title:on("buttons.saveAs"),"aria-label":on("buttons.saveAs"),showAriaLabel:Kn(),hidden:!("chooseFileSystemEntries"in window),onClick:function(){return t(null)}})}}),Va({name:"loadScene",perform:function(e,t,n){var r=n.elements,a=n.appState,o=n.error;return{elements:r,appState:Object(p.a)({},a,{errorMessage:o}),commitToHistory:!1}},PanelComponent:function(e){var t=e.updateData;return i.a.createElement(va,{type:"button",icon:xa,title:on("buttons.load"),"aria-label":on("buttons.load"),showAriaLabel:Kn(),onClick:function(){_r().then((function(e){var n=e.elements,r=e.appState;t({elements:n,appState:r})})).catch((function(e){"AbortError"!==e.name&&t({error:e.message})}))}})}}),"{}"),wo=(Va({name:"copyStyles",perform:function(e,t){var n=e.find((function(e){return t.selectedElementIds[e.id]}));return n&&(Eo=JSON.stringify(n)),{commitToHistory:!1}},contextItemLabel:"labels.copyStyles",keyTest:function(e){return e[Ct]&&e.altKey&&e.keyCode===Pt},contextMenuOrder:0}),Va({name:"pasteStyles",perform:function(e,t){var n,r=JSON.parse(Eo);return"text"!==(null===(n=r)||void 0===n?void 0:n.type)&&"diamond"!==(null===n||void 0===n?void 0:n.type)&&"rectangle"!==(null===n||void 0===n?void 0:n.type)&&"ellipse"!==(null===n||void 0===n?void 0:n.type)&&"arrow"!==(null===n||void 0===n?void 0:n.type)&&"draw"!==(null===n||void 0===n?void 0:n.type)&&"line"!==(null===n||void 0===n?void 0:n.type)?{elements:e,commitToHistory:!1}:{elements:e.map((function(e){if(t.selectedElementIds[e.id]){var n=xe(e,{backgroundColor:null===r||void 0===r?void 0:r.backgroundColor,strokeWidth:null===r||void 0===r?void 0:r.strokeWidth,strokeColor:null===r||void 0===r?void 0:r.strokeColor,strokeStyle:null===r||void 0===r?void 0:r.strokeStyle,fillStyle:null===r||void 0===r?void 0:r.fillStyle,opacity:null===r||void 0===r?void 0:r.opacity,roughness:null===r||void 0===r?void 0:r.roughness});return E(n)&&(ke(n,{fontSize:(null===r||void 0===r?void 0:r.fontSize)||20,fontFamily:(null===r||void 0===r?void 0:r.fontFamily)||1,textAlign:(null===r||void 0===r?void 0:r.textAlign)||"left"}),Ut(n)),n}return e})),commitToHistory:!0}},contextItemLabel:"labels.pasteStyles",keyTest:function(e){return e[Ct]&&e.altKey&&e.keyCode===zt},contextMenuOrder:1}),i.a.createElement("svg",{width:"30",height:"22",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("path",{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}))),ko=function(e){return i.a.createElement("label",{title:"".concat(e.title," \u2014 ?"),className:"help-icon"},i.a.createElement("div",{onClick:e.onClick},wo))},xo=(Va({name:"toggleCanvasMenu",perform:function(e,t){return{appState:Object(p.a)({},t,{openMenu:"canvas"===t.openMenu?null:"canvas"}),commitToHistory:!1}},PanelComponent:function(e){var t=e.appState,n=e.updateData;return i.a.createElement(va,{type:"button",icon:Aa,"aria-label":on("buttons.menu"),onClick:n,selected:"canvas"===t.openMenu})}}),Va({name:"toggleEditMenu",perform:function(e,t){return{appState:Object(p.a)({},t,{openMenu:"shape"===t.openMenu?null:"shape"}),commitToHistory:!1}},PanelComponent:function(e){var t=e.elements,n=e.appState,r=e.updateData;return i.a.createElement(va,{visible:Wt(n,Xt(t)),type:"button",icon:Oa,"aria-label":on("buttons.edit"),onClick:r,selected:"shape"===n.openMenu})}}),Va({name:"toggleFullScreen",perform:function(){return zn()||document.documentElement.requestFullscreen(),zn()&&document.exitFullscreen(),{commitToHistory:!1}},keyTest:function(e){return e.keyCode===Tt}}),Va({name:"toggleShortcuts",perform:function(e,t){return{appState:Object(p.a)({},t,{showShortcutsDialog:!0}),commitToHistory:!1}},PanelComponent:function(e){var t=e.updateData;return i.a.createElement(ko,{title:on("shortcutsDialog.title"),onClick:t})},keyTest:function(e){return e.key===jt}}),Va({name:"group",perform:function(e,t){var n=dn(Xt(e),t);if(n.length<2)return{appState:t,elements:e,commitToHistory:!1};var r=Ae(t);if(1===r.length){var a=r[0],o=new Set(Pe(e,a).map((function(e){return e.id}))),i=new Set(n.map((function(e){return e.id})));if(new Set([].concat(Object(y.a)(Array.from(o)),Object(y.a)(Array.from(i)))).size===o.size)return{appState:t,elements:e,commitToHistory:!1}}var l=we(),c=e.map((function(e){return t.selectedElementIds[e.id]?xe(e,{groupIds:ze(e.groupIds,l,t.editingGroupId)}):e})),s=Pe(c,l),u=s[s.length-1],d=c.lastIndexOf(u),m=c.slice(d+1),h=c.slice(0,d).filter((function(e){return!De(e,l)})),f=[].concat(Object(y.a)(h),Object(y.a)(s),Object(y.a)(m));return{appState:Te(l,Object(p.a)({},t,{selectedGroupIds:{}}),Xt(f)),elements:f,commitToHistory:!0}},contextMenuOrder:4,contextItemLabel:"labels.group",contextItemPredicate:function(e,t){return dn(Xt(e),t).length>1},keyTest:function(e){return!e.shiftKey&&e[Ct]&&e.keyCode===Dt}}),Va({name:"ungroup",perform:function(e,t){if(0===Ae(t).length)return{appState:t,elements:e,commitToHistory:!1};var n=e.map((function(e){var n=function(e,t){return e.filter((function(e){return!t[e]}))}(e.groupIds,t.selectedGroupIds);return n.length===e.groupIds.length?e:xe(e,{groupIds:n})}));return{appState:Le(Object(p.a)({},t,{selectedGroupIds:{}}),Xt(n)),elements:n,commitToHistory:!0}},keyTest:function(e){return e.shiftKey&&e[Ct]&&e.keyCode===Dt},contextMenuOrder:5,contextItemLabel:"labels.ungroup",contextItemPredicate:function(e,t){return Ae(t).length>0}}),n(83),function(e){var t=e.children,n=e.className,r=e.color,a=e.onClick;return i.a.createElement("div",{className:"Avatar ".concat(n),style:{background:r},onClick:a},t)}),So=(Va({name:"goToCollaborator",perform:function(e,t,n){var r=n;return r?{appState:Object(p.a)({},t,{scrollX:mn(t.width/2-r.x),scrollY:mn(t.height/2-r.y),openMenu:"canvas"===t.openMenu?null:t.openMenu}),commitToHistory:!1}:{appState:t,commitToHistory:!1}},PanelComponent:function(e){var t=e.appState,n=e.updateData,r=e.id;if(!r)return null;var a=t.collaborators.get(r);if(!a)return null;var o=or(r).background,l=function(e){if(!e)return"?";var t=e.trim().split(" ");if(t.length<2)return t[0].substring(0,2).toUpperCase();var n=t[0],r=t[t.length-1];return(n[0]+r[0]).toUpperCase()}(a.username);return i.a.createElement(xo,{color:o,onClick:function(){return n(a.pointer)}},l)}}),Va({name:"addToLibrary",perform:function(e,t){var n=dn(Xt(e),t);return Ur().then((function(e){Wr([].concat(Object(y.a)(e),[n.map(Fe)]))})),!1},contextMenuOrder:6,contextItemLabel:"labels.addToLibrary"}),function(e){var t=Array.from(e.values());return{x:mn(Oo(t,(function(e){return e.x}))/t.length),y:mn(Oo(t,(function(e){return e.y}))/t.length)}}),Co=function(e){var t=Object(m.a)(e,2),n=t[0],r=t[1];return Math.hypot(n.x-r.x,n.y-r.y)},Oo=function(e,t){return e.reduce((function(e,n){return e+t(n)}),0)},Io=function(e,t,n){if(!t.multiElement&&!t.resizingElement&&!t.editingElement&&!t.draggingElement){var r=n();if(null===r)return{commitToHistory:!1};var a=Gt(e),o=r.elements,i=Gt(o);return{elements:o.map((function(e){return xe(a[e.id]||e,e)})).concat(e.filter((function(e){return!i.hasOwnProperty(e.id)})).map((function(e){return xe(e,{isDeleted:!0})}))),appState:Object(p.a)({},t,{},r.appState),commitToHistory:!1,syncHistory:!0}}return{commitToHistory:!1}},jo=function(e){return function(t){return t[Ct]&&/z/i.test(t.key)&&t.shiftKey===e}},To=(n(84),i.a.forwardRef((function(e,t){var n=e.children,r=e.padding,a=e.className,o=e.style;return i.a.createElement("div",{className:"".concat(null!==a&&void 0!==a?a:""," Island"),style:Object(p.a)({"--padding":r},o),ref:t},n)}))),Mo=(n(85),function(e){var t=e.children,n=e.gap,r=e.align,a=e.justifyContent,o=e.className;return i.a.createElement("div",{className:"Stack Stack_horizontal ".concat(o||""),style:{"--gap":n,alignItems:r,justifyContent:a}},t)}),Ao=function(e){var t=e.children,n=e.gap,r=e.align,a=e.justifyContent,o=e.className;return i.a.createElement("div",{className:"Stack Stack_vertical ".concat(o||""),style:{"--gap":n,justifyItems:r,justifyContent:a}},t)},Lo=(n(86),function(e){var t=e.children,n=e.side,r=e.className;return i.a.createElement("div",{className:"FixedSideContainer FixedSideContainer_side_".concat(n," ").concat(r)},t)}),Do=(n(87),function(e){var t=e.children,n=e.className,r=e.mobile,a="UserList";return n&&(a+=" ".concat(n)),r&&(a+=" UserList_mobile"),i.a.createElement("div",{className:a},t)}),Po={CHECKED:i.a.createElement("svg",{width:"1792",height:"1792",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("path",{d:"M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z"})),UNCHECKED:i.a.createElement("svg",{width:"1792",height:"1792",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",className:"unlocked-icon rtl-mirror"},i.a.createElement("path",{d:"M1728 576v256q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45v-256q0-106-75-181t-181-75-181 75-75 181v192h96q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h672v-192q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5z"}))},zo=function(e){var t="ToolIcon_size_".concat(e.size||"m");return i.a.createElement("label",{className:"ToolIcon ToolIcon__lock ToolIcon_type_floating ".concat(t," zen-mode-visibility ").concat(e.zenModeEnabled&&"zen-mode-visibility--hidden"),title:"".concat(e.title," \u2014 Q")},i.a.createElement("input",{className:"ToolIcon_type_checkbox",type:"checkbox",name:e.name,id:e.id,onChange:e.onChange,checked:e.checked,"aria-label":e.title}),i.a.createElement("div",{className:"ToolIcon__icon"},e.checked?Po.CHECKED:Po.UNCHECKED))},No=(n(88),n(89),function(e){var t,n=Ro();return Object(l.createPortal)(i.a.createElement("div",{className:"Modal ".concat(null!==(t=e.className)&&void 0!==t?t:""),role:"dialog","aria-modal":"true",onKeyDown:function(t){t.key===kt&&(t.nativeEvent.stopImmediatePropagation(),e.onCloseRequest())},"aria-labelledby":e.labelledBy},i.a.createElement("div",{className:"Modal__background",onClick:e.onCloseRequest}),i.a.createElement("div",{className:"Modal__content",style:{"--max-width":"".concat(e.maxWidth,"px"),maxHeight:"100%",overflowY:"scroll"}},e.children)),n)}),Ro=function(){var e=Object(o.useState)((function(){var e=document.createElement("div");return document.body.appendChild(e),e})),t=Object(m.a)(e,1)[0];return Object(o.useEffect)((function(){return function(){document.body.removeChild(t)}}),[t]),t},Ho=(n(90),function(e){var t,n=Object(o.useRef)(null);Object(o.useEffect)((function(){var e=r();e.length>0&&(e[1]||e[0]).focus()}),[]),Object(o.useEffect)((function(){if(n.current){var e=function(e){if(e.key===Ot){var t=r(),n=document.activeElement,a=t.findIndex((function(e){return e===n}));0===a&&e.shiftKey?(t[t.length-1].focus(),e.preventDefault()):a!==t.length-1||e.shiftKey||(t[0].focus(),e.preventDefault())}},t=n.current;return t.addEventListener("keydown",e),function(){return t.removeEventListener("keydown",e)}}}),[]);var r=function(){var e,t=null===(e=n.current)||void 0===e?void 0:e.querySelectorAll("button, a, input, select, textarea, div[tabindex]");return t?Array.from(t):[]};return i.a.createElement(No,{className:"".concat(null!==(t=e.className)&&void 0!==t?t:""," Dialog"),labelledBy:"dialog-title",maxWidth:e.maxWidth,onCloseRequest:e.onCloseRequest},i.a.createElement(To,{padding:4,ref:n},i.a.createElement("h2",{id:"dialog-title",className:"Dialog__title"},i.a.createElement("span",{className:"Dialog__titleContent"},e.title),i.a.createElement("button",{className:"Modal__close",onClick:e.onCloseRequest,"aria-label":on("buttons.close")},Kn()?Wa:Ua)),e.children))}),Bo=[1,2,3],_o=Bo.includes(devicePixelRatio)?devicePixelRatio:1,Fo=function(e){var t=e.elements,n=e.appState,r=e.exportPadding,a=void 0===r?10:r,l=e.actionManager,c=e.onExportToPng,s=e.onExportToSvg,u=e.onExportToClipboard,d=e.onExportToBackend,p=un(t,n),h=Object(o.useState)(_o),f=Object(m.a)(h,2),g=f[0],v=f[1],b=Object(o.useState)(p),y=Object(m.a)(b,2),E=y[0],w=y[1],k=Object(o.useRef)(null),x=n.exportBackground,S=n.viewBackgroundColor,C=n.shouldAddWatermark,O=E?dn(t,n):t;return Object(o.useEffect)((function(){w(p)}),[p]),Object(o.useEffect)((function(){var e=k.current,t=pr(O,n,{exportBackground:x,viewBackgroundColor:S,exportPadding:a,scale:g,shouldAddWatermark:C});return null===e||void 0===e||e.appendChild(t),function(){null===e||void 0===e||e.removeChild(t)}}),[n,O,x,a,S,g,C]),i.a.createElement("div",{className:"ExportDialog"},i.a.createElement("div",{className:"ExportDialog__preview",ref:k}),i.a.createElement(Ao,{gap:2,align:"center"},i.a.createElement("div",{className:"ExportDialog__actions"},i.a.createElement(Mo,{gap:2},i.a.createElement(va,{type:"button",label:"PNG",title:on("buttons.exportToPng"),"aria-label":on("buttons.exportToPng"),onClick:function(){return c(O,g)}}),i.a.createElement(va,{type:"button",label:"SVG",title:on("buttons.exportToSvg"),"aria-label":on("buttons.exportToSvg"),onClick:function(){return s(O,g)}}),Or&&i.a.createElement(va,{type:"button",icon:Sa,title:on("buttons.copyPngToClipboard"),"aria-label":on("buttons.copyPngToClipboard"),onClick:function(){return u(O,g)}}),i.a.createElement(va,{type:"button",icon:Ea,title:on("buttons.getShareableLink"),"aria-label":on("buttons.getShareableLink"),onClick:function(){return d(O)}})),i.a.createElement("div",{className:"ExportDialog__name"},l.renderAction("changeProjectName")),i.a.createElement(Mo,{gap:2},Bo.map((function(e){return i.a.createElement(va,{key:e,size:"s",type:"radio",icon:"x".concat(e),name:"export-canvas-scale","aria-label":"Scale ".concat(e," x"),id:"export-canvas-scale",checked:e===g,onChange:function(){return v(e)}})})))),l.renderAction("changeExportBackground"),p&&i.a.createElement("div",null,i.a.createElement("label",null,i.a.createElement("input",{type:"checkbox",checked:E,onChange:function(e){return w(e.currentTarget.checked)}})," ",on("labels.onlySelected"))),l.renderAction("changeShouldAddWatermark")))},Uo=function(e){var t=e.elements,n=e.appState,r=e.exportPadding,a=void 0===r?10:r,l=e.actionManager,c=e.onExportToPng,s=e.onExportToSvg,u=e.onExportToClipboard,d=e.onExportToBackend,p=Object(o.useState)(!1),h=Object(m.a)(p,2),f=h[0],g=h[1],v=Object(o.useRef)(null),b=i.a.useCallback((function(){var e;g(!1),null===(e=v.current)||void 0===e||e.focus()}),[]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(va,{onClick:function(){return g(!0)},icon:Ia,type:"button","aria-label":on("buttons.export"),showAriaLabel:Kn(),title:on("buttons.export"),ref:v}),f&&i.a.createElement(Ho,{maxWidth:800,onCloseRequest:b,title:on("buttons.export")},i.a.createElement(Fo,{elements:t,appState:n,exportPadding:a,actionManager:l,onExportToPng:c,onExportToSvg:s,onExportToClipboard:u,onExportToBackend:d,onCloseRequest:b})))},Wo=function(e){var t=e.onChange,n=e.languages,r=void 0===n?Jt:n,a=e.currentLanguage,o=void 0===a?rn().lng:a,l=e.floating;return i.a.createElement(i.a.Fragment,null,i.a.createElement("select",{className:"dropdown-select dropdown-select__language".concat(l?" dropdown-select--floating":""),onChange:function(e){var n=e.target;return t(n.value)},value:o,"aria-label":on("buttons.selectLanguage")},r.map((function(e){return i.a.createElement("option",{key:e.lng,value:e.lng},e.label)}))))},Go=(n(91),function(e){var t=function(e){var t=e.appState,n=e.elements,r=t.elementType,a=t.isResizing,o=t.isRotating,i=t.lastPointerDownWith,l=null!==t.multiElement;if("arrow"===r||"line"===r)return on(l?"hints.linearElementMulti":"hints.linearElement");if("draw"===r)return on("hints.freeDraw");var c=dn(n,t);if(a&&"mouse"===i&&1===c.length){var s=c[0];return w(s)&&s.points.length>2?null:on("hints.resize")}return o&&"mouse"===i?on("hints.rotate"):1===c.length&&w(c[0])?t.editingLinearElement?t.editingLinearElement.activePointIndex?on("hints.lineEditor_pointSelected"):on("hints.lineEditor_nothingSelected"):on("hints.lineEditor_info"):null}({appState:e.appState,elements:e.elements});return t?(t=Nn(t),i.a.createElement("div",{className:"HintViewer"},i.a.createElement("span",null,t))):null}),Yo=function(e){var t=e.appState,n=e.elements,r=e.renderAction,a=e.elementType,o=function(e,t){return t.editingElement?[t.editingElement]:dn(e,t)}(Xt(n),t),l=Boolean(t.editingElement),c=Kn();return i.a.createElement("div",{className:"panelColumn"},r("changeStrokeColor"),(hn(a)||o.some((function(e){return hn(e.type)})))&&i.a.createElement(i.a.Fragment,null,r("changeBackgroundColor"),r("changeFillStyle")),(fn(a)||o.some((function(e){return fn(e.type)})))&&i.a.createElement(i.a.Fragment,null,r("changeStrokeWidth"),r("changeStrokeStyle"),r("changeSloppiness")),(gn(a)||o.some((function(e){return gn(e.type)})))&&i.a.createElement(i.a.Fragment,null,r("changeFontSize"),r("changeFontFamily"),r("changeTextAlign")),r("changeOpacity"),i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.layers")),i.a.createElement("div",{className:"buttonList"},r("sendToBack"),r("sendBackward"),r("bringToFront"),r("bringForward"))),!c&&!l&&o.length>0&&i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.actions")),i.a.createElement("div",{className:"buttonList"},r("duplicateSelection"),r("deleteSelectedElements"))))},Xo=i.a.createElement("svg",{viewBox:"0 0 512 512"},i.a.createElement("path",{d:"M296 32h192c13.255 0 24 10.745 24 24v160c0 13.255-10.745 24-24 24H296c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24zm-80 0H24C10.745 32 0 42.745 0 56v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24zM0 296v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm296 184h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H296c-13.255 0-24 10.745-24 24v160c0 13.255 10.745 24 24 24z"})),Vo=function(e){var t=e.elementType,n=e.setAppState,r=e.isLibraryOpen;return i.a.createElement(i.a.Fragment,null,ia.map((function(e,r){var a=e.value,o=e.icon,l=e.key,c=on("toolBar.".concat(a)),s="".concat(Sn(l)," ").concat(on("shortcutsDialog.or")," ").concat(r+1);return i.a.createElement(va,{key:a,type:"radio",icon:o,checked:t===a,name:"editor-current-shape",title:"".concat(Sn(c)," \u2014 ").concat(s),keyBindingLabel:"".concat(r+1),"aria-label":Sn(c),"aria-keyshortcuts":"".concat(l," ").concat(r+1),"data-testid":a,onChange:function(){n({elementType:a,multiElement:null,selectedElementIds:{}}),Pn(a),n({})}})})),i.a.createElement(va,{type:"button",icon:Xo,name:"editor-library",keyBindingLabel:"9","aria-keyshortcuts":"9",title:"".concat(Sn(on("toolBar.library"))," \u2014 9"),"aria-label":Sn(on("toolBar.library")),onClick:function(){n({isLibraryOpen:!r})}}))},Ko=function(e){var t=e.renderAction,n=e.zoom;return i.a.createElement(Ao,{gap:1},i.a.createElement(Mo,{gap:1,align:"center"},t("zoomIn"),t("zoomOut"),t("resetZoom"),i.a.createElement("div",{style:{marginInlineStart:4}},(100*n).toFixed(0),"%")))},qo=function(e){var t=e.heading,n=e.children,r=Object(Ie.a)(e,["heading","children"]),a=i.a.createElement("h2",{className:"visually-hidden",id:"".concat(t,"-title")},on("headings.".concat(t)));return i.a.createElement("section",Object.assign({},r,{"aria-labelledby":"".concat(t,"-title")}),"function"===typeof n?n(a):i.a.createElement(i.a.Fragment,null,a,n))},Zo=(n(92),function(e){var t=e.activeRoomLink,n=e.username,r=e.onUsernameChange,a=e.onRoomCreate,l=e.onRoomDestroy,c=e.onPressingEnter,s=Object(o.useRef)(null);return i.a.createElement("div",{className:"RoomDialog-modal"},!t&&i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,on("roomDialog.desc_intro")),i.a.createElement("p",null,"\ud83d\udd12 ".concat(on("roomDialog.desc_privacy"))),i.a.createElement("div",{className:"RoomDialog-sessionStartButtonContainer"},i.a.createElement(va,{className:"RoomDialog-startSession",type:"button",icon:_a,title:on("roomDialog.button_startSession"),"aria-label":on("roomDialog.button_startSession"),showAriaLabel:!0,onClick:a}))),t&&i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,on("roomDialog.desc_inProgressIntro")),i.a.createElement("p",null,on("roomDialog.desc_shareLink")),i.a.createElement("div",{className:"RoomDialog-linkContainer"},i.a.createElement(va,{type:"button",icon:Sa,title:on("labels.copy"),"aria-label":on("labels.copy"),onClick:function(){Lr(t),s.current&&s.current.select()}}),i.a.createElement("input",{value:t,readOnly:!0,className:"RoomDialog-link",ref:s,onPointerDown:function(e){e.target!==document.activeElement&&(e.preventDefault(),e.target.select())}})),i.a.createElement("div",{className:"RoomDialog-usernameContainer"},i.a.createElement("label",{className:"RoomDialog-usernameLabel",htmlFor:"username"},on("labels.yourName")),i.a.createElement("input",{id:"username",value:n||"",className:"RoomDialog-username TextInput",onChange:function(e){return r(e.target.value)},onKeyPress:function(e){return"Enter"===e.key&&c()}})),i.a.createElement("p",null,"\ud83d\udd12 ".concat(on("roomDialog.desc_privacy"))),i.a.createElement("p",null,i.a.createElement("span",{role:"img","aria-hidden":"true"},"\u26a0\ufe0f")," ",on("roomDialog.desc_persistenceWarning")),i.a.createElement("p",null,on("roomDialog.desc_exitSession")),i.a.createElement("div",{className:"RoomDialog-sessionStartButtonContainer"},i.a.createElement(va,{className:"RoomDialog-stopSession",type:"button",icon:Fa,title:on("roomDialog.button_stopSession"),"aria-label":on("roomDialog.button_stopSession"),showAriaLabel:!0,onClick:l}))))}),Jo=function(e){var t=e.isCollaborating,n=e.collaboratorCount,r=e.username,a=e.onUsernameChange,l=e.onRoomCreate,c=e.onRoomDestroy,s=Object(o.useState)(!1),u=Object(m.a)(s,2),d=u[0],p=u[1],h=Object(o.useState)(""),f=Object(m.a)(h,2),g=f[0],v=f[1],b=Object(o.useRef)(null),y=i.a.useCallback((function(){var e;p(!1),null===(e=b.current)||void 0===e||e.focus()}),[]);return Object(o.useEffect)((function(){v(t?window.location.href:"")}),[t]),i.a.createElement(i.a.Fragment,null,i.a.createElement(va,{className:"RoomDialog-modalButton ".concat(t?"is-collaborating":""),onClick:function(){return p(!0)},icon:Ba,type:"button",title:on("buttons.roomDialog"),"aria-label":on("buttons.roomDialog"),showAriaLabel:Kn(),ref:b},n>0&&i.a.createElement("div",{className:"RoomDialog-modalButton-collaborators"},n)),d&&i.a.createElement(Ho,{maxWidth:800,onCloseRequest:y,title:on("labels.createRoom")},i.a.createElement(Zo,{activeRoomLink:g,username:r,onUsernameChange:a,onRoomCreate:l,onRoomDestroy:c,onPressingEnter:y})))},$o=function(e){var t=e.appState,n=e.elements,r=e.actionManager,a=e.exportButton,o=e.setAppState,l=e.onRoomCreate,c=e.onUsernameChange,s=e.onRoomDestroy,h=e.onLockToggle,f=e.canvas;return i.a.createElement(i.a.Fragment,null,t.isLoading&&i.a.createElement(Gn,null),i.a.createElement(Lo,{side:"top"},i.a.createElement(qo,{heading:"shapes"},(function(e){return i.a.createElement(Ao,{gap:4,align:"center"},i.a.createElement(Mo,{gap:1},i.a.createElement(To,{padding:1},e,i.a.createElement(Mo,{gap:1},i.a.createElement(Vo,{elementType:t.elementType,setAppState:o,isLibraryOpen:t.isLibraryOpen}))),i.a.createElement(zo,{checked:t.elementLocked,onChange:h,title:on("toolBar.lock")})))})),i.a.createElement(Go,{appState:t,elements:n})),i.a.createElement("div",{className:"App-bottom-bar",style:{marginBottom:14,marginLeft:14,marginRight:14}},i.a.createElement(To,{padding:3},"canvas"===t.openMenu?i.a.createElement(qo,{className:"App-mobile-menu",heading:"canvasActions"},i.a.createElement("div",{className:"panelColumn"},i.a.createElement(Ao,{gap:4},r.renderAction("loadScene"),r.renderAction("saveScene"),r.renderAction("saveAsScene"),a,r.renderAction("clearCanvas"),i.a.createElement(Jo,{isCollaborating:t.isCollaborating,collaboratorCount:t.collaborators.size,username:t.username,onUsernameChange:c,onRoomCreate:l,onRoomDestroy:s}),r.renderAction("changeViewBackgroundColor"),i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.language")),i.a.createElement(Wo,{onChange:function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tn(t);case 2:o({});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})),i.a.createElement("fieldset",null,i.a.createElement("legend",null,on("labels.collaborators")),i.a.createElement(Do,{mobile:!0},Array.from(t.collaborators).filter((function(e){var t=Object(m.a)(e,2),n=(t[0],t[1]);return 0!==Object.keys(n).length})).map((function(e){var t=Object(m.a)(e,2),n=t[0];t[1];return i.a.createElement(i.a.Fragment,{key:n},r.renderAction("goToCollaborator",n))}))))))):"shape"===t.openMenu&&Wt(t,n)?i.a.createElement(qo,{className:"App-mobile-menu",heading:"selectedShapeActions"},i.a.createElement(Yo,{appState:t,elements:n,renderAction:r.renderAction,elementType:t.elementType})):null,i.a.createElement("footer",{className:"App-toolbar"},i.a.createElement("div",{className:"App-toolbar-content"},r.renderAction("toggleCanvasMenu"),r.renderAction("toggleEditMenu"),r.renderAction("undo"),r.renderAction("redo"),r.renderAction(t.multiElement?"finalize":"duplicateSelection"),r.renderAction("deleteSelectedElements")),t.scrolledOutside&&i.a.createElement("button",{className:"scroll-back-to-content",onClick:function(){o(Object(p.a)({},pn(n,t,f)))}},on("buttons.scrollBackToContent"))))))},Qo=function(e){var t=e.message,n=e.onClose,r=Object(o.useState)(!!t),a=Object(m.a)(r,2),l=a[0],c=a[1],s=i.a.useCallback((function(){c(!1),n&&n()}),[n]);return i.a.createElement(i.a.Fragment,null,l&&i.a.createElement(Ho,{maxWidth:500,onCloseRequest:s,title:on("errorDialog.title")},i.a.createElement("div",null,t)))},ei=function(e){return i.a.createElement("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between"}},e.children)},ti=function(e){return i.a.createElement("div",{style:{width:"49%"}},e.children)},ni=function(e){return i.a.createElement("div",{style:{border:"1px solid ".concat(Zn.gray[4]),marginBottom:"16px"}},i.a.createElement("h3",{style:{margin:"0",padding:"4px",backgroundColor:Zn.gray[2],textAlign:"center"}},e.caption),e.children)},ri=function(e){var t="rtl"===document.documentElement.getAttribute("dir");return i.a.createElement("div",{style:{borderTop:"1px solid ".concat(Zn.gray[4])}},i.a.createElement("div",{style:{display:"flex",margin:"0",padding:"4px 8px",alignItems:"center"}},i.a.createElement("div",{style:{lineHeight:1.4}},e.label),i.a.createElement("div",{style:{display:"flex",flex:"0 0 auto",justifyContent:"flex-end",marginLeft:t?"0em":"auto",marginRight:t?"auto":"0em",minWidth:"30%"}},e.shortcuts.map((function(t,n){return i.a.createElement(i.a.Fragment,{key:n},i.a.createElement(ai,null,t),e.isOr&&n!==e.shortcuts.length-1&&on("shortcutsDialog.or"))})))))};ri.defaultProps={isOr:!0};var ai=function(e){return i.a.createElement("span",Object.assign({style:{wordBreak:"keep-all",border:"1px solid ".concat(Zn.gray[4]),padding:"2px 8px",margin:"auto 4px",backgroundColor:Zn.gray[2],borderRadius:"2px",fontSize:"0.8em",minHeight:"26px",boxSizing:"border-box",display:"flex",alignItems:"center"}},e))},oi=function(){return i.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-evenly",borderTop:"1px solid ".concat(Zn.gray[4]),marginTop:8,paddingTop:16}},i.a.createElement("a",{href:"https://blog.excalidraw.com",target:"_blank",rel:"noopener noreferrer"},on("shortcutsDialog.blog")),i.a.createElement("a",{href:"https://howto.excalidraw.com",target:"_blank",rel:"noopener noreferrer"},on("shortcutsDialog.howto")),i.a.createElement("a",{href:"https://github.com/excalidraw/excalidraw/issues",target:"_blank",rel:"noopener noreferrer"},on("shortcutsDialog.github")))},ii=function(e){var t=e.onClose,n=i.a.useCallback((function(){t&&t()}),[t]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ho,{maxWidth:900,onCloseRequest:n,title:on("shortcutsDialog.title")},i.a.createElement(ei,null,i.a.createElement(ti,null,i.a.createElement(ni,{caption:on("shortcutsDialog.shapes")},i.a.createElement(ri,{label:on("toolBar.selection"),shortcuts:["S","1"]}),i.a.createElement(ri,{label:on("toolBar.rectangle"),shortcuts:["R","2"]}),i.a.createElement(ri,{label:on("toolBar.diamond"),shortcuts:["D","3"]}),i.a.createElement(ri,{label:on("toolBar.ellipse"),shortcuts:["E","4"]}),i.a.createElement(ri,{label:on("toolBar.arrow"),shortcuts:["A","5"]}),i.a.createElement(ri,{label:on("toolBar.line"),shortcuts:["L","6"]}),i.a.createElement(ri,{label:on("toolBar.draw"),shortcuts:["X","7"]}),i.a.createElement(ri,{label:on("toolBar.text"),shortcuts:["T","8"]}),i.a.createElement(ri,{label:on("shortcutsDialog.textNewLine"),shortcuts:[Nn("Enter"),Nn("Shift+Enter")]}),i.a.createElement(ri,{label:on("shortcutsDialog.textFinish"),shortcuts:[Nn("Esc"),Nn("CtrlOrCmd+Enter")]}),i.a.createElement(ri,{label:on("shortcutsDialog.curvedArrow"),shortcuts:["A",on("shortcutsDialog.click"),on("shortcutsDialog.click"),on("shortcutsDialog.click")],isOr:!1}),i.a.createElement(ri,{label:on("shortcutsDialog.curvedLine"),shortcuts:["L",on("shortcutsDialog.click"),on("shortcutsDialog.click"),on("shortcutsDialog.click")],isOr:!1}),i.a.createElement(ri,{label:on("toolBar.lock"),shortcuts:["Q"]})),i.a.createElement(ni,{caption:on("shortcutsDialog.view")},i.a.createElement(ri,{label:on("buttons.zoomIn"),shortcuts:[Nn("CtrlOrCmd++")]}),i.a.createElement(ri,{label:on("buttons.zoomOut"),shortcuts:[Nn("CtrlOrCmd+-")]}),i.a.createElement(ri,{label:on("buttons.resetZoom"),shortcuts:[Nn("CtrlOrCmd+0")]}),i.a.createElement(ri,{label:on("shortcutsDialog.zoomToFit"),shortcuts:["Shift+1"]}),i.a.createElement(ri,{label:on("buttons.toggleFullScreen"),shortcuts:["F"]}),i.a.createElement(ri,{label:on("buttons.toggleZenMode"),shortcuts:[Nn("Alt+Z")]}),i.a.createElement(ri,{label:on("labels.toggleGridMode"),shortcuts:[Nn("CtrlOrCmd+'")]}))),i.a.createElement(ti,null,i.a.createElement(ni,{caption:on("shortcutsDialog.editor")},i.a.createElement(ri,{label:on("labels.selectAll"),shortcuts:[Nn("CtrlOrCmd+A")]}),i.a.createElement(ri,{label:on("labels.multiSelect"),shortcuts:[Nn("Shift+".concat(on("shortcutsDialog.click")))]}),i.a.createElement(ri,{label:on("labels.moveCanvas"),shortcuts:[Nn("Space+".concat(on("shortcutsDialog.drag"))),Nn("Wheel+".concat(on("shortcutsDialog.drag")))],isOr:!0}),i.a.createElement(ri,{label:on("labels.copy"),shortcuts:[Nn("CtrlOrCmd+C")]}),i.a.createElement(ri,{label:on("labels.paste"),shortcuts:[Nn("CtrlOrCmd+V")]}),i.a.createElement(ri,{label:on("labels.copyAsPng"),shortcuts:[Nn("Shift+Alt+C")]}),i.a.createElement(ri,{label:on("labels.copyStyles"),shortcuts:[Nn("CtrlOrCmd+Alt+C")]}),i.a.createElement(ri,{label:on("labels.pasteStyles"),shortcuts:[Nn("CtrlOrCmd+Alt+V")]}),i.a.createElement(ri,{label:on("labels.delete"),shortcuts:[Nn("Del")]}),i.a.createElement(ri,{label:on("labels.sendToBack"),shortcuts:[Nn(gt?"CtrlOrCmd+Alt+[":"CtrlOrCmd+Shift+[")]}),i.a.createElement(ri,{label:on("labels.bringToFront"),shortcuts:[Nn(gt?"CtrlOrCmd+Alt+]":"CtrlOrCmd+Shift+]")]}),i.a.createElement(ri,{label:on("labels.sendBackward"),shortcuts:[Nn("CtrlOrCmd+[")]}),i.a.createElement(ri,{label:on("labels.bringForward"),shortcuts:[Nn("CtrlOrCmd+]")]}),i.a.createElement(ri,{label:on("labels.duplicateSelection"),shortcuts:[Nn("CtrlOrCmd+D"),Nn("Alt+".concat(on("shortcutsDialog.drag")))]}),i.a.createElement(ri,{label:on("buttons.undo"),shortcuts:[Nn("CtrlOrCmd+Z")]}),i.a.createElement(ri,{label:on("buttons.redo"),shortcuts:[Nn("CtrlOrCmd+Shift+Z")]}),i.a.createElement(ri,{label:on("labels.group"),shortcuts:[Nn("CtrlOrCmd+G")]}),i.a.createElement(ri,{label:on("labels.ungroup"),shortcuts:[Nn("CtrlOrCmd+Shift+G")]})))),i.a.createElement(oi,null)))},li=i.a.memo((function(){return i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"0 0 250 250",className:"github-corner rtl-mirror"},i.a.createElement("a",{href:"https://github.com/excalidraw/excalidraw",target:"_blank",rel:"noopener noreferrer","aria-label":"GitHub repository"},i.a.createElement("path",{d:"M0 0l115 115h15l12 27 108 108V0z",fill:Zn.gray[6]}),i.a.createElement("path",{className:"octo-arm",d:"M128 109c-15-9-9-19-9-19 3-7 2-11 2-11-1-7 3-2 3-2 4 5 2 11 2 11-3 10 5 15 9 16",style:{transformOrigin:"130px 106px"},fill:Zn.white}),i.a.createElement("path",{className:"octo-body",d:"M115 115s4 2 5 0l14-14c3-2 6-3 8-3-8-11-15-24 2-41 5-5 10-7 16-7 1-2 3-7 12-11 0 0 5 3 7 16 4 2 8 5 12 9s7 8 9 12c14 3 17 7 17 7-4 8-9 11-11 11 0 6-2 11-7 16-16 16-30 10-41 2 0 3-1 7-5 11l-12 11c-1 1 1 5 1 5z",fill:Zn.white})))})),ci=(n(93),function(e){var t=e.children,n=e.label;return i.a.createElement("div",{className:"Tooltip"},i.a.createElement("span",{className:"Tooltip__label"},n),t)}),si=(n(94),n(95),i.a.createElement("svg",{viewBox:"0 0 1792 1792"},i.a.createElement("path",{d:"M1600 736v192q0 40-28 68t-68 28h-416v416q0 40-28 68t-68 28h-192q-40 0-68-28t-28-68v-416h-416q-40 0-68-28t-28-68v-192q0-40 28-68t68-28h416v-416q0-40 28-68t68-28h192q40 0 68 28t28 68v416h416q40 0 68 28t28 68z"}))),ui=function(e){var t=e.elements,n=e.pendingElements,r=e.onRemoveFromLibrary,a=e.onClick,l=Object(o.useRef)(null);Object(o.useEffect)((function(){var e=t||n;if(e){var r,a=hr(e,{exportBackground:!1,viewBackgroundColor:"#fff",shouldAddWatermark:!1}),o=Object(k.a)(l.current.children);try{for(o.s();!(r=o.n()).done;){var i=r.value;"svg"===i.tagName&&l.current.removeChild(i)}}catch(s){o.e(s)}finally{o.f()}l.current.appendChild(a);var c=l.current;return function(){c.removeChild(a)}}}),[t,n]);var c=Object(o.useState)(!1),s=Object(m.a)(c,2),u=s[0],d=s[1],p=u&&n&&i.a.createElement("div",{className:"library-unit__adder"},si);return i.a.createElement("div",{className:"library-unit ".concat(t||n?"library-unit__active":""),onMouseEnter:function(){return d(!0)},onMouseLeave:function(){return d(!1)}},i.a.createElement("div",{className:"library-unit__dragger ".concat(n?"library-unit__pulse":""),ref:l,draggable:!!t,onClick:t||n?a:void 0,onDragStart:function(e){d(!1),e.dataTransfer.setData("application/vnd.excalidraw.json",JSON.stringify(t))}}),p,t&&u&&i.a.createElement("button",{className:"library-unit__removeFromLibrary","aria-label":on("labels.removeFromLibrary"),onClick:r},Ua))};var di=function(e){for(var t=e.library,n=e.onRemoveFromLibrary,r=e.onAddToLibrary,a=e.onInsertShape,o=e.pendingElements,l=t.length+(o.length>0?1:0),c=Math.max(1,Math.ceil(l/3)),s=[],u=!1,d=0;d<c;d++){for(var m=3*d,p=[],h=0;h<3;h++){var f=o.length>0&&!u&&m+h>=t.length;u=u||f,p.push(i.a.createElement(Ao,{key:h},i.a.createElement(ui,{elements:t[m+h],pendingElements:f?o:void 0,onRemoveFromLibrary:n.bind(null,m+h),onClick:f?r.bind(null,o):a.bind(null,t[m+h])})))}s.push(i.a.createElement(Mo,{align:"center",gap:1,key:d},p))}return i.a.createElement(Ao,{align:"center",gap:1,className:"layer-ui__library-items"},s)},mi=function(e){var t=e.onClickOutside,n=e.onInsertShape,r=e.pendingElements,a=e.onAddToLibrary,l=Object(o.useRef)(null);!function(e,t){Object(o.useEffect)((function(){var n=function(n){e.current&&(n.target instanceof Element&&(e.current.contains(n.target)||!document.body.contains(n.target))||t(n))};return document.addEventListener("pointerdown",n,!1),function(){document.removeEventListener("pointerdown",n)}}),[e,t])}(l,t);var c=Object(o.useState)([]),s=Object(m.a)(c,2),p=s[0],h=s[1],f=Object(o.useState)("preloading"),g=Object(m.a)(f,2),v=g[0],b=g[1],E=Object(o.useRef)(null);Object(o.useEffect)((function(){return Promise.race([new Promise((function(e){E.current=setTimeout((function(){e("loading")}),100)})),Ur().then((function(e){h(e),b("ready")}))]).then((function(e){"loading"===e&&b("loading")})),function(){clearTimeout(E.current)}}),[]);var w=Object(o.useCallback)(function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ur();case 2:n=e.sent,r=n.filter((function(e,n){return n!==t})),Wr(r),h(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),k=Object(o.useCallback)(function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ur();case 2:n=e.sent,r=[].concat(Object(y.a)(n),[t]),a(),Wr(r),h(r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[a]);return"preloading"===v?null:i.a.createElement(To,{padding:1,ref:l,className:"layer-ui__library"},"loading"===v?i.a.createElement("div",{className:"layer-ui__library-message"},on("labels.libraryLoadingMessage")):i.a.createElement(di,{library:p,onClickOutside:t,onRemoveFromLibrary:w,onAddToLibrary:k,onInsertShape:n,pendingElements:r}))},pi=i.a.memo((function(e){var t=e.actionManager,n=e.appState,r=e.setAppState,a=e.canvas,l=e.elements,c=e.onRoomCreate,s=e.onUsernameChange,h=e.onRoomDestroy,f=e.onLockToggle,g=e.onInsertShape,v=e.zenModeEnabled,b=e.toggleZenMode,y=Kn(),E=function(){var e=function(e){return function(t,r){a&&ra(e,t,n,a,{exportBackground:n.exportBackground,name:n.name,viewBackgroundColor:n.viewBackgroundColor,scale:r,shouldAddWatermark:n.shouldAddWatermark})}};return i.a.createElement(Uo,{elements:l,appState:n,actionManager:t,onExportToPng:e("png"),onExportToSvg:e("svg"),onExportToClipboard:e("clipboard"),onExportToBackend:function(e){a&&ra("backend",e,Object(p.a)({},n,{selectedElementIds:{}}),a,n)}})},w=Object(o.useCallback)((function(e){r({isLibraryOpen:!1})}),[r]),k=Object(o.useCallback)((function(){r({selectedElementIds:{},selectedGroupIds:{}})}),[r]);return y?i.a.createElement($o,{appState:n,elements:l,actionManager:t,exportButton:E(),setAppState:r,onUsernameChange:s,onRoomCreate:c,onRoomDestroy:h,onLockToggle:f,canvas:a}):i.a.createElement("div",{className:"layer-ui__wrapper"},n.isLoading&&i.a.createElement(Gn,null),n.errorMessage&&i.a.createElement(Qo,{message:n.errorMessage,onClose:function(){return r({errorMessage:null})}}),n.showShortcutsDialog&&i.a.createElement(ii,{onClose:function(){return r({showShortcutsDialog:null})}}),function(){var e=Wt(n,l),a=n.isLibraryOpen?i.a.createElement(mi,{pendingElements:dn(l,n),onClickOutside:w,onInsertShape:g,onAddToLibrary:k}):null;return i.a.createElement(Lo,{side:"top"},i.a.createElement(Go,{appState:n,elements:l}),i.a.createElement("div",{className:"App-menu App-menu_top"},i.a.createElement(Ao,{gap:4,className:v&&"disable-pointerEvents"},i.a.createElement(qo,{heading:"canvasActions",className:"zen-mode-transition ".concat(v&&"transition-left")},i.a.createElement(To,{padding:4,style:{zIndex:1}},i.a.createElement(Ao,{gap:4},i.a.createElement(Mo,{gap:1,justifyContent:"space-between"},t.renderAction("loadScene"),t.renderAction("saveScene"),t.renderAction("saveAsScene"),E(),t.renderAction("clearCanvas"),i.a.createElement(Jo,{isCollaborating:n.isCollaborating,collaboratorCount:n.collaborators.size,username:n.username,onUsernameChange:s,onRoomCreate:c,onRoomDestroy:h})),t.renderAction("changeViewBackgroundColor")))),e&&i.a.createElement(qo,{heading:"selectedShapeActions",className:"zen-mode-transition ".concat(v&&"transition-left")},i.a.createElement(To,{className:z,padding:4},i.a.createElement(Yo,{appState:n,elements:l,renderAction:t.renderAction,elementType:n.elementType})))),i.a.createElement(qo,{heading:"shapes"},(function(e){return i.a.createElement(Ao,{gap:4,align:"start"},i.a.createElement(Mo,{gap:1},i.a.createElement(To,{padding:1,className:v&&"zen-mode"},e,i.a.createElement(Mo,{gap:1},i.a.createElement(Vo,{elementType:n.elementType,setAppState:r,isLibraryOpen:n.isLibraryOpen}))),i.a.createElement(zo,{zenModeEnabled:v,checked:n.elementLocked,onChange:f,title:on("toolBar.lock")})),a)})),i.a.createElement(Do,{className:"zen-mode-transition ".concat(v&&"transition-right")},Array.from(n.collaborators).filter((function(e){var t=Object(m.a)(e,2),n=(t[0],t[1]);return 0!==Object.keys(n).length})).map((function(e){var n=Object(m.a)(e,2),r=n[0],a=n[1];return i.a.createElement(ci,{label:a.username||"Unknown user",key:r},t.renderAction("goToCollaborator",r))})))))}(),i.a.createElement("div",{className:"App-menu App-menu_bottom zen-mode-transition ".concat(v&&"App-menu_bottom--transition-left")},i.a.createElement(Ao,{gap:2},i.a.createElement(qo,{heading:"canvasActions"},i.a.createElement(To,{padding:1},i.a.createElement(Ko,{renderAction:t.renderAction,zoom:n.zoom})),i.a.createElement("a",{className:"encrypted-icon tooltip zen-mode-visibility ".concat(v?"zen-mode-visibility--hidden":""),href:"https://blog.excalidraw.com/end-to-end-encryption/",target:"_blank",rel:"noopener noreferrer"},i.a.createElement("span",{className:"tooltip-text",dir:"auto"},on("encrypted.tooltip")),Ya)))),i.a.createElement("aside",{className:"layer-ui__wrapper__github-corner zen-mode-transition ".concat(v&&"transition-right")},i.a.createElement(li,null)),i.a.createElement("footer",{role:"contentinfo",className:"layer-ui__wrapper__footer"},i.a.createElement("div",{className:"zen-mode-transition ".concat(v&&"transition-right disable-pointerEvents")},i.a.createElement(Wo,{onChange:function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tn(t);case 2:r({});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),languages:Jt,floating:!0}),t.renderAction("toggleShortcuts")),i.a.createElement("button",{className:"disable-zen-mode ".concat(v&&"disable-zen-mode--visible"),onClick:b},on("buttons.exitZenMode")),n.scrolledOutside&&i.a.createElement("button",{className:"scroll-back-to-content",onClick:function(){r(Object(p.a)({},pn(l,n,a)))}},on("buttons.scrollBackToContent"))))}),(function(e,t){var n=function(e){e.draggingElement,e.resizingElement,e.multiElement,e.editingElement,e.isResizing,e.cursorX,e.cursorY;return Object(Ie.a)(e,["draggingElement","resizingElement","multiElement","editingElement","isResizing","cursorX","cursorY"])},r=n(e.appState),a=n(t.appState),o=Object.keys(r);return e.lng===t.lng&&e.elements===t.elements&&o.every((function(e){return r[e]===a[e]}))})),hi=n(36),fi=n.n(hi),gi=function(e){return function(t){Object(l.unstable_batchedUpdates)(e,t)}},vi={history:new sa}.history,bi=!1,yi=0,Ei=0,wi=0,ki=!1,xi=!1,Si=!1,Ci={horizontal:null,vertical:null},Oi=0,Ii=!1,ji=null,Ti={pointers:new Map,lastCenter:null,initialDistance:null,initialScale:null},Mi=function(e){Object(v.a)(o,e);var t=Object(g.a)(o);function o(e){var l;Object(h.a)(this,o),(l=t.call(this,e)).canvas=null,l.rc=null,l.portal=new oa(Object(qn.a)(l)),l.lastBroadcastedOrReceivedSceneVersion=-1,l.broadcastedElementVersions=new Map,l.removeSceneCallback=null,l.unmounted=!1,l.actionManager=void 0,l.syncActionResult=gi((function(e){if(!l.unmounted&&!1!==e){var t=null;e.elements&&(e.elements.forEach((function(e){var n;(null===(n=l.state.editingElement)||void 0===n?void 0:n.id)===e.id&&l.state.editingElement!==e&&Vt(e)&&(t=e)})),En.replaceAllElements(e.elements),e.commitToHistory&&vi.resumeRecording()),(e.appState||t)&&(e.commitToHistory&&vi.resumeRecording(),l.setState((function(n){var r;return Object(p.a)({},e.appState,{editingElement:t||(null===(r=e.appState)||void 0===r?void 0:r.editingElement)||null,isCollaborating:n.isCollaborating,collaborators:n.collaborators})}),(function(){e.syncHistory&&vi.setCurrentState(l.state,En.getElementsIncludingDeleted())})))}})),l.onBlur=gi((function(){ki=!1,l.saveDebounced(),l.saveDebounced.flush()})),l.onUnload=function(){l.destroySocketClient(),l.onBlur()},l.disableEvent=function(e){e.preventDefault()},l.onFontLoaded=function(){En.getElementsIncludingDeleted().forEach((function(e){E(e)&&ue(e)})),l.onSceneUpdated()},l.initializeScene=Object(d.a)(u.a.mark((function e(){var t,n,r,a,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new URLSearchParams(window.location.search),n=t.get("id"),r=window.location.hash.match(/^#json=([0-9]+),([a-zA-Z0-9_-]+)$/),l.state.isLoading||l.setState({isLoading:!0}),e.next=6,aa(null);case 6:if(a=e.sent,o=!!Zr(window.location.href),!!!(n||r||o)){e.next=26;break}if(!l.shouldForceLoadScene(a)&&!window.confirm(on("alerts.loadSceneOverridePrompt"))){e.next=24;break}if(!n){e.next=17;break}return e.next=14,aa(n);case 14:a=e.sent,e.next=21;break;case 17:if(!r){e.next=21;break}return e.next=20,aa(r[1],r[2]);case 20:a=e.sent;case 21:o||window.history.replaceState({},"Excalidraw",window.location.origin),e.next=26;break;case 24:o=!1,window.history.replaceState({},"Excalidraw",window.location.origin);case 26:l.state.isLoading&&l.setState({isLoading:!1}),o?l.initializeSocketClient({showLoadingState:!0}):a&&l.syncActionResult(a);case 28:case"end":return e.stop()}}),e)}))),l.onResize=gi((function(){En.getElementsIncludingDeleted().forEach((function(e){return ue(e)})),l.setState({})})),l.onHashChange=function(e){window.location.hash.length>1&&l.initializeScene()},l.beforeUnload=gi((function(e){l.state.isCollaborating&&l.portal.roomID&&localStorage.setItem("collabLinkForceLoadFlag",JSON.stringify({timestamp:Date.now(),room:l.portal.roomID})),l.state.isCollaborating&&En.getElements().length>0&&(e.preventDefault(),e.returnValue="")})),l.queueBroadcastAllElements=fi()((function(){l.broadcastScene(r.UPDATE,!0)}),2e4),l.onCut=gi((function(e){Cn(e.target)||(l.copyAll(),l.actionManager.executeAction(qa),e.preventDefault())})),l.onCopy=gi((function(e){Cn(e.target)||(l.copyAll(),e.preventDefault())})),l.copyAll=function(){Ir(En.getElements(),l.state)},l.copyToClipboardAsPng=function(){var e=En.getElements(),t=dn(e,l.state);ra("clipboard",t.length?t:e,l.state,l.canvas,l.state)},l.copyToClipboardAsSvg=function(){var e=dn(En.getElements(),l.state);ra("clipboard-svg",e.length?e:En.getElements(),l.state,l.canvas,l.state)},l.onTapStart=function(e){if(!bi)return bi=!0,clearTimeout(yi),void(yi=window.setTimeout(o.resetTapTwice,300));if(bi&&1===e.touches.length){var t=Object(m.a)(e.touches,1)[0];l.handleCanvasDoubleClick({clientX:t.clientX,clientY:t.clientY}),bi=!1,clearTimeout(yi)}e.preventDefault(),2===e.touches.length&&l.setState({selectedElementIds:{}})},l.onTapEnd=function(e){if(e.preventDefault(),e.touches.length>0){var t=l.state.previousSelectedElementIds;l.setState({previousSelectedElementIds:{},selectedElementIds:t})}},l.pasteFromClipboard=gi(function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.activeElement,r=document.elementFromPoint(Ei,wi),!t||r instanceof HTMLCanvasElement&&!Cn(n)){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,Tr(l.state,Ei,wi,t);case 6:(a=e.sent).error?alert(a.error):a.elements?l.addElementsFromPasteOrLibrary(a.elements):a.text&&l.addTextFromPaste(a.text),l.selectShapeTool("selection"),null===t||void 0===t||t.preventDefault();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l.addElementsFromPasteOrLibrary=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ei,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:wi,r=te(e),a=Object(m.a)(r,4),o=a[0],i=a[1],c=a[2],s=a[3],u=Ln(o,c)/2,d=Ln(i,s)/2,p=Rn({clientX:t,clientY:n},l.state,l.canvas,window.devicePixelRatio),h=p.x,f=p.y,g=h-u,v=f-d,b=new Map,E=e.map((function(e){return Ue(l.state.editingGroupId,b,e,{x:e.x+g-o,y:e.y+v-i})}));En.replaceAllElements([].concat(Object(y.a)(En.getElementsIncludingDeleted()),Object(y.a)(E))),vi.resumeRecording(),l.setState({isLibraryOpen:!1,selectedElementIds:E.reduce((function(e,t){return e[t.id]=!0,e}),{})})},l.setAppState=function(e){l.setState(e)},l.removePointer=function(e){"touch"===e.pointerType&&Oi&&(clearTimeout(Oi),Ii=!1),Ti.pointers.delete(e.pointerId)},l.openPortal=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=window.history,e.t1={},e.next=4,Jr();case 4:e.t2=e.sent,e.t0.pushState.call(e.t0,e.t1,"Excalidraw",e.t2),l.initializeSocketClient({showLoadingState:!1});case 7:case"end":return e.stop()}}),e)}))),l.closePortal=function(){window.history.pushState({},"Excalidraw",window.location.origin),l.destroySocketClient()},l.toggleLock=function(){l.setState((function(e){return{elementLocked:!e.elementLocked,elementType:e.elementLocked?"selection":e.elementType}}))},l.toggleZenMode=function(){l.setState({zenModeEnabled:!l.state.zenModeEnabled})},l.toggleGridMode=function(){l.setState({gridSize:l.state.gridSize?null:20})},l.destroySocketClient=function(){l.setState({isCollaborating:!1,collaborators:new Map}),l.portal.close()},l.initializeSocketClient=function(){var e=Object(d.a)(u.a.mark((function e(t){var a,o,i,c,s,m;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l.portal.socket){e.next=2;break}return e.abrupt("return");case 2:if(!(a=Zr(window.location.href))){e.next=15;break}return o=function(){l.portal.socketInitialized=!0,clearTimeout(i),l.state.isLoading&&!l.unmounted&&l.setState({isLoading:!1})},i=setTimeout(o,5e3),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.scrollToContent,r=void 0!==n&&n,a=e.payload.elements;if(r&&l.setState(Object(p.a)({},l.state,{},pn(a.filter((function(e){return!e.isDeleted})),l.state,l.canvas))),null==En.getElementsIncludingDeleted()||0===En.getElementsIncludingDeleted().length)En.replaceAllElements(a);else{var i,c=Gt(En.getElementsIncludingDeleted()),s=(i=a.reduce((function(e,t){var n,r,a;return t.id===(null===(n=l.state.editingElement)||void 0===n?void 0:n.id)||t.id===(null===(r=l.state.resizingElement)||void 0===r?void 0:r.id)||t.id===(null===(a=l.state.draggingElement)||void 0===a?void 0:a.id)||(c.hasOwnProperty(t.id)&&c[t.id].version>t.version?(e.push(c[t.id]),delete c[t.id]):c.hasOwnProperty(t.id)&&c[t.id].version===t.version&&c[t.id].versionNonce!==t.versionNonce?(c[t.id].versionNonce<t.versionNonce?e.push(c[t.id]):e.push(t),delete c[t.id]):(e.push(t),delete c[t.id])),e}),[])).concat.apply(i,Object(y.a)(Object.values(c)));l.lastBroadcastedOrReceivedSceneVersion=Yt(s),En.replaceAllElements(s)}vi.clear(),l.portal.socketInitialized||o()},e.next=9,Promise.all([n.e(30),n.e(29)]).then(n.t.bind(null,161,7));case 9:s=e.sent,m=s.default,l.portal.open(m("https://excalidraw-socket.herokuapp.com"),a[1],a[2]),l.portal.socket.on("client-broadcast",function(){var e=Object(d.a)(u.a.mark((function e(t,n){var a,o,i,s,d,m,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l.portal.roomKey){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,ea(t,l.portal.roomKey,n);case 4:a=e.sent,e.t0=a.type,e.next="INVALID_RESPONSE"===e.t0?8:e.t0===r.INIT?9:e.t0===r.UPDATE?11:"MOUSE_LOCATION"===e.t0?13:16;break;case 8:return e.abrupt("return");case 9:return l.portal.socketInitialized||c(a,{scrollToContent:!0}),e.abrupt("break",16);case 11:return c(a),e.abrupt("break",16);case 13:return o=a.payload,i=o.socketID,s=o.pointerCoords,d=o.button,m=o.username,p=o.selectedElementIds,l.setState((function(e){e.collaborators.has(i)||e.collaborators.set(i,{});var t=e.collaborators.get(i);return t.pointer=s,t.button=d,t.selectedElementIds=p,t.username=m,e.collaborators.set(i,t),e})),e.abrupt("break",16);case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),l.portal.socket.on("first-in-room",(function(){l.portal.socket&&l.portal.socket.off("first-in-room"),o()})),l.setState({isCollaborating:!0,isLoading:!!t.showLoadingState||l.state.isLoading});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l.broadcastMouseLocation=function(e){var t;if(null===(t=l.portal.socket)||void 0===t?void 0:t.id){var n={type:"MOUSE_LOCATION",payload:{socketID:l.portal.socket.id,pointerCoords:e.pointerCoords,button:e.button||"up",selectedElementIds:l.state.selectedElementIds,username:l.state.username}};return l.portal._broadcastSocketData(n,!0)}},l.broadcastScene=function(e,t){if(e===r.INIT&&!t)throw new Error("syncAll must be true when sending SCENE.INIT");var n=En.getElementsIncludingDeleted().filter((function(e){return e.isDeleted||!Se(e)}));t||(n=n.filter((function(e){return!l.broadcastedElementVersions.has(e.id)||e.version>l.broadcastedElementVersions.get(e.id)})));var a={type:e,payload:{elements:n}};l.lastBroadcastedOrReceivedSceneVersion=Math.max(l.lastBroadcastedOrReceivedSceneVersion,Yt(En.getElementsIncludingDeleted()));var o,i=Object(k.a)(n);try{for(i.s();!(o=i.n()).done;){var c=o.value;l.broadcastedElementVersions.set(c.id,c.version)}}catch(s){i.e(s)}finally{i.f()}return l.portal._broadcastSocketData(a)},l.onSceneUpdated=function(){l.setState({})},l.updateCurrentCursorPosition=gi((function(e){Ei=e.x,wi=e.y})),l.onKeyDown=gi((function(e){if((!e[Ct]||!e.shiftKey||"C"!==e.key)&&!(Cn(e.target)&&e.key!==kt||Nt(e.key)&&(t=e.target,t instanceof HTMLElement&&"wysiwyg"===t.dataset.type||t instanceof HTMLBRElement||t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||t instanceof HTMLSelectElement))){var t;if(e.key===jt&&l.setState({showShortcutsDialog:!0}),!e[Ct]&&e.altKey&&e.keyCode===At&&l.toggleZenMode(),e[Ct]&&e.keyCode===Lt&&l.toggleGridMode(),"KeyC"===e.code&&e.altKey&&e.shiftKey)return l.copyToClipboardAsPng(),void e.preventDefault();if(!l.actionManager.handleKeyDown(e)){"Digit9"===e.code&&l.setState({isLibraryOpen:!l.state.isLibraryOpen});var n=function(e){var t;return(null===(t=ia.find((function(t,n){return t.key===e.toLowerCase()||e===(n+1).toString()})))||void 0===t?void 0:t.value)||"selection"}(e.key);if(Nt(e.key)){var r=l.state.gridSize&&(e.shiftKey?1:l.state.gridSize)||(e.shiftKey?5:1);En.replaceAllElements(En.getElementsIncludingDeleted().map((function(t){if(l.state.selectedElementIds[t.id]){var n={};return e.key===vt?n.x=t.x-r:e.key===bt?n.x=t.x+r:e.key===Et?n.y=t.y-r:e.key===yt&&(n.y=t.y+r),xe(t,n)}return t}))),e.preventDefault()}else if(e.key===wt){var a=dn(En.getElements(),l.state);if(1===a.length&&w(a[0]))l.state.editingLinearElement&&l.state.editingLinearElement.elementId===a[0].id||(vi.resumeRecording(),l.setState({editingLinearElement:new ir(a[0])}));else if(1===a.length&&!w(a[0])){var o=a[0];return l.startTextEditing({sceneX:o.x+o.width/2,sceneY:o.y+o.height/2}),void e.preventDefault()}}else e.ctrlKey||e.altKey||e.metaKey||null!==l.state.draggingElement||(la.includes(e.key.toLowerCase())?l.selectShapeTool(n):"q"===e.key&&l.toggleLock());e.key===It&&0===Ti.pointers.size&&(ki=!0,document.documentElement.style.cursor=O)}}})),l.onKeyUp=gi((function(e){e.key===It&&("selection"===l.state.elementType?Dn():(Pn(l.state.elementType),l.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null})),ki=!1)})),l.onGestureStart=gi((function(e){e.preventDefault(),l.setState({selectedElementIds:{}}),Ti.initialScale=l.state.zoom})),l.onGestureChange=gi((function(e){e.preventDefault(),l.setState({zoom:yn(Ti.initialScale*e.scale)})})),l.onGestureEnd=gi((function(e){e.preventDefault();var t=l.state.previousSelectedElementIds;l.setState({previousSelectedElementIds:{},selectedElementIds:t}),Ti.initialScale=null})),l.setElements=function(e){En.replaceAllElements(e)},l.startTextEditing=function(e){var t=e.sceneX,n=e.sceneY,r=e.insertAtParentCenter,a=void 0===r||r,o=l.getTextElementAtPosition(t,n),i=a&&l.getTextWysiwygSnappedToCenterPosition(t,n,l.state,l.canvas,window.devicePixelRatio),c=o||Be({x:i?i.elementCenterX:t,y:i?i.elementCenterY:n,strokeColor:l.state.currentItemStrokeColor,backgroundColor:l.state.currentItemBackgroundColor,fillStyle:l.state.currentItemFillStyle,strokeWidth:l.state.currentItemStrokeWidth,strokeStyle:l.state.currentItemStrokeStyle,roughness:l.state.currentItemRoughness,opacity:l.state.currentItemOpacity,text:"",fontSize:l.state.currentItemFontSize,fontFamily:l.state.currentItemFontFamily,textAlign:i?"center":l.state.currentItemTextAlign,verticalAlign:i?"middle":"top"});l.setState({editingElement:c}),o?i&&"center"===c.textAlign||ke(c,{verticalAlign:"top"}):(En.replaceAllElements([].concat(Object(y.a)(En.getElementsIncludingDeleted()),[c])),i||ke(c,{y:c.y-c.baseline/2})),l.setState({editingElement:c}),l.handleTextWysiwyg(c,{isExistingElement:!!o})},l.handleCanvasDoubleClick=function(e){if(!l.state.multiElement){var t=dn(En.getElements(),l.state);if(1===t.length&&w(t[0]))l.state.editingLinearElement&&l.state.editingLinearElement.elementId===t[0].id||(vi.resumeRecording(),l.setState({editingLinearElement:new ir(t[0])}));else{Dn();var n=Rn(e,l.state,l.canvas,window.devicePixelRatio),r=n.x,a=n.y;if(Ae(l.state).length>0){var o=En.getElements(),i=vn(o,l.state,r,a,l.state.zoom),c=i&&function(e,t){return e.groupIds.find((function(e){return t[e]}))}(i,l.state.selectedGroupIds);if(c)return void l.setState((function(e){return Le(Object(p.a)({},e,{editingGroupId:c,selectedElementIds:Object(je.a)({},i.id,!0),selectedGroupIds:{}}),En.getElements())}))}Dn(),l.startTextEditing({sceneX:r,sceneY:a,insertAtParentCenter:!e.altKey})}}},l.handleCanvasPointerMove=function(e){if(l.savePointer(e.clientX,e.clientY,l.state.cursorButton),Ti.pointers.has(e.pointerId)&&Ti.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===Ti.pointers.size){var t=So(Ti.pointers),n=t.x-Ti.lastCenter.x,r=t.y-Ti.lastCenter.y;Ti.lastCenter=t;var a=Co(Array.from(Ti.pointers.values()))/Ti.initialDistance;l.setState({scrollX:mn(l.state.scrollX+n/l.state.zoom),scrollY:mn(l.state.scrollY+r/l.state.zoom),zoom:yn(Ti.initialScale*a),shouldCacheIgnoreZoom:!0}),l.resetShouldCacheIgnoreZoomDebounced()}else Ti.lastCenter=Ti.initialDistance=Ti.initialScale=null;if(!(ki||xi||Si)){var o=sn(Ci,e.clientX,e.clientY).isOverEither;l.state.draggingElement||l.state.multiElement||(o?Dn():Pn(l.state.elementType));var i=Rn(e,l.state,l.canvas,window.devicePixelRatio),c=i.x,s=i.y;if(l.state.editingLinearElement&&null===l.state.editingLinearElement.draggingElementPointIndex){var u=ir.handlePointerMove(e,c,s,l.state.editingLinearElement);u!==l.state.editingLinearElement&&l.setState({editingLinearElement:u})}if(l.state.multiElement){var d=l.state.multiElement,m=d.x,p=d.y,h=d.points,f=d.lastCommittedPoint,g=h[h.length-1];return Pn(l.state.elementType),void(g===f?F(c-m,s-p,g[0],g[1])>=10?ke(d,{points:[].concat(Object(y.a)(h),[[c-m,s-p]])}):document.documentElement.style.cursor=I:h.length>2&&f&&F(c-m,s-p,f[0],f[1])<10?(document.documentElement.style.cursor=I,ke(d,{points:h.slice(0,-1)})):(U(h)&&(document.documentElement.style.cursor=I),ke(d,{points:[].concat(Object(y.a)(h.slice(0,-1)),[[c-m,s-p]])})))}if(!(Boolean(e.buttons)||"selection"!==l.state.elementType&&"text"!==l.state.elementType)){var v=En.getElements(),b=dn(v,l.state);if(1!==b.length||o||l.state.editingLinearElement){if(b.length>1&&!o){var w=at(te(b),c,s,l.state.zoom,e.pointerType);if(w)return void(document.documentElement.style.cursor=it({resizeHandle:w}))}}else{var k=rt(v,l.state,c,s,l.state.zoom,e.pointerType);if(k&&k.resizeHandle)return void(document.documentElement.style.cursor=it(k))}var x=vn(v,l.state,c,s,l.state.zoom);"text"===l.state.elementType?document.documentElement.style.cursor=E(x)?S:C:document.documentElement.style.cursor=x&&!o?"move":""}}},l.handleTouchMove=function(e){Ii=!0},l.handleCanvasPointerDown=function(e){if(e.persist(),l.maybeOpenContextMenuAfterPointerDownOnTouchDevices(e),l.maybeCleanupAfterMissingPointerUp(e),!xi&&(l.setState({lastPointerDownWith:e.pointerType,cursorButton:"down"}),l.savePointer(e.clientX,e.clientY,"down"),!l.handleCanvasPanUsingWheelOrSpaceDrag(e)&&(e.button===j||e.button===M)&&(l.updateGestureOnPointerDown(e),e.preventDefault(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),!(Ti.pointers.size>1)))){var t=l.initialPointerDownState(e);if(!l.handleDraggingScrollBar(e,t)&&(l.clearSelectionIfNotUsingSelection(),!l.handleSelectionOnPointerDown(e,t)))if("text"!==l.state.elementType){"arrow"===l.state.elementType||"draw"===l.state.elementType||"line"===l.state.elementType?l.handleLinearElementOnPointerDown(e,l.state.elementType,t):l.createGenericElementOnPointerDown(l.state.elementType,t);var n=l.onPointerMoveFromPointerDownHandler(t),r=l.onPointerUpFromPointerDownHandler(t);ji=r,window.addEventListener(a.POINTER_MOVE,n),window.addEventListener(a.POINTER_UP,r),t.eventListeners.onMove=n,t.eventListeners.onUp=r}else l.handleTextOnPointerDown(e,t)}},l.maybeOpenContextMenuAfterPointerDownOnTouchDevices=function(e){"touch"===e.pointerType&&(Ii=!1,Oi=window.setTimeout((function(){Ii||l.openContextMenu({clientX:e.clientX,clientY:e.clientY})}),500))},l.handleCanvasPanUsingWheelOrSpaceDrag=function(e){if(0!==Ti.pointers.size||!(e.button===T||e.button===j&&ki))return!1;xi=!0;var t=!1,n=/Linux/.test(window.navigator.platform);document.documentElement.style.cursor=O;var r=e.clientX,o=e.clientY,i=gi((function(e){var i=r-e.clientX,c=o-e.clientY;if(r=e.clientX,o=e.clientY,n&&!t&&(Math.abs(i)>1||Math.abs(c)>1)){t=!0;var s=function e(t){document.body.removeEventListener(a.PASTE,e),t.stopPropagation()};document.body.addEventListener(a.PASTE,s),window.addEventListener(a.POINTER_UP,(function e(){setTimeout((function(){document.body.removeEventListener(a.PASTE,s),window.removeEventListener(a.POINTER_UP,e)}),100)}))}l.setState({scrollX:mn(l.state.scrollX-i/l.state.zoom),scrollY:mn(l.state.scrollY-c/l.state.zoom)})})),c=gi(ji=function(){ji=null,xi=!1,ki||Pn(l.state.elementType),l.setState({cursorButton:"up"}),l.savePointer(e.clientX,e.clientY,"up"),window.removeEventListener(a.POINTER_MOVE,i),window.removeEventListener(a.POINTER_UP,c),window.removeEventListener(a.BLUR,c)});return window.addEventListener(a.BLUR,c),window.addEventListener(a.POINTER_MOVE,i,{passive:!0}),window.addEventListener(a.POINTER_UP,c),!0},l.clearSelectionIfNotUsingSelection=function(){"selection"!==l.state.elementType&&l.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null})},l.handleSelectionOnPointerDown=function(e,t){if("selection"===l.state.elementType){var n=En.getElements(),r=dn(n,l.state);if(1!==r.length||l.state.editingLinearElement)r.length>1&&(t.resize.handle=at(te(r),t.origin.x,t.origin.y,l.state.zoom,e.pointerType));else{var a=rt(n,l.state,t.origin.x,t.origin.y,l.state.zoom,e.pointerType);null!=a&&(l.setState({resizingElement:a.element}),t.resize.handle=a.resizeHandle)}if(t.resize.handle)document.documentElement.style.cursor=it({resizeHandle:t.resize.handle}),t.resize.isResizing=!0,t.resize.offset=Un(function(e,t,n,r){var a=1===t.length?q(t[0]):te(t),o=Object(m.a)(a,4),i=o[0],l=o[1],c=o[2],s=o[3],u=(i+c)/2,d=(l+s)/2,p=1===t.length?t[0].angle:0,h=B(n,r,u,d,-p),f=Object(m.a)(h,2);switch(n=f[0],r=f[1],e){case"n":return B(n-(i+c)/2,r-l,0,0,p);case"s":return B(n-(i+c)/2,r-s,0,0,p);case"w":return B(n-i,r-(l+s)/2,0,0,p);case"e":return B(n-c,r-(l+s)/2,0,0,p);case"nw":return B(n-i,r-l,0,0,p);case"ne":return B(n-c,r-l,0,0,p);case"sw":return B(n-i,r-s,0,0,p);case"se":return B(n-c,r-s,0,0,p);default:return[0,0]}}(t.resize.handle,r,t.origin.x,t.origin.y)),1===r.length&&w(r[0])&&2===r[0].points.length&&(t.resize.arrowDirection=function(e,t){var n=Object(m.a)(t.points,2),r=Object(m.a)(n[1],2),a=r[0],o=r[1];return"nw"===e&&(a<0||o<0)||"ne"===e&&a>=0||"sw"===e&&a<=0||"se"===e&&(a>0||o>0)?"end":"origin"}(t.resize.handle,r[0]));else{var o;if(l.state.editingLinearElement){var i=ir.handlePointerDown(e,l.state,(function(e){return l.setState(e)}),vi,t.origin.x,t.origin.y);if(i.hitElement&&(t.hit.element=i.hitElement),i.didAddPoint)return!0}t.hit.element=null!==(o=t.hit.element)&&void 0!==o?o:vn(n,l.state,t.origin.x,t.origin.y,l.state.zoom),l.maybeClearSelectionWhenHittingElement(e,t.hit.element);var c=t.hit.element;if(null!=c&&!l.state.selectedElementIds[c.id]){if(l.state.editingGroupId&&!De(c,l.state.editingGroupId))return l.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null}),!0;l.setState((function(e){return Le(Object(p.a)({},e,{selectedElementIds:Object(p.a)({},e.selectedElementIds,Object(je.a)({},c.id,!0))}),En.getElements())})),En.replaceAllElements(En.getElementsIncludingDeleted()),t.hit.wasAddedToSelection=!0}var s=l.state.selectedElementIds;l.setState({previousSelectedElementIds:s})}}return!1},l.handleTextOnPointerDown=function(e,t){var n;"text"!==(null===(n=l.state.editingElement)||void 0===n?void 0:n.type)&&(l.startTextEditing({sceneX:t.origin.x,sceneY:t.origin.y,insertAtParentCenter:!e.altKey}),Dn(),l.state.elementLocked||l.setState({elementType:"selection"}))},l.handleLinearElementOnPointerDown=function(e,t,n){if(l.state.multiElement){var r=l.state.multiElement;if("line"===r.type&&U(r.points))return ke(r,{lastCommittedPoint:r.points[r.points.length-1]}),void l.actionManager.executeAction(bo);var a=r.x,o=r.y,i=r.lastCommittedPoint;if(r.points.length>1&&i&&F(n.origin.x-a,n.origin.y-o,i[0],i[1])<10)return void l.actionManager.executeAction(bo);l.setState((function(e){return{selectedElementIds:Object(p.a)({},e.selectedElementIds,Object(je.a)({},r.id,!0))}})),ke(r,{lastCommittedPoint:r.points[r.points.length-1]}),document.documentElement.style.cursor=I}else{var c=X(n.origin.x,n.origin.y,"draw"===t?null:l.state.gridSize),s=Object(m.a)(c,2),u=s[0],d=s[1],h=(f={type:t,x:u,y:d,strokeColor:l.state.currentItemStrokeColor,backgroundColor:l.state.currentItemBackgroundColor,fillStyle:l.state.currentItemFillStyle,strokeWidth:l.state.currentItemStrokeWidth,strokeStyle:l.state.currentItemStrokeStyle,roughness:l.state.currentItemRoughness,opacity:l.state.currentItemOpacity},Object(p.a)({},Ne(f.type,f),{points:[],lastCommittedPoint:f.lastCommittedPoint||null}));l.setState((function(e){return{selectedElementIds:Object(p.a)({},e.selectedElementIds,Object(je.a)({},h.id,!1))}})),ke(h,{points:[].concat(Object(y.a)(h.points),[[0,0]])}),En.replaceAllElements([].concat(Object(y.a)(En.getElementsIncludingDeleted()),[h])),l.setState({draggingElement:h,editingElement:h})}var f},l.createGenericElementOnPointerDown=function(e,t){var n=X(t.origin.x,t.origin.y,l.state.gridSize),r=Object(m.a)(n,2),a=r[0],o=r[1],i=Re({type:e,x:a,y:o,strokeColor:l.state.currentItemStrokeColor,backgroundColor:l.state.currentItemBackgroundColor,fillStyle:l.state.currentItemFillStyle,strokeWidth:l.state.currentItemStrokeWidth,strokeStyle:l.state.currentItemStrokeStyle,roughness:l.state.currentItemRoughness,opacity:l.state.currentItemOpacity});"selection"===i.type?l.setState({selectionElement:i,draggingElement:i}):(En.replaceAllElements([].concat(Object(y.a)(En.getElementsIncludingDeleted()),[i])),l.setState({multiElement:null,draggingElement:i,editingElement:i}))},l.handleCanvasRef=function(e){var t,n,r;null!==e?(l.canvas=e,l.rc=V.a.canvas(l.canvas),l.canvas.addEventListener(a.WHEEL,l.handleWheel,{passive:!1}),l.canvas.addEventListener(a.TOUCH_START,l.onTapStart),l.canvas.addEventListener(a.TOUCH_END,l.onTapEnd)):(null===(t=l.canvas)||void 0===t||t.removeEventListener(a.WHEEL,l.handleWheel),null===(n=l.canvas)||void 0===n||n.removeEventListener(a.TOUCH_START,l.onTapStart),null===(r=l.canvas)||void 0===r||r.removeEventListener(a.TOUCH_END,l.onTapEnd))},l.handleCanvasOnDrop=function(e){var t,n=e.dataTransfer.getData("application/vnd.excalidraw.json");if(""===n){var r=null===(t=e.dataTransfer)||void 0===t?void 0:t.files[0];"application/json"===(null===r||void 0===r?void 0:r.type)||(null===r||void 0===r?void 0:r.name.endsWith(".excalidraw"))?(l.setState({isLoading:!0}),Rr(r).then((function(e){var t=e.elements,n=e.appState;return l.syncActionResult({elements:t,appState:Object(p.a)({},n||l.state,{isLoading:!1}),commitToHistory:!1})})).catch((function(e){l.setState({isLoading:!1,errorMessage:e.message})}))):l.setState({isLoading:!1,errorMessage:on("alerts.couldNotLoadInvalidFile")})}else l.addElementsFromPasteOrLibrary(JSON.parse(n),e.clientX,e.clientY)},l.handleCanvasContextMenu=function(e){e.preventDefault(),l.openContextMenu(e)},l.openContextMenu=function(e){var t=e.clientX,n=e.clientY,r=Rn({clientX:t,clientY:n},l.state,l.canvas,window.devicePixelRatio),a=r.x,o=r.y,i=En.getElements(),c=vn(i,l.state,a,o,l.state.zoom);c?(l.state.selectedElementIds[c.id]||l.setState({selectedElementIds:Object(je.a)({},c.id,!0)}),fa({options:[navigator.clipboard&&{label:on("labels.copy"),action:l.copyAll},navigator.clipboard&&{label:on("labels.paste"),action:function(){return l.pasteFromClipboard(null)}},Or&&{label:on("labels.copyAsPng"),action:l.copyToClipboardAsPng},Cr&&{label:on("labels.copyAsSvg"),action:l.copyToClipboardAsSvg}].concat(Object(y.a)(l.actionManager.getContextMenuItems((function(e){return!R.includes(e.name)})))),top:n,left:t})):fa({options:[navigator.clipboard&&{label:on("labels.paste"),action:function(){return l.pasteFromClipboard(null)}},Or&&i.length>0&&{label:on("labels.copyAsPng"),action:l.copyToClipboardAsPng},Cr&&i.length>0&&{label:on("labels.copyAsSvg"),action:l.copyToClipboardAsSvg}].concat(Object(y.a)(l.actionManager.getContextMenuItems((function(e){return R.includes(e.name)}))),[{label:on("labels.toggleGridMode"),action:l.toggleGridMode}]),top:n,left:t})},l.handleWheel=gi((function(e){e.preventDefault();var t=e.deltaX,n=e.deltaY,r=l.state,a=r.selectedElementIds,o=r.previousSelectedElementIds;if(e.metaKey||e.ctrlKey){var i=Math.sign(n),c=Math.abs(n);return c>10&&(c=10),c*=i,0!==Object.keys(o).length&&setTimeout((function(){l.setState({selectedElementIds:o,previousSelectedElementIds:{}})}),1e3),void l.setState((function(e){var t=e.zoom;return{zoom:yn(t-c/100),selectedElementIds:{},previousSelectedElementIds:0!==Object.keys(a).length?a:o}}))}e.shiftKey?l.setState((function(e){var r=e.zoom,a=e.scrollX;return{scrollX:mn(a-(n||t)/r)}})):l.setState((function(e){var r=e.zoom,a=e.scrollX,o=e.scrollY;return{scrollX:mn(a-t/r),scrollY:mn(o-n/r)}}))})),l.savePointer=function(e,t,n){if(e&&t){var r=Rn({clientX:e,clientY:t},l.state,l.canvas,window.devicePixelRatio);isNaN(r.x)||isNaN(r.y)||l.portal.socket&&Ti.pointers.size<2&&l.broadcastMouseLocation({pointerCoords:r,button:n})}},l.resetShouldCacheIgnoreZoomDebounced=Tn((function(){l.setState({shouldCacheIgnoreZoom:!1})}),300),l.saveDebounced=Tn((function(){!function(e,t){try{localStorage.setItem("excalidraw",JSON.stringify(e.filter((function(e){return!e.isDeleted})))),localStorage.setItem("excalidraw-state",JSON.stringify(er(t)))}catch(n){console.error(n)}}(En.getElementsIncludingDeleted(),l.state)}),300);var c,s=Jn(),f=e.width,g=e.height;return l.state=Object(p.a)({},s,{isLoading:!0,width:f,height:g}),l.actionManager=new ga(l.syncActionResult,(function(){return l.state}),(function(){return En.getElementsIncludingDeleted()})),l.actionManager.registerAll(Xa),l.actionManager.registerAction((c=vi,{name:"undo",perform:function(e,t){return Io(e,t,(function(){return c.undoOnce()}))},keyTest:jo(!1),PanelComponent:function(e){var t=e.updateData;return i.a.createElement(va,{type:"button",icon:La,"aria-label":on("buttons.undo"),onClick:t})},commitToHistory:function(){return!1}})),l.actionManager.registerAction(function(e){return{name:"redo",perform:function(t,n){return Io(t,n,(function(){return e.redoOnce()}))},keyTest:jo(!0),PanelComponent:function(e){var t=e.updateData;return i.a.createElement(va,{type:"button",icon:Da,"aria-label":on("buttons.redo"),onClick:t})},commitToHistory:function(){return!1}}}(vi)),l}return Object(f.a)(o,[{key:"render",value:function(){var e=this,t=this.state,n=t.zenModeEnabled,r=t.width,a=t.height,o=window.devicePixelRatio,l=r*o,c=a*o;return i.a.createElement("div",{className:"excalidraw"},i.a.createElement(pi,{canvas:this.canvas,appState:this.state,setAppState:this.setAppState,actionManager:this.actionManager,elements:En.getElements(),onRoomCreate:this.openPortal,onRoomDestroy:this.closePortal,onUsernameChange:function(t){!function(e){try{localStorage.setItem("excalidraw-collab",JSON.stringify({username:e}))}catch(t){console.error(t)}}(t),e.setState({username:t})},onLockToggle:this.toggleLock,onInsertShape:function(t){return e.addElementsFromPasteOrLibrary(t)},zenModeEnabled:n,toggleZenMode:this.toggleZenMode,lng:rn().lng}),i.a.createElement("main",null,i.a.createElement("canvas",{id:"canvas",style:{width:r,height:a},width:l,height:c,ref:this.handleCanvasRef,onContextMenu:this.handleCanvasContextMenu,onPointerDown:this.handleCanvasPointerDown,onDoubleClick:this.handleCanvasDoubleClick,onPointerMove:this.handleCanvasPointerMove,onPointerUp:this.removePointer,onPointerCancel:this.removePointer,onTouchMove:this.handleTouchMove,onDrop:this.handleCanvasOnDrop},on("labels.drawingCanvas"))))}},{key:"shouldForceLoadScene",value:function(e){if(!e.elements.length)return!0;var t=Zr(window.location.href);if(!t)return!1;var n=localStorage.getItem("collabLinkForceLoadFlag");if(n)try{var r=JSON.parse(n),a=r.room,o=r.timestamp;if(a===t[1]&&Date.now()-o<15e3)return!0}catch(i){}return!1}},{key:"componentDidMount",value:function(){var e=Object(d.a)(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"production"!==A&&"production"!==L||(this.setState.bind(this),Object.defineProperties(window.h,{state:{configurable:!0,get:function(){return t.state}},setState:{configurable:!0,value:function(){return t.setState.apply(t,arguments)}},app:{configurable:!0,value:this}})),this.removeSceneCallback=En.addCallback(this.onSceneUpdated),this.addEventListeners(),this.initializeScene();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.unmounted=!0,this.removeSceneCallback(),this.removeEventListeners(),clearTimeout(Oi)}},{key:"removeEventListeners",value:function(){document.removeEventListener(a.COPY,this.onCopy),document.removeEventListener(a.PASTE,this.pasteFromClipboard),document.removeEventListener(a.CUT,this.onCut),document.removeEventListener(a.KEYDOWN,this.onKeyDown,!1),document.removeEventListener(a.MOUSE_MOVE,this.updateCurrentCursorPosition,!1),document.removeEventListener(a.KEYUP,this.onKeyUp),window.removeEventListener(a.RESIZE,this.onResize,!1),window.removeEventListener(a.UNLOAD,this.onUnload,!1),window.removeEventListener(a.BLUR,this.onBlur,!1),window.removeEventListener(a.DRAG_OVER,this.disableEvent,!1),window.removeEventListener(a.DROP,this.disableEvent,!1),window.removeEventListener(a.HASHCHANGE,this.onHashChange,!1),document.removeEventListener(a.GESTURE_START,this.onGestureStart,!1),document.removeEventListener(a.GESTURE_CHANGE,this.onGestureChange,!1),document.removeEventListener(a.GESTURE_END,this.onGestureEnd,!1),window.removeEventListener(a.BEFORE_UNLOAD,this.beforeUnload)}},{key:"addEventListeners",value:function(){var e,t;document.addEventListener(a.COPY,this.onCopy),document.addEventListener(a.PASTE,this.pasteFromClipboard),document.addEventListener(a.CUT,this.onCut),document.addEventListener(a.KEYDOWN,this.onKeyDown,!1),document.addEventListener(a.KEYUP,this.onKeyUp,{passive:!0}),document.addEventListener(a.MOUSE_MOVE,this.updateCurrentCursorPosition),window.addEventListener(a.RESIZE,this.onResize,!1),window.addEventListener(a.UNLOAD,this.onUnload,!1),window.addEventListener(a.BLUR,this.onBlur,!1),window.addEventListener(a.DRAG_OVER,this.disableEvent,!1),window.addEventListener(a.DROP,this.disableEvent,!1),window.addEventListener(a.HASHCHANGE,this.onHashChange,!1),null===(e=document.fonts)||void 0===e||null===(t=e.addEventListener)||void 0===t||t.call(e,"loadingdone",this.onFontLoaded),document.addEventListener(a.GESTURE_START,this.onGestureStart,!1),document.addEventListener(a.GESTURE_CHANGE,this.onGestureChange,!1),document.addEventListener(a.GESTURE_END,this.onGestureEnd,!1),window.addEventListener(a.BEFORE_UNLOAD,this.beforeUnload)}},{key:"componentDidUpdate",value:function(e){var t,n=this,a=e.width,o=e.height,i=this.props,l=i.width,c=i.height;a===l&&o===c||this.setState({width:l,height:c}),this.state.isCollaborating&&!this.portal.socket&&this.initializeSocketClient({showLoadingState:!0}),this.state.editingLinearElement&&!this.state.selectedElementIds[this.state.editingLinearElement.elementId]&&setTimeout((function(){n.actionManager.executeAction(bo)}));var s={},u={},d={},m={};this.state.collaborators.forEach((function(e,t){if(e.selectedElementIds)for(var r=0,a=Object.keys(e.selectedElementIds);r<a.length;r++){var o=a[r];o in d||(d[o]=[]),d[o].push(t)}e.pointer&&(e.username&&(m[t]=e.username),u[t]=Hn({sceneX:e.pointer.x,sceneY:e.pointer.y},n.state,n.canvas,window.devicePixelRatio),s[t]=e.button)}));var p=En.getElements(),h=dr(p.filter((function(e){return!n.state.editingElement||"text"!==n.state.editingElement.type||e.id!==n.state.editingElement.id})),this.state,this.state.selectionElement,window.devicePixelRatio,this.rc,this.canvas,{scrollX:this.state.scrollX,scrollY:this.state.scrollY,viewBackgroundColor:this.state.viewBackgroundColor,zoom:this.state.zoom,remotePointerViewportCoords:u,remotePointerButton:s,remoteSelectedElementIds:d,remotePointerUsernames:m,shouldCacheIgnoreZoom:this.state.shouldCacheIgnoreZoom},{renderOptimizations:!0}),f=h.atLeastOneVisibleElement,g=h.scrollBars;g&&(Ci=g);var v="text"!==(null===(t=this.state.editingElement)||void 0===t?void 0:t.type)&&(!f&&p.length>0);this.state.scrolledOutside!==v&&this.setState({scrolledOutside:v}),this.saveDebounced(),Yt(En.getElementsIncludingDeleted())>this.lastBroadcastedOrReceivedSceneVersion&&(this.broadcastScene(r.UPDATE,!1),this.queueBroadcastAllElements()),vi.record(this.state,En.getElementsIncludingDeleted())}},{key:"addTextFromPaste",value:function(e){var t=Rn({clientX:Ei,clientY:wi},this.state,this.canvas,window.devicePixelRatio),n=t.x,r=t.y,a=Be({x:n,y:r,strokeColor:this.state.currentItemStrokeColor,backgroundColor:this.state.currentItemBackgroundColor,fillStyle:this.state.currentItemFillStyle,strokeWidth:this.state.currentItemStrokeWidth,strokeStyle:this.state.currentItemStrokeStyle,roughness:this.state.currentItemRoughness,opacity:this.state.currentItemOpacity,text:e,fontSize:this.state.currentItemFontSize,fontFamily:this.state.currentItemFontFamily,textAlign:this.state.currentItemTextAlign,verticalAlign:"top"});En.replaceAllElements([].concat(Object(y.a)(En.getElementsIncludingDeleted()),[a])),this.setState({selectedElementIds:Object(je.a)({},a.id,!0)}),vi.resumeRecording()}},{key:"setCollaborators",value:function(e){this.setState((function(t){var n,r=new Map,a=Object(k.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;t.collaborators.has(o)?r.set(o,t.collaborators.get(o)):r.set(o,{})}}catch(i){a.e(i)}finally{a.f()}return Object(p.a)({},t,{collaborators:r})}))}},{key:"restoreUserName",value:function(){var e=function(){try{var e=localStorage.getItem("excalidraw-collab");if(e)return JSON.parse(e).username}catch(t){console.error(t)}return null}();null!==e&&this.setState({username:e})}},{key:"selectShapeTool",value:function(e){var t;ki||Pn(e),(t=document.activeElement)instanceof HTMLElement&&t.className.includes("ToolIcon")&&document.activeElement.blur(),"selection"!==e?this.setState({elementType:e,selectedElementIds:{},selectedGroupIds:{},editingGroupId:null}):this.setState({elementType:e})}},{key:"handleTextWysiwyg",value:function(e,t){var n=this,r=t.isExistingElement,a=void 0!==r&&r,o=function(){n.setState({draggingElement:null,editingElement:null})},i=function(t){En.replaceAllElements(Object(y.a)(En.getElementsIncludingDeleted().map((function(n){return n.id===e.id&&E(n)?_e(n,{text:t,isDeleted:!t.trim()}):n}))))};!function(e){var t=e.id,n=e.zoom,r=e.onChange,a=e.onSubmit,o=e.onCancel,i=e.getViewportCoords;function l(){var e=En.getElement(t);if(E(e)){var r=i(e.x,e.y),a=Object(m.a)(r,2),o=a[0],l=a[1],s=e.textAlign,u=e.angle;c.value=e.text;var d=e.text.replace(/\r\n?/g,"\n").split("\n"),p=e.height/d.length;Object.assign(c.style,{font:In(e),lineHeight:"".concat(p,"px"),width:"".concat(e.width,"px"),height:"".concat(e.height,"px"),left:"".concat(o,"px"),top:"".concat(l,"px"),transform:Ft(e.width,e.height,u,n),textAlign:s,color:e.strokeColor,opacity:e.opacity/100})}}var c=document.createElement("textarea");c.dir="auto",c.tabIndex=0,c.dataset.type="wysiwyg",c.wrap="off",Object.assign(c.style,{position:"fixed",display:"inline-block",minHeight:"1em",backfaceVisibility:"hidden",margin:0,padding:0,border:0,outline:0,resize:"none",background:"transparent",overflow:"hidden",whiteSpace:"pre"}),l(),r&&(c.oninput=function(){r(_t(c.value))}),c.onkeydown=function(e){if(e.key===kt)e.preventDefault(),u();else if(e.key===wt&&e[Ct]){if(e.preventDefault(),e.isComposing||229===e.keyCode)return;u()}else e.key!==wt||e.altKey||e.stopPropagation()};var s=function(e){e.stopPropagation()},u=function(){c.value?a(_t(c.value)):o(),d()},d=function(){g||(g=!0,c.onblur=null,c.oninput=null,c.onkeydown=null,window.removeEventListener("resize",l),window.removeEventListener("wheel",s,!0),window.removeEventListener("pointerdown",h),window.removeEventListener("pointerup",p),window.removeEventListener("blur",u),f(),document.body.removeChild(c))},p=function e(){window.removeEventListener("pointerup",e),setTimeout((function(){c.onblur=u,c.focus()}))},h=function(e){e.target instanceof HTMLElement&&e.target.closest(".".concat(z))&&!Cn(e.target)&&(c.onblur=null,window.addEventListener("pointerup",p),window.addEventListener("blur",u))},f=En.addCallback((function(){l(),c.focus()})),g=!1;c.onblur=u,window.addEventListener("resize",l),window.addEventListener("pointerdown",h),window.addEventListener("wheel",s,!0),document.body.appendChild(c),c.focus(),c.select()}({id:e.id,zoom:this.state.zoom,getViewportCoords:function(e,t){var r=Hn({sceneX:e,sceneY:t},n.state,n.canvas,window.devicePixelRatio);return[r.x,r.y]},onChange:gi((function(e){i(e)})),onSubmit:gi((function(t){i(t),n.setState((function(t){return{selectedElementIds:Object(p.a)({},t.selectedElementIds,Object(je.a)({},e.id,!0))}})),n.state.elementLocked&&Pn(n.state.elementType),vi.resumeRecording(),o()})),onCancel:gi((function(){i(""),a&&vi.resumeRecording(),o()}))}),this.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null}),i(e.text)}},{key:"getTextElementAtPosition",value:function(e,t){var n=vn(En.getElements(),this.state,e,t,this.state.zoom);return n&&E(n)&&!n.isDeleted?n:null}},{key:"maybeCleanupAfterMissingPointerUp",value:function(e){null!==ji&&ji(e)}},{key:"updateGestureOnPointerDown",value:function(e){Ti.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===Ti.pointers.size&&(Ti.lastCenter=So(Ti.pointers),Ti.initialScale=this.state.zoom,Ti.initialDistance=Co(Array.from(Ti.pointers.values())))}},{key:"initialPointerDownState",value:function(e){var t=Rn(e,this.state,this.canvas,window.devicePixelRatio);return{origin:t,originInGrid:Un(X(t.x,t.y,this.state.gridSize)),scrollbars:sn(Ci,e.clientX,e.clientY),lastCoords:Object(p.a)({},t),resize:{handle:!1,isResizing:!1,offset:{x:0,y:0},arrowDirection:"origin"},hit:{element:null,wasAddedToSelection:!1,hasBeenDuplicated:!1},drag:{hasOccurred:!1,offset:null},eventListeners:{onMove:null,onUp:null}}}},{key:"handleDraggingScrollBar",value:function(e,t){var n=this;if(!t.scrollbars.isOverEither||this.state.multiElement)return!1;Si=!0,t.lastCoords.x=e.clientX,t.lastCoords.y=e.clientY;var r=gi((function(e){if(e.target instanceof HTMLElement){if(t.scrollbars.isOverHorizontal){var r=e.clientX,a=r-t.lastCoords.x;return n.setState({scrollX:mn(n.state.scrollX-a/n.state.zoom)}),void(t.lastCoords.x=r)}if(t.scrollbars.isOverVertical){var o=e.clientY,i=o-t.lastCoords.y;n.setState({scrollY:mn(n.state.scrollY-i/n.state.zoom)}),t.lastCoords.y=o}}})),o=gi((function(){Si=!1,Pn(n.state.elementType),ji=null,n.setState({cursorButton:"up"}),n.savePointer(e.clientX,e.clientY,"up"),window.removeEventListener(a.POINTER_MOVE,r),window.removeEventListener(a.POINTER_UP,o)}));return ji=o,window.addEventListener(a.POINTER_MOVE,r),window.addEventListener(a.POINTER_UP,o),!0}},{key:"onPointerMoveFromPointerDownHandler",value:function(e){var t=this;return gi((function(n){if(null===e.drag.offset&&(e.drag.offset=Un(function(e,t,n){var r=te(e),a=Object(m.a)(r,2);return[t-a[0],n-a[1]]}(dn(En.getElements(),t.state),e.origin.x,e.origin.y))),n.target instanceof HTMLElement){if(e.scrollbars.isOverHorizontal){var r=n.clientX,a=r-e.lastCoords.x;return t.setState({scrollX:mn(t.state.scrollX-a/t.state.zoom)}),void(e.lastCoords.x=r)}if(e.scrollbars.isOverVertical){var o=n.clientY,i=o-e.lastCoords.y;return t.setState({scrollY:mn(t.state.scrollY-i/t.state.zoom)}),void(e.lastCoords.y=o)}var l=Rn(n,t.state,t.canvas,window.devicePixelRatio),c=l.x,s=l.y,u=X(c,s,t.state.gridSize),d=Object(m.a)(u,2),h=d[0],f=d[1];if(e.drag.hasOccurred||"arrow"!==t.state.elementType&&"line"!==t.state.elementType||!(F(c,s,e.origin.x,e.origin.y)<10)){if(e.resize.isResizing){var g=dn(En.getElements(),t.state),v=e.resize.handle;t.setState({isResizing:v&&"rotation"!==v,isRotating:"rotation"===v});var b=X(c-e.resize.offset.x,s-e.resize.offset.y,t.state.gridSize),E=Object(m.a)(b,2),x=E[0],S=E[1];if(function(e,t,n,r,a,o,i,l,c){if(1===n.length){var s=Object(m.a)(n,1)[0];return"rotation"===e?lt(s,l,c,a):!w(s)||2!==s.points.length||"nw"!==e&&"ne"!==e&&"sw"!==e&&"se"!==e?"text"!==s.type||"nw"!==e&&"ne"!==e&&"sw"!==e&&"se"!==e?e&&(pt(s,e,o,i,l,c),t(function(e,t){if(e.width>=0&&e.height>=0)return t;if(e.width<0&&e.height<0)switch(t){case"nw":return"se";case"ne":return"sw";case"se":return"nw";case"sw":return"ne"}else if(e.width<0)switch(t){case"nw":return"ne";case"ne":return"nw";case"se":return"sw";case"sw":return"se";case"e":return"w";case"w":return"e"}else switch(t){case"nw":return"sw";case"ne":return"se";case"se":return"ne";case"sw":return"nw";case"n":return"s";case"s":return"n"}return t}(s,e)),s.width<0&&ke(s,{width:-s.width}),s.height<0&&ke(s,{height:-s.height})):mt(s,e,i,l,c):ct(s,r,a,l,c),document.documentElement.style.cursor=it({element:s,resizeHandle:e}),!0}return n.length>1&&("nw"===e||"ne"===e||"sw"===e||"se"===e)&&(ht(n,e,l,c),!0)}(v,(function(t){e.resize.handle=t}),g,e.resize.arrowDirection,Bt(n),Ht(n),Rt(n),x,S))return}if(t.state.editingLinearElement)if(ir.handlePointDragging(t.state,(function(e){return t.setState(e)}),c,s,e.lastCoords.x,e.lastCoords.y))return e.lastCoords.x=c,void(e.lastCoords.y=s);var C=e.hit.element;if(C&&t.state.selectedElementIds[C.id]){e.drag.hasOccurred=!0;var O=dn(En.getElements(),t.state);if(O.length>0){var I=X(c-e.drag.offset.x,s-e.drag.offset.y,t.state.gridSize),j=Object(m.a)(I,2),T=j[0],M=j[1];if(function(e,t,n){var r=te(e),a=Object(m.a)(r,2),o=a[0],i=a[1];e.forEach((function(e){ke(e,{x:t+e.x-o,y:n+e.y-i})}))}(O,T,M),n.altKey&&!e.hit.hasBeenDuplicated){e.hit.hasBeenDuplicated=!0;var A,L=[],D=[],P=new Map,z=Object(k.a)(En.getElementsIncludingDeleted());try{for(z.s();!(A=z.n()).done;){var N=A.value;if(t.state.selectedElementIds[N.id]||N.id===C.id&&e.hit.wasAddedToSelection){var R=Ue(t.state.editingGroupId,P,N),H=X(e.origin.x-e.drag.offset.x,e.origin.y-e.drag.offset.y,t.state.gridSize),B=Object(m.a)(H,2),_=B[0],U=B[1];ke(R,{x:R.x+(_-T),y:R.y+(U-M)}),L.push(R),D.push(N)}else L.push(N)}}catch($){z.e($)}finally{z.f()}En.replaceAllElements([].concat(L,D))}return}}var W=t.state.draggingElement;if(W){if(w(W)){e.drag.hasOccurred=!0;var G,Y,V=W.points;if("draw"===W.type?(G=c-W.x,Y=s-W.y):(G=h-W.x,Y=f-W.y),Bt(n)&&2===V.length){var K=Ce(t.state.elementType,G,Y);G=K.width,Y=K.height}1===V.length?ke(W,{points:[].concat(Object(y.a)(V),[[G,Y]])}):V.length>1&&("draw"===W.type?ke(W,{points:Object(Je.b)([].concat(Object(y.a)(V),[[G,Y]]),.7)}):ke(W,{points:[].concat(Object(y.a)(V.slice(0,-1)),[[G,Y]])}))}else"selection"===W.type?ft(W,t.state.elementType,e.origin.x,e.origin.y,c,s,Ln(e.origin.x,c),Ln(e.origin.y,s),Ht(n),Rt(n)):ft(W,t.state.elementType,e.originInGrid.x,e.originInGrid.y,h,f,Ln(e.originInGrid.x,h),Ln(e.originInGrid.y,f),Ht(n),Rt(n));if("selection"===t.state.elementType){var Z=En.getElements();!n.shiftKey&&un(Z,t.state)&&t.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null});var J=function(e,t){var n=q(t),r=Object(m.a)(n,4),a=r[0],o=r[1],i=r[2],l=r[3];return e.filter((function(e){var t=ee(e),n=Object(m.a)(t,4),r=n[0],c=n[1],s=n[2],u=n[3];return"selection"!==e.type&&a<=r&&o<=c&&i>=s&&l>=u}))}(Z,W);t.setState((function(e){return Le(Object(p.a)({},e,{selectedElementIds:Object(p.a)({},e.selectedElementIds,{},J.reduce((function(e,t){return e[t.id]=!0,e}),{}))}),En.getElements())}))}}}}}))}},{key:"onPointerUpFromPointerDownHandler",value:function(e){var t=this;return gi((function(n){var r=t.state,o=r.draggingElement,i=r.resizingElement,l=r.multiElement,c=r.elementType,s=r.elementLocked;if(t.setState({isResizing:!1,isRotating:!1,resizingElement:null,selectionElement:null,cursorButton:"up",editingElement:l||E(t.state.editingElement)?t.state.editingElement:null}),t.savePointer(n.clientX,n.clientY,"up"),t.state.editingLinearElement){var u=ir.handlePointerUp(t.state.editingLinearElement);u!==t.state.editingLinearElement&&t.setState({editingLinearElement:u})}if(ji=null,window.removeEventListener(a.POINTER_MOVE,e.eventListeners.onMove),window.removeEventListener(a.POINTER_UP,e.eventListeners.onUp),"draw"!==(null===o||void 0===o?void 0:o.type))if(w(o))if(o.points.length>1&&vi.resumeRecording(),e.drag.hasOccurred||!o||l)e.drag.hasOccurred&&!l&&(s?t.setState((function(e){return{draggingElement:null,selectedElementIds:Object(p.a)({},e.selectedElementIds,Object(je.a)({},t.state.draggingElement.id,!0))}})):(Dn(),t.setState((function(e){return{draggingElement:null,elementType:"selection",selectedElementIds:Object(p.a)({},e.selectedElementIds,Object(je.a)({},t.state.draggingElement.id,!0))}}))));else{var d=Rn(n,t.state,t.canvas,window.devicePixelRatio),m=d.x,h=d.y;ke(o,{points:[].concat(Object(y.a)(o.points),[[m-o.x,h-o.y]])}),t.setState({multiElement:o,editingElement:t.state.draggingElement})}else{if("selection"!==c&&o&&Se(o))return En.replaceAllElements(En.getElementsIncludingDeleted().slice(0,-1)),void t.setState({draggingElement:null});o&&ke(o,Oe(o)),i&&vi.resumeRecording(),i&&Se(i)&&En.replaceAllElements(En.getElementsIncludingDeleted().filter((function(e){return e.id!==i.id})));var f=e.hit.element;0!==Ae(t.state).length||!f||e.drag.hasOccurred||e.hit.wasAddedToSelection||(n.shiftKey?t.setState((function(e){return{selectedElementIds:Object(p.a)({},e.selectedElementIds,Object(je.a)({},f.id,!1))}})):t.setState((function(e){return{selectedElementIds:Object(je.a)({},f.id,!0)}}))),null!==o?(s||t.setState((function(e){return{selectedElementIds:Object(p.a)({},e.selectedElementIds,Object(je.a)({},o.id,!0))}})),("selection"!==c||un(En.getElements(),t.state))&&vi.resumeRecording(),s?t.setState({draggingElement:null}):(Dn(),t.setState({draggingElement:null,elementType:"selection"}))):t.setState({selectedElementIds:{},selectedGroupIds:{},editingGroupId:null})}else t.actionManager.executeAction(bo)}))}},{key:"maybeClearSelectionWhenHittingElement",value:function(e,t){if(!(null!=t&&this.state.selectedElementIds[t.id])&&!e.shiftKey){this.setState((function(e){return{selectedElementIds:{},selectedGroupIds:{},editingGroupId:e.editingGroupId&&null!=t&&De(t,e.editingGroupId)?e.editingGroupId:null}}));var n=this.state.selectedElementIds;this.setState({selectedElementIds:{},previousSelectedElementIds:n})}}},{key:"getTextWysiwygSnappedToCenterPosition",value:function(e,t,n,r,a){var o=function(e,t,n){for(var r=null,a=e.length-1;a>=0;--a)if(!e[a].isDeleted){var o=q(e[a]),i=Object(m.a)(o,4),l=i[0],c=i[1],s=i[2],u=i[3];if(l<t&&t<s&&c<n&&n<u){r=e[a];break}}return r}(En.getElementsIncludingDeleted().filter((function(e){return!E(e)})),e,t);if(o){var i=o.x+o.width/2,l=o.y+o.height/2;if(Math.hypot(e-i,t-l)<30){var c=Hn({sceneX:i,sceneY:l},n,r,a);return{viewportX:c.x,viewportY:c.y,elementCenterX:i,elementCenterY:l}}}}}],[{key:"resetTapTwice",value:function(){bi=!1}}]),o}(i.a.Component);Mi.defaultProps={width:window.innerWidth,height:window.innerHeight},"production"!==A&&"production"!==L||(window.h={},Object.defineProperties(window.h,{elements:{get:function(){return En.getElementsIncludingDeleted()},set:function(e){return En.replaceAllElements(e)}},history:{get:function(){return vi}}}));var Ai=Mi,Li=n(37),Di=n.n(Li),Pi=(n(96),function(e){var t=e.snapshot,n=Object(o.useRef)(null);return Object(o.useEffect)((function(){if(n.current){var e=n.current.getContext("2d");e&&e.putImageData(t.imageData,0,0)}}),[t]),i.a.createElement("canvas",{ref:n,width:t.width,height:t.height})}),zi=function(){var e=Object(o.useState)([]),t=Object(m.a)(e,2),n=t[0],r=t[1];return i.a.createElement(To,{className:"Claymate"},i.a.createElement("div",{className:"Claymate-buttons"},i.a.createElement("button",{type:"button",onClick:function(){var e=function(e){var t=En.getElements(),n=pr(t,{},{exportBackground:!0,exportPadding:10,viewBackgroundColor:"#fff",scale:window.devicePixelRatio,shouldAddWatermark:!1}),r=e?e.width:n.width,a=e?e.height:n.height,o=n.getContext("2d");return{id:be()(),width:r,height:a,imageData:o.getImageData(0,0,r,a)}}(n[0]&&{width:n[0].width,height:n[0].height});r((function(t){return[].concat(Object(y.a)(t),[e])}))}},"Add snapshot"),i.a.createElement("button",{type:"button",onClick:function(){var e=new Di.a;n.forEach((function(t){e.addFrame(t.imageData,{delay:1500})})),e.on("finished",function(){var e=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(gr.b)(t,{fileName:"excalidraw-claymate.gif"});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.render()},disabled:0===n.length},"Export GIF")),i.a.createElement("div",{className:"Claymate-snapshots"},n.map((function(e,t){return i.a.createElement("div",{key:e.id,className:"Claymate-snapshot"},i.a.createElement(Pi,{snapshot:e}),i.a.createElement("button",{type:"button",className:"Claymate-delete","aria-label":"Delete",onClick:function(){return t=e.id,void r((function(e){return e.filter((function(e){return e.id!==t}))}));var t}},"\u2716"),i.a.createElement("button",{type:"button",className:"Claymate-left","aria-label":"Move Left",disabled:0===t,onClick:function(){return t=e.id,void r((function(e){var n=e.findIndex((function(e){return e.id===t})),r=Object(y.a)(e);return r[n-1]=e[n],r[n]=e[n-1],r}));var t}},"\u2b05"),i.a.createElement("button",{type:"button",className:"Claymate-right","aria-label":"Move Right",disabled:t===n.length-1,onClick:function(){return t=e.id,void r((function(e){var n=e.findIndex((function(e){return e.id===t})),r=Object(y.a)(e);return r[n+1]=e[n],r[n]=e[n+1],r}));var t}},"\u27a1"))}))))},Ni=function(){return i.a.createElement("div",{className:"ClaymateApp"},i.a.createElement(Wn,null,i.a.createElement(Vn,null,i.a.createElement(Yn,null,i.a.createElement(Ai,null),i.a.createElement(zi,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(Ni,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[68,28,31]]]);
//# sourceMappingURL=main.57bbbfc2.chunk.js.map